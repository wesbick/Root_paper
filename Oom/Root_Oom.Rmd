---
title: "Root_oomycetes"
author: "Wes Bickford"
date: "12/29/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
library(permute); library(vegan); library("dplyr"); library(knitr); library(MASS)
#source("data_setup.R")
```
#Root Oomycete Analysis

```{r Rarefaction setup, echo = F, include = F}
#source('data_setup.R')
#mean(metadata$n_seqs)

metadata <- read.csv(file = "data/15metadata.csv", stringsAsFactors = F)

rarefy <- read.table(file = "data/Bickford.groups.rarefaction", header=T, stringsAsFactors=F)

ave_columns <- grep(pattern = "X1", colnames(rarefy))
ave_rarefy <- rarefy[ , ave_columns]
reg <- "X1\\.(\\w+\\d*\\w+\\d*)"
sample_id <- gsub(pattern = reg, "\\1", colnames(ave_rarefy))

numsampled <- rarefy$numsampled

colnames(ave_rarefy) <- sample_id

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")


```

##Rarefaction Curves

These are rarefaction curves for all samples. Samples were rarefied to 483 sequences as that was the lowest number at any site. 

```{r Rarefaction plot, echo = F, include = T}
plot(NA, type = "l",
     xlab = "Number of Sequences Sampled",
     ylab = "Number of OTUs Observed",
     ylim = c(0,90),
     xlim = c(0,3000)
     )
for(i in sample_id){
      points(ave_rarefy[ ,i] ~ numsampled, type= "l",
             col=clrs[metadata[metadata$Code==i, "Site"]],
             lwd = 2, lty = 1
       )
}
abline(v=459)

```

##Alpha Diversity 
```{r alpha setup1, echo = F, include = F}
alpha <- read.table(file = "data/Bickford.groups.ave-std.summary", header=T)

alpha_mean <- alpha[alpha$method == "ave", ]
alpha_mean$group <- as.character(alpha_mean$group)

meta_alpha <- inner_join(metadata, alpha_mean, by = c("Code"="group"))

meta_alpha$Lineage <- as.factor(meta_alpha$Lineage)
meta_alpha$Site <- as.factor(meta_alpha$Site)

```

```{r goods coverage plots1, echo = F, include = T}
clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")

boxplot(coverage ~ Site, data = meta_alpha,
        ylab = "Good's Coverage",
        ylim = c(0.9,1), col = clrs[levels(meta_alpha$Site)],
        names = unique(meta_alpha$Site),
        range = 0)


```

The following shows shannon diversity by lineage

```{r alpha plots1, echo = F, include = T}
clrs <- c(Nat = "white", Inv = "gray")

boxplot(sobs ~ Lineage, data = meta_alpha,
        ylab = "Species Observed",
        ylim = c(0,50), col = clrs[levels(meta_alpha$Lineage)],
        names = unique(meta_alpha$Lineage),
        range = 0)

mean(meta_alpha$sobs[meta_alpha$Lineage=="Inv"])
mean(meta_alpha$sobs[meta_alpha$Lineage=="Nat"])


```
```{r alpha plots2, echo = F, include = T}
clrs <- c(Nat = "white", Inv = "gray")

boxplot(chao ~ Lineage, data = meta_alpha,
        ylab = "Chao Richness",
        ylim = c(0,80), col = clrs[levels(meta_alpha$Lineage)],
        names = unique(meta_alpha$Lineage),
        range = 0)
mean(meta_alpha$chao[meta_alpha$Lineage=="Inv"])
mean(meta_alpha$chao[meta_alpha$Lineage=="Nat"])


```

##Alpha Diversity 
```{r alpha setup, echo = F, include = F}

# removing PLB and SB from this plot because there are no replicates
meta_alpha_sub <- meta_alpha[meta_alpha$Site != "SB" & meta_alpha$Site != "PLB", ]
meta_alpha_sub$Site <- as.character(meta_alpha_sub$Site)
meta_alpha_sub$Site <- as.factor(meta_alpha_sub$Site)
meta_alpha_sub$Lineage <- as.factor(meta_alpha_sub$Lineage)
```

The following shows shannon diversity by site and lineage


```{r alpha plots, echo = F, include = T}
clrs <- c(Nat = "white", Inv = "gray")

boxplot(npshannon ~ Lineage + Site, data = meta_alpha_sub,
        ylab = "Shannon Diversity Index",
        ylim = c(0,5), col = clrs[levels(meta_alpha_sub$Lineage)],
        names = F,
        range = 0, axes = F)
axis(1, at = c(1.5,3.5,5.5,7.5,9.5,11.5), labels = F)
axis(2)
mtext(side=1, at=c(1.5,3.5,5.5,7.5,9.5,11.5), line=0.5, text = unique(meta_alpha_sub$Site), cex = 1, font = 2)
box()

legend("topright", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"))

```

```{r ANOVA sobs, echo = F, include = T}
an_shannon <- aov(npshannon ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_shannon)

shan_mean<- tapply(meta_alpha$npshannon, meta_alpha$Lineage, FUN = "mean")
shan_mean
shan_sd<- tapply(meta_alpha$npshannon, meta_alpha$Lineage, FUN = "sd")
shan_sd

an_chao <- aov(chao ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_chao)

chao_mean<- tapply(meta_alpha$chao, meta_alpha$Lineage, FUN = "mean")
chao_mean
chao_sd<- tapply(meta_alpha$chao, meta_alpha$Lineage, FUN = "sd")
chao_sd

an_sobs <- aov(sobs ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_sobs)

sobs_mean<- tapply(meta_alpha$sobs, meta_alpha$Lineage, FUN = "mean")
sobs_mean
sobs_sd<- tapply(meta_alpha$sobs, meta_alpha$Lineage, FUN = "sd")
sobs_sd
```

```{r nat vs non sobs, echo=F, include=T}
nt_sobs_mat <- matrix(NA, nrow = 7, ncol = 4)
rownames(nt_sobs_mat) <- unique(meta_alpha$Site)
colnames(nt_sobs_mat) <- c("Invasive", "Inv_sterr", "Native", "Nat_sterr")

for(ii in rownames(nt_sobs_mat)){
  sub <- meta_alpha[meta_alpha$Site == ii & meta_alpha$Lineage == "Inv", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$sobs[pp]
    }
  }else{
    site <- sub$sobs
  }
  nt_sobs_mat[ii, 1] <- mean(site)
  nt_sobs_mat[ii, 2] <- (sd(site))/(sqrt(num))
  sub <- meta_alpha[meta_alpha$Site == ii & meta_alpha$Lineage == "Nat", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$sobs[pp]
    }
  }else{
    site <- sub$sobs
  }
  nt_sobs_mat[ii, 3] <- mean(site)
  nt_sobs_mat[ii, 4] <- (sd(site))/(sqrt(num))
}
nt_by_site <- as.data.frame(nt_sobs_mat)

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "orange", Rt2 = "gray")


quartz.options(height=6 , width = 6)
plot.new()
par(oma = c(1, 1, 1, 1))
par(mar = c(3, 3, 0.5, 9))
plot.window(xlim = c(0,40), ylim = c(0, 40))
axis(1)
axis(2)


arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native + nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 90, length = 0.05)
arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native - nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 90, length = 0.05)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive + nt_by_site$Inv_sterr, angle = 90, length = 0.05)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive - nt_by_site$Inv_sterr, angle = 90, length = 0.05)
points(x = nt_by_site$Native, y = nt_by_site$Invasive, pch = 16, col = clrs[rownames(nt_by_site)], cex = 1.5)
box()
lines(x = c(0,10,45), y = c(0,10,45), type = "l")
mtext(side = 1, line = 3, text = "Species Observed on Native")
mtext(side = 2, line = 3, text = "Species Observed on Non-Native")
#text(x = nt_by_site$Native, y = nt_by_site$Invasive, labels = rownames(nt_by_site), adj = c(0,0), cex = 0.7)

#legend_text <- c("Bullard Lake", "Cecil Bay", "Chelsea", "Cheboygan Marsh", "Castle Rock", "Point LeBarb", "Route 2")
#legend(42,42, legend_text, pch = 16, 
 #      col = c("blue","red","dark green","coral","black","orange","gray"), xpd = T)


```

```{r ANOVA chao, echo = F, include = T}
an_chao <- aov(chao ~ Site*Lineage, data = meta_alpha)
summary(an_chao)
```

```{r nat vs non chao, echo=F, include=T}
nt_chao_mat <- matrix(NA, nrow = 7, ncol = 4)
rownames(nt_chao_mat) <- unique(meta_alpha$Site)
colnames(nt_chao_mat) <- c("Invasive", "Inv_sterr", "Native", "Nat_sterr")

for(ii in rownames(nt_chao_mat)){
  sub <- meta_alpha[meta_alpha$Site == ii & meta_alpha$Lineage == "Inv", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$chao[pp]
    }
  }else{
    site <- sub$chao
  }
  nt_chao_mat[ii, 1] <- mean(site)
  nt_chao_mat[ii, 2] <- (sd(site))/(sqrt(num))
  sub <- meta_alpha[meta_alpha$Site == ii & meta_alpha$Lineage == "Nat", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$chao[pp]
    }
  }else{
    site <- sub$chao
  }
  nt_chao_mat[ii, 3] <- mean(site)
  nt_chao_mat[ii, 4] <- (sd(site))/(sqrt(num))
}
nt_by_site <- as.data.frame(nt_chao_mat)

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "orange", Rt2 = "gray")


quartz.options(height=6 , width = 6)
plot.new()
par(oma = c(1, 1, 1, 1))
par(mar = c(3, 3, 0.5, 9))
plot.window(xlim = c(0,55), ylim = c(0,55))
axis(1)
axis(2)


arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native + nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 0)
arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native - nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 0)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive + nt_by_site$Inv_sterr, angle = 0)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive - nt_by_site$Inv_sterr, angle = 0)
points(x = nt_by_site$Native, y = nt_by_site$Invasive, pch = 16, col = clrs[rownames(nt_by_site)], cex = 1.5)
box()
lines(x = c(0,30,60), y = c(0,30,60), type = "l")
mtext(side = 1, line = 3, text = "Chao Richness Native")
mtext(side = 2, line = 3, text = "Chao Richness Non-Native")
#text(x = nt_by_site$Native, y = nt_by_site$Invasive, labels = rownames(nt_by_site), adj = c(0,0), cex = 0.7)

legend_text <- c("Bullard Lake", "Cecil Bay", "Chelsea", "Cheboygan Marsh", "Castle Rock", "Point LeBarb", "Route 2")
legend(57,57, legend_text, pch = 16, 
       col = c("blue","red","dark green","coral","black","orange","gray"), xpd = T)


```
```{r barplot of alpha, echo = F, include = T}
alpha_mat <- matrix(NA, nrow = 2, ncol = 2)
rownames(alpha_mat) <- c("Nat", "Inv")
colnames(alpha_mat) <- c("Observed", "Chao")

for(ii in rownames(alpha_mat)){
  sobs <- meta_alpha[meta_alpha$Lineage == ii, "sobs"]
  chao <- meta_alpha[meta_alpha$Lineage == ii, "chao"]
  alpha_mat[ii, 1] <- mean(sobs)
  alpha_mat[ii, 2] <- mean(chao)
}

se_sobs_inv <- sd(meta_alpha[meta_alpha$Lineage == "Inv", "sobs"]) / sqrt(length(meta_alpha[meta_alpha$Lineage == "Inv", "sobs"]))
se_sobs_nat <- sd(meta_alpha[meta_alpha$Lineage == "Nat", "sobs"]) / sqrt(length(meta_alpha[meta_alpha$Lineage == "Nat", "sobs"]))
se_chao_inv <- sd(meta_alpha[meta_alpha$Lineage == "Inv", "chao"]) / sqrt(length(meta_alpha[meta_alpha$Lineage == "Inv", "chao"]))
se_chao_nat <- sd(meta_alpha[meta_alpha$Lineage == "Nat", "chao"]) / sqrt(length(meta_alpha[meta_alpha$Lineage == "Nat", "chao"]))

x0_nat <- c((alpha_mat[1,1] - se_sobs_inv), (alpha_mat[1,2] - se_chao_nat))
x1_nat <- c((alpha_mat[1,1] + se_sobs_inv), (alpha_mat[1,2] + se_chao_nat))

x0_non <- c((alpha_mat[2,1] - se_sobs_inv), (alpha_mat[2,2] - se_chao_inv))
x1_non <- c((alpha_mat[2,1] + se_sobs_inv), (alpha_mat[2,2] + se_chao_inv))

quartz.options(height=6, width=6)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 3, 8))
par(xpd = NA)

plot.window(xlim = c(0,1), ylim = c(0,18))

barplot(height = alpha_mat, beside=T, horiz = T, axisnames = F, xlab = "Oomycete OTUs", xlim = c(0,50), col = c("white", "gray"))

arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
axis(side = 2, las = 1, labels = colnames(alpha_mat), at = c(2,5))


mtext("P-values",side = 4, line = 3, las = 1, at = 7.5, cex = 1)
#mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-0.5,2.9), at = 6.75, cex = 0.9)
arrows(x0 = 64, y0 = 1, y1 = 6.25, angle = 90, lwd = 0.75, length = 0.5)
arrows(x0 = 80, y0 = 1, y1 = 6.25, angle = 90, lwd = 0.75, length = 0.5)
mtext(c("0.980","0.985","Site"), las = 1, side = 4, line = 3.5, at = c(2,5,6.75), cex = 0.8, adj = 0)
mtext(c("0.048","0.061","Lineage"),side = 4, las = 1, at = c(2,5,6.75), line = 2, cex = 0.8, adj = 1)
mtext(c("0.998","0.994","L X S"),side = 4, las = 1, at = c(2,5,6.75), line = 6.5, cex = 0.8, adj = 0)

legend("bottomright", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), bty = "n", cex = 0.8)



```

##Community Analysis
###PerManova

The following is a PerMANOVA of OTUs by site and Lineage

```{r permanova1, include=T, echo = F, results = 'hold'}
shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
meta_alpha$Site <- as.factor(meta_alpha$Site)
meta_alpha$Lineage <- as.factor(meta_alpha$Lineage)
meta_alpha$Sat_lev <- as.factor(meta_alpha$Sat_lev)
meta_alpha$Lat <- as.factor(meta_alpha$Lat)
meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)
meta_alpha$SoilC <- as.numeric(meta_alpha$SoilC)
meta_alpha$TisP <- as.numeric(meta_alpha$TisP)
meta_alpha$TisN <- as.numeric(meta_alpha$TisN)
meta_alpha$TisC <- as.numeric(meta_alpha$TisC)


shared <- shared[ ,-c(1,2)]

permoom <- adonis(shared ~ Site + Sat_lev + Lineage, data=meta_alpha, method = "bray")
permoom

dist <- vegdist(shared, method = "bray")
disp <- betadisper(dist, meta_alpha$Lineage, type = "centroid")
disp
anova(disp)
permutest(disp, pairwise = TRUE, permutations = 99)
(disp.HSD <- TukeyHSD(disp))
plot(disp.HSD)

plot(disp)
plot(disp, ellipse = TRUE, hull = FALSE) # 1 sd data ellipse
plot(disp, ellipse = TRUE, hull = FALSE, conf = 0.90) # 90% data ellipse
plot(disp, axes = c(3,1), seg.col = "forestgreen", seg.lty = "dashed")
boxplot(disp)

scrs <- scores(disp)
str(scrs)
head(scores(disp, 1:4, display = "sites"))
scores(disp, 1:4, display = "centroids")
eigenvals(disp) 

```


###PCoA

```{r PCoA fungi, echo = F, include = T}
brayoom <- vegdist(sqrt(shared), method = "bray")
pcoa.oom <- cmdscale(brayoom, k=(NROW(shared)-1), eig = TRUE, add = TRUE)
pcoa.pts <- as.data.frame(pcoa.oom["points"])
pcoa.eig <- eigenvals(pcoa.oom)
var.axes <- pcoa.eig/sum(pcoa.eig)
var.axes

meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)
meta_alpha$SoilC <- as.numeric(meta_alpha$SoilC)
meta_alpha$TisN <- as.numeric(meta_alpha$TisN)
meta_alpha$TisP <- as.numeric(meta_alpha$TisP)
meta_alpha$TisC <- as.numeric(meta_alpha$TisC)
meta_alpha$Sat <- as.numeric(meta_alpha$Sat)
meta_alpha$Sat_lev <- as.factor(meta_alpha$Sat_lev)
meta_alpha$Lat <- as.factor(meta_alpha$Lat)

ef <- envfit(pcoa.oom, meta_alpha[ , c(7,9:10)], na.rm = T)
ef

```
```{r pcoa plot, include=T, echo = F}


pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(x = pcoa.pts[ , 1], y = pcoa.pts[ ,2], asp = 1, pch = pchs[as.character(meta_alpha$Lineage)], 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "PCo 1 (12.1%)")
mtext(side = 2, line = 3, text = "PCo 2 (9.8%)" )



#ordiellipse(pcoa.oom, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 1, lwd = 2.0)
#ordiellipse(pcoa.oom, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 2, lwd = 2.0)


plot(ef, p.max = 0.1, col = "black")

#mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.192")


#legend_text <- c("Site           P=0.135", "Lineage    P=0.496")
#legend(0.5, -0.6, legend_text, pch = NULL, xpd = T, title = "Significance", cex = 0.8, bty = "n", xjust = 0.5) 

#legend_text2 <- c("Native", "Non-Native")
#legend(0.54, -0.28, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()
```
###NMDS

```{r NMDS, include = F, echo = F}

NMDS <- metaMDS(shared, trymax = 100, k=3, trace = F)
NMDS
NMDS <- metaMDS(shared, previous.best = NMDS, k=3, trace = F)
NMDS

NMDS_scores <- scores(NMDS)

NMDS1 <- NMDS_scores[ ,1]
NMDS2 <- NMDS_scores[ ,2]

NMDS_scores <- as.data.frame(NMDS_scores)

ef <- envfit(NMDS, meta_alpha[ ,c(2,3,7, 9:11)], na.rm = T)
ef
```

The following is an NMDS (stress = `r NMDS$stress`) showing Lineage as different shapes and site by color. The ellipses are sd by site. 

```{r NMDS plot, include=T, echo = F}

clrs <- c(SAT_HI = "blue", SAT = "dark green", UN = "brown")
pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS, "sites", pch = pchs[as.character(meta_alpha$Lineage)], 
      col = clrs[as.character(meta_alpha$Sat_lev)], cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 2, lwd = 2.0)
#ordiellipse(NMDS, meta_alpha$Site == "CH", show.groups = TRUE, kind = "se", conf = 0.95,  col = "dark green", lty = 1, lwd = 2.0)
#ordiellipse(NMDS, meta_alpha$Site == "CM", show.groups = TRUE, kind = "se", conf = 0.95,  col = "coral", lty = 1, lwd = 2.0)
#ordiellipse(NMDS, meta_alpha$Site == "CR", show.groups = TRUE, kind = "se", conf = 0.95,  col = "black", lty = 1, lwd = 2.0)
#ordiellipse(NMDS, meta_alpha$Site == "Rt2", show.groups = TRUE, kind = "se", conf = 0.95,  col = "gray", lty = 1, lwd = 2.0)

mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.173")

plot(ef, p.max = 0.1, col = "black")

legend_text <- c("Site             P=0.337", "Lineage      P=0.090")
legend(-0.6, -0.6, legend_text, pch = NULL, xpd = T, title = "Significance", cex = 0.8, bty = "n", xjust = 0.5)

legend_text2 <- c("Native", "Non-Native")
legend(1.3, -0.55, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()

```

###Remove rare taxa

I removed rare taxa using relative abundance data. Any OTU that made up less than 0.1% of the total sequences was removed. This is more stringent than removing singletons, but ensures that rare taxa are not responsible for site effects. The following are results of a permanova of only abundant taxa by site and lineage. 

```{r, Permanova abundant, echo = F, include = T}
shared <- read.table(file="data/Bickford.subsample.shared", header=T, stringsAsFactors=F, row.names=2)
shared <- shared[,-c(1,2)]

rel_abund <- shared / apply(shared, 1, sum)
mean_rel_abund <- apply(rel_abund, 2, mean)
otu_order <- order(mean_rel_abund, decreasing=T)
rel_abund <- rel_abund[,otu_order]

stopifnot(rownames(shared) == metadata$sampleID)

mean_rel_abund <- apply(rel_abund, 2, mean)
abundant <- mean_rel_abund > 0.001
rel_abund_subset <- rel_abund[, abundant]
shared_abundant <- shared[ , abundant]

permabundant <- adonis(shared_abundant ~ Site * Lineage + Sat_lev, data = meta_alpha)
permabundant

nat_ab <- shared_abundant[grepl("Nat", rownames(shared_abundant)), ]
sobs_nat <- rep(NA, nrow(nat_ab))
names(sobs_nat) <- rownames(nat_ab)
for(i in rownames(nat_ab)){
  smpl <- nat_ab[i, ]
  x <- sum(smpl != 0)
  sobs_nat[i] <- x
}
non_ab <- shared_abundant[grepl("Inv", rownames(shared_abundant)), ]
sobs_non <- rep(NA, nrow(non_ab))
names(sobs_non) <- rownames(non_ab)
for(i in rownames(non_ab)){
  smpl <- non_ab[i, ]
  x <- sum(smpl != 0)
  sobs_non[i] <- x
}
ab_sobs_mat <- matrix(NA, nrow = 2, ncol = 3)
rownames(ab_sobs_mat) <- c("Native", "Non-Native")
colnames(ab_sobs_mat) <- c("Mean", "St_dev","st_err")

ab_sobs_mat[1,1] <- mean(sobs_nat)
ab_sobs_mat[1,2] <- sd(sobs_nat)
ab_sobs_mat[1,3] <- sd(sobs_nat)/sqrt(length(sobs_nat))
ab_sobs_mat[2,1] <- mean(sobs_non)
ab_sobs_mat[2,2] <- sd(sobs_non)
ab_sobs_mat[2,3] <- sd(sobs_non)/sqrt(length(sobs_non))

```

```{r NMDS abundant, include = F, echo = F}
NMDS_ab <- metaMDS(shared_abundant, trymax = 100, k=3, trace = F)
NMDS_ab
NMDS_ab <- metaMDS(shared_abundant, previous.best = NMDS_ab, k=3, trace = F)
NMDS_ab

NMDSab_scores <- scores(NMDS_ab)

NMDS1_ab <- NMDSab_scores[ ,1]
NMDS2_ab <- NMDSab_scores[ ,2]

NMDSab_scores <- as.data.frame(NMDSab_scores)
```

Removing rare taxa reduced the total OTU number from `r length(colnames(shared))` to `r length(colnames(shared_abundant))`

There is still a significant difference in the community using only abundant taxa. 

###NMDS with Rare Taxa removed
```{r NMDS abundant plot1, include=T, echo = F}

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")
pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(x = NMDSab_scores$NMDS1, y = NMDSab_scores$NMDS2, pch = pchs[as.character(meta_alpha$Lineage)], 
      col = clrs[as.character(meta_alpha$Site)], cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS_ab, meta_alpha$Site == "BL", show.groups = TRUE, kind = "sd", col = "blue", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CB", show.groups = TRUE, kind = "sd", col = "red", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CH", show.groups = TRUE, kind = "sd", col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CM", show.groups = TRUE, kind = "sd", col = "coral", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CR", show.groups = TRUE, kind = "sd", col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "Rt2", show.groups = TRUE, kind = "sd", col = "dark gray", lty = 1, lwd = 2.0)

legend_text <- c("Bullard Lake", "Chelsea", "Cecil Bay", "Cheboygan Marsh", "Castle Rock", "Route 2", "Sturgeon Bay","Point LeBarb")
legend(1.08,1.08, legend_text, pch = 16, 
       col = c("blue","dark green","red","coral","black","gray","purple", "brown"), 
       pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(1.08,-0.685, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()

```
```{r NMDS abundant plot2, include=T, echo = F}

pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(x = NMDSab_scores$NMDS1, y = NMDSab_scores$NMDS2, pch = pchs[as.character(meta_alpha$Lineage)] , 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS_ab, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 2, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)

#legend_text <- c("Bullard Lake", "Cecil Bay", "Chelsea", "Cheboygan Marsh", "Castle Rock", "Point LeBarb", "Route 2", "Sturgeon Bay")
#legend("right", legend_text, pch = 15, 
  #     col = c("blue","red","dark green","coral","black","orange","gray","purple"))

legend_text2 <- c("Native", "Non-Native")
legend(1.08,1.08, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```
```{r NMDS abundant plot3, include=T, echo = F}

clrs2 <- c(UN = "black", SAT = "dark green", SAT_HI = "blue")

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(x = NMDSab_scores$NMDS1, y = NMDSab_scores$NMDS2, pch = 21 , 
      bg = clrs2[as.character(meta_alpha$Sat_lev)], cex = 1.5)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "UN", show.groups = TRUE, kind = "sd", col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "SAT", show.groups = TRUE, kind = "sd", col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "SAT_HI", show.groups = TRUE, kind = "sd", col = "blue", lty = 1, lwd = 2.0)

#legend_text <- c("Bullard Lake", "Cecil Bay", "Chelsea", "Cheboygan Marsh", "Castle Rock", "Point LeBarb", "Route 2", "Sturgeon Bay")
#legend("right", legend_text, pch = 15, 
  #     col = c("blue","red","dark green","coral","black","orange","gray","purple"))

legend_text2 <- c("Unsaturated", "Saturated", "Standing Water")
legend(1.08,1.08, legend_text2, pch = 21, pt.bg= c("black","dark green","blue"), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```

##Taxonomic Analysis

```{r Taxonomy setup, echo = F, include = F}
source("code/seqfun.R")

otu_phylum_genus <- tax_table("data/Bickford.cons.taxonomy", "UNITE")

shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


L <- otu_phylum_genus$otu %in% colnames(shared)
otu_phylum_genus <- otu_phylum_genus[L, ]
stopifnot(nrow(otu_phylum_genus)==ncol(shared))

# how do I get the otus from the Ascomycota?

pyth_otus <- otu_phylum_genus[otu_phylum_genus$genus == "Pythium", "otu"]
pyth_shared <- shared[ , pyth_otus]

# how do I combine the number of sequences from each of the Acomycota OTUs

    # in the below, 1 is for rows and 2 is for columns
phythium_count <- apply(pyth_shared, 1, sum)

# how do I repeat this for all phyla?
#make a loop

#need to know the phylum names - phylum_names / phylum_name
genus_names <- unique(otu_phylum_genus$genus)
# need somwhere to put data - allphylum_shared
n_gen <- length(genus_names)
n_samples <- nrow(shared)
allgen_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_gen))
rownames(allgen_shared) <- rownames(shared)
colnames(allgen_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- otu_phylum_genus[otu_phylum_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
    } else {
      genus_count <- genus_shared
    }
  allgen_shared[ , i] <- genus_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(allgen_shared, 1, sum)
genus_rel_abund <- allgen_shared / n_seqs

tot_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_rel_abund[h] <- y
}
sum(tot_rel_abund)

L <- order(tot_rel_abund, decreasing = T)
tot_rel_abund <- tot_rel_abund[L]

tot_rel_abund*100
```

```{r genus relative abundance, echo = F, include = T}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 0.5, 1 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = tot_rel_abund, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance")
axis(side = 2, las = 1, labels = c("Unclassified", "Pythium", "Phytophthora", "Saprolegnia", "Lagena", "Albugo"), at = c(0.7,1.9,3.1,4.3,5.5,6.7))
box()

```

```{r tax by lineage, echo = F, include = F}

SampleID <- rownames(allgen_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]


seqs <- apply(allgen_shared, 1, sum)
gen_ra <- allgen_shared / seqs
gen_ra <- data.frame(SampleID, gen_ra)

allgen_shared <- data.frame(SampleID, allgen_shared)

meta_top_gen <- inner_join(gen_ra, metadata, by = c( "SampleID" = "Code"))
meta_gen_shared <- inner_join(allgen_shared, metadata, by = c( "SampleID" = "Code"))


# 3. calculate the relative abundance for native
nat_shared <- meta_gen_shared[meta_gen_shared$Lineage == "Nat", ]
non_shared <- meta_gen_shared[meta_gen_shared$Lineage == "Inv", ]

nat_shared <- nat_shared[ ,2:6]
rownames(nat_shared) <- natID

non_shared <- non_shared[ ,2:6]
rownames(non_shared) <- nonID

nat_seqs <- apply(nat_shared, 1, sum)
nat_gen_rel_abund <- nat_shared / nat_seqs

nat_av_ra <- apply(nat_gen_rel_abund, 2, mean)
nat_sd_ra <- apply(nat_gen_rel_abund, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(nrow(nat_gen_rel_abund))


# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_gen_rel_abund <- non_shared / non_seqs

non_av_ra <- apply(non_gen_rel_abund, 2, mean)
non_sd_ra <- apply(non_gen_rel_abund, 2, sd)
non_se_ra <- non_sd_ra/sqrt(nrow(non_gen_rel_abund))

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_gen <- as.matrix(lin_rel_average)
top_av_gen <- t(top_av_gen)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra

an_ra_pyth <- aov(meta_top_gen$Pythium ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_pyth)

an_ra_unclass <- aov(meta_top_gen$unclassified ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_unclass)

an_ra_zygo <- aov(meta_top_gen$Phytophthora ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_zygo)

an_ra_roz <- aov(meta_top_gen$Lagena ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_roz)

an_ra_glom <- aov(meta_top_gen$Saprolegnia ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_glom)

an_ra_glom <- aov(meta_top_gen$Albugo ~ meta_top_gen$Site + meta_top_gen$Lineage + meta_top_gen$Sat_lev)
summary(an_ra_glom)

```

```{r top phylum plot, echo = F, include=T}
#png("fun_phylum_relabund.png", height = 6, width = 6, units = "in", res = 200)
quartz.options(height=6, width=6)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 3, 6))
par(xpd = NA)

plot.window(xlim = c(0,1), ylim = c(0,18))

barplot(height = top_av_gen, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))

arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_gen), at = c(2,5,8,11,14))


mtext("Significant Differences",side = 4, line = -2, las = 1, at = 20.5, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-0.5,2.7), at = 18.5, cex = 0.9)
arrows(x0 = c(1,1.2), y0 = 1, y1 = 17.5, angle = 0, lwd = 0.75)
mtext(c(".","ns","ns","ns","ns"), las = 1, side = 4, line = 3, at = c(2.5,5,8,11,14), cex = c(2,1,1,1,1,1))
mtext(c("ns","ns","ns","ns","ns"),side = 4, las = 1, at = c(2,5,8,11,14), line = 0.8, cex = 1)

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), bty = "n", cex = 1)
#dev.off()

```
```{r ANOVAs, echo = F, include = T}
library(car)
#Shannon
results <- lm(npshannon ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Chao
results <- lm(chao ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sobs
results <- lm(sobs ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

a1pts <- pcoa.pts[ , 1]

#PCoA Axis 1
results <- lm(a1pts ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

a2pts <- pcoa.pts[ , 2]

#PCoA Axis 2
results <- lm(a2pts ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Pith RA
results <- lm(Pythium ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Uncultured RA
results <- lm(unclassified ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Phytopthora RA
results <- lm(Phytophthora ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Lagena RA
results <- lm(Lagena ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Saprolegnia RA
results <- lm(Saprolegnia ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

##Albugi RA
results <- lm(Albugo ~  Lineage * Site, data = meta_top_gen, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Janthinobacterium RA
results <- lm(topgenus_ra$Janthinobacterium ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#rhizobium
results <- lm(topgenus_ra$Rhizobium ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#duganella
results <- lm(topgenus_ra$Duganella ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#tric RA
results <- lm(topgenus_ra$Trichococcus ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aeromonas
results <- lm(topgenus_ra$Aeromonas ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aerobe RA
results <- lm(bbase$Aerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#facan RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova


```
```{r regressions, echo = F, include = T}
library(pryr)
#percent col vs sat
meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)

#Shannon vs. sat

regnat.p2.1 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.1)
reginv.p2.1 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.1)


p2.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Shannon Diversity", las = 1)
 #  abline(regnat.p2.1, lty = 2)
 #  abline(reginv.p2.1)
 # # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p2.2 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.2)
reginv.p2.2 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.2)


p2.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.2, lty = 2)
  # abline(reginv.p2.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs N

regnat.p2.3 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.3)
reginv.p2.3 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.3)


p2.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.3, lty = 2)
  # abline(reginv.p2.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs. sat

regnat.p3.1 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.1)
reginv.p3.1 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.1)


p3.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.1, lty = 2)
  # abline(reginv.p3.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p3.2 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.2)
reginv.p3.2 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.2)


p3.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Chao Richness", las = 1)
  abline(regnat.p3.2, lty = 2)
  abline(reginv.p3.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs N

regnat.p3.3 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.3)
reginv.p3.3 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.3)


p3.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.3, lty = 2)
  # abline(reginv.p3.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs. sat

regnat.p4.1 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p4.1 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.1)


p4.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Oomycete Species Observed", las = 1)
  # abline(regnat.p4.1, lty = 2)
  # abline(reginv.p4.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs P

regnat.p4.2 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.2)
reginv.p4.2 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.2)


p4.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Oomycete Species Observed", las = 1)
  # abline(regnat.p4.2, lty = 2)
  # abline(reginv.p4.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#sobs vs N

regnat.p4.3 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.3)
reginv.p4.3 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.3)


p4.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Oomycete Species Observed", las = 1)
  # abline(regnat.p4.3, lty = 2)
  # abline(reginv.p4.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs. sat

a1pts <- pcoa.pts[ , 1]

regnat.p5.1 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p5.1 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.1)


p5.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.1, lty = 2)
  abline(reginv.p5.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs P

regnat.p5.2 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p5.2)
reginv.p5.2 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.2)


p5.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 1", las = 1)
  # abline(regnat.p5.2, lty = 2)
  # abline(reginv.p5.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs N

regnat.p5.3 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p5.3)
reginv.p5.3 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.3)


p5.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 1", las = 1)
  # abline(regnat.p5.3, lty = 2)
  # abline(reginv.p5.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs. sat

a2pts <- pcoa.pts[ , 2]

regnat.p6.1 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.1)
reginv.p6.1 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.1)


p6.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.1, lty = 2)
  # abline(reginv.p6.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs P

regnat.p6.2 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.2)
reginv.p6.2 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.2)


p6.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.2, lty = 2)
  # abline(reginv.p6.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs N

regnat.p6.3 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.3)
reginv.p6.3 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.3)


p6.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.3, lty = 2)
  # abline(reginv.p6.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}
```

```{r regression plots, echo = F, include = T}

# Display the saved plot

p2.1
p2.2
p2.3
p3.1
p3.2
p3.3
p4.1
p4.2
p4.3
p5.1
p5.2
p5.3
p6.1
p6.2
p6.3
```

```{r ANCOVAs, echo = F, include = T}



#Shannon
results <- lm(npshannon ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Chao
results <- lm(chao ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Sobs
results <- lm(sobs ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 1
results <- lm(a1pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 2
results <- lm(a2pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

```

```{r simper, include = T, echo = F}
simp <- simper(shared, meta_alpha$Lineage)
simpsum <- summary(simp, ordered = T)
top50 <- simpsum$Inv_Nat[c(1:50), ]
top50

```
