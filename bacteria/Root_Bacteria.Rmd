---
title: "Root_Bacteria"
author: "Wes Bickford"
date: "8/2/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
library(permute); library(vegan); library("dplyr"); library(knitr); library(MASS)
#source("data_setup.R")
```
#Root Bacteria Analysis

```{r Rarefaction setup, echo = F, include = F}
#source('data_setup.R')
#mean(metadata$n_seqs)

metadata <- read.csv(file = "data/15metadata.csv", stringsAsFactors = F)


rarefy <- read.table(file = "data/Bickford.groups.rarefaction", header=T, stringsAsFactors=F)

ave_columns <- grep(pattern = "X0", colnames(rarefy))
ave_rarefy <- rarefy[ , ave_columns]
reg <- "X0\\.\\d\\d\\.(\\w+\\d*\\w+\\d*)"
sample_id <- gsub(pattern = reg, "\\1", colnames(ave_rarefy))

numsampled <- rarefy$numsampled

colnames(ave_rarefy) <- sample_id

clrs <- c(BL = "grey", CB = "blue", CH = "red", CM = "coral", CR = "black", PLB = "orange", Rt2 = "green", SB = "purple")


```

##Rarefaction Curves

These are rarefaction curves for all samples. Samples were rarefied to 483 sequences as that was the lowest number at any site. 

```{r Rarefaction plot, echo = F, include = T}
plot(NA, type = "l",
     xlab = "Number of Sequences Sampled",
     ylab = "Number of OTUs Observed",
     ylim = c(0,350),
     xlim = c(0,2000)
     )
for(i in sample_id){
      points(ave_rarefy[ ,i] ~ numsampled, type= "l",
             col=clrs[metadata[metadata$Code==i, "Site"]],
             lwd = 2, lty = 1
       )
}
abline(v=483)
```

##Alpha Diversity 
```{r alpha setup1, echo = F, include = F}
alpha <- read.table(file = "data/Bickford.groups.ave-std.summary", header=T)

alpha_mean <- alpha[alpha$method == "ave", ]
alpha_mean$group <- as.character(alpha_mean$group)

meta_alpha <- inner_join(metadata, alpha_mean, by = c("Code"="group"))

meta_alpha$Lineage <- as.factor(meta_alpha$Lineage)
```

The following shows shannon diversity by lineage

```{r alpha plots1, echo = F, include = T}
clrs <- c(Nat = "white", Inv = "gray")

boxplot(npshannon ~ Lineage, data = meta_alpha,
        ylab = "Shannon Diversity Index",
        ylim = c(0,5.5), col = clrs[levels(meta_alpha$Lineage)],
        names = unique(meta_alpha$Lineage),
        range = 0)


```
##Alpha Diversity 
```{r alpha setup, echo = F, include = F}

# removing PLB and SB from this plot because there are no replicates
meta_alpha_sub <- meta_alpha[meta_alpha$Site != "SB" & meta_alpha$Site != "PLB", ]
meta_alpha_sub$Site <- as.character(meta_alpha_sub$Site)
meta_alpha_sub$Site <- as.factor(meta_alpha_sub$Site)
meta_alpha_sub$Lineage <- as.factor(meta_alpha_sub$Lineage)
```

The following shows shannon diversity by site and lineage


```{r alpha plots, echo = F, include = T}
clrs <- c(Nat = "white", Inv = "gray")

boxplot(npshannon ~ Lineage + Site, data = meta_alpha_sub,
        ylab = "Shannon Diversity Index",
        ylim = c(2,5), col = clrs[levels(meta_alpha_sub$Lineage)],
        names = F,
        range = 0, axes = F)
axis(1, at = c(1.5,3.5,5.5,7.5,9.5,11.5), labels = F)
axis(2)
mtext(side=1, at=c(1.5,3.5,5.5,7.5,9.5,11.5), line=0.5, text = unique(meta_alpha_sub$Site), cex = 1, font = 2)
box()

legend("bottomright", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"))

```

```{r ANOVA shannon, echo = F, include = T}
shanmed <- tapply(meta_alpha$npshannon, meta_alpha$Lineage, median)
w <- meta_alpha$npshannon - shanmed[meta_alpha$Lineage]
plot(w ~ Lineage, data = meta_alpha)
#variances equal
qqnorm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"], datax = T)
qqline(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"], datax = T)

qreference(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"], nrep = 8)

qqnorm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"], datax = T)
qqline(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"], datax = T)

qreference(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"], nrep = 8)

#Now for Sites
shanmed <- tapply(meta_alpha$npshannon, meta_alpha$Site, median)
w <- meta_alpha$npshannon - shanmed[meta_alpha$Site]
#plot(w ~ Site, data = meta_alpha)
#variances equal
qqnorm(meta_alpha$npshannon[meta_alpha$Site == "BL"], datax = T)
qqline(meta_alpha$npshannon[meta_alpha$Site == "BL"], datax = T)

qreference(meta_alpha$npshannon[meta_alpha$Site == "BL"], nrep = 8)

qqnorm(meta_alpha$npshannon[meta_alpha$Site == "CH"], datax = T)
qqline(meta_alpha$npshannon[meta_alpha$Site == "CH"], datax = T)

qreference(meta_alpha$npshannon[meta_alpha$Site == "CH"], nrep = 8)

an_shannon <- aov(npshannon ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_shannon)

shan_mean<- tapply(meta_alpha$npshannon, meta_alpha$Lineage, FUN = "mean")
shan_mean
shan_sd<- tapply(meta_alpha$npshannon, meta_alpha$Lineage, FUN = "sd")
shan_sd

an_chao <- aov(chao ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_chao)

chao_mean<- tapply(meta_alpha$chao, meta_alpha$Lineage, FUN = "mean")
chao_mean
chao_sd<- tapply(meta_alpha$chao, meta_alpha$Lineage, FUN = "sd")
chao_sd

an_sobs <- aov(sobs ~ Site + Sat_lev + Lineage, data = meta_alpha)
summary(an_sobs)

sobs_mean<- tapply(meta_alpha$sobs, meta_alpha$Lineage, FUN = "mean")
sobs_mean
sobs_sd<- tapply(meta_alpha$sobs, meta_alpha$Lineage, FUN = "sd")
sobs_sd

```

Normality tests show that variances are equal. Native samples tended towards non-narmality, but not significantly. Invasive samples fit a normal distribution quite well.

By site, variances are equal, but normal distributions dont fit well. Since anova is faily robust against non-normality, it is still used. 

Anova was not significant by Lineage, but was by site. There is also a significant interaction between site and lineage. See boxplot in previous chunk

##Community Analysis
###PerManova

The following is a PerMANOVA of OTUs by site and Lineage

```{r permanova1, include=T, echo = F, results = 'hold'}
shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
meta_alpha$Site <- as.factor(meta_alpha$Site)
meta_alpha$Lineage <- as.factor(meta_alpha$Lineage)
meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)
meta_alpha$SoilC <- as.numeric(meta_alpha$SoilC)
meta_alpha$TisN <- as.numeric(meta_alpha$TisN)
meta_alpha$TisP <- as.numeric(meta_alpha$TisP)
meta_alpha$TisC <- as.numeric(meta_alpha$TisC)
meta_alpha$Sat_lev <- as.factor(meta_alpha$Sat_lev)
meta_alpha$Sat <- as.numeric(meta_alpha$Sat)
meta_alpha$Lat <- as.factor(meta_alpha$Lat)

shared <- shared[ ,-c(1,2)]

permbac <- adonis(wisconsin(sqrt(shared)) ~ Site + Sat_lev + Lineage, data=meta_alpha, method = "bray", by = NULL)
permbac

permbac <- adonis(wisconsin(sqrt(shared)) ~ Site + Lineage + Sat_lev, data=meta_alpha, method = "bray", by = NULL)
permbac

permbac2 <- adonis2(shared ~ Lat + Lineage + Sat_lev + Site +  Sat_lev:Lineage, data=meta_alpha, method = "bray")
permbac2

```


There is a significant *site* effect, *Lineage* effect and *Saturation Level* effect. 

###PCoA

```{r PCoA fungi, echo = F, include = T}
braybac <- vegdist(sqrt(shared), method = "bray")
pcoa.bac <- cmdscale(braybac, k=(NROW(shared)-1), eig = TRUE, add = TRUE)
pcoa.pts <- as.data.frame(pcoa.bac["points"])
pcoa.eig <- eigenvals(pcoa.bac)
var.axes <- pcoa.eig/sum(pcoa.eig)
var.axes

meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)
meta_alpha$SoilC <- as.numeric(meta_alpha$SoilC)
meta_alpha$TisN <- as.numeric(meta_alpha$TisN)
meta_alpha$TisP <- as.numeric(meta_alpha$TisP)
meta_alpha$TisC <- as.numeric(meta_alpha$TisC)
meta_alpha$Sat <- as.numeric(meta_alpha$Sat)
meta_alpha$Sat_lev <- as.factor(meta_alpha$Sat_lev)
meta_alpha$Lat <- as.factor(meta_alpha$Lat)

ef <- envfit(pcoa.bac, meta_alpha[ , c(3,7,9:10)], na.rm = T)
ef

```

```{r pcoa plot, include=T, echo = F}

pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
par(xpd = NA)
plot.window(xlim = c(-0.5,0.5), ylim = c(-0.5,0.5))
axis(side = 1)
axis(side = 2, las = 1)
points(x = pcoa.pts[ , 1], y = pcoa.pts[ ,2], asp = 1, pch = pchs[as.character(meta_alpha$Lineage)], 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "PCo 1 (15.2%)")
mtext(side = 2, line = 3, text = "PCo 2 (7.7%)" )



#ordiellipse(pcoa.bac, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 1, lwd = 2.0)
#ordiellipse(pcoa.bac, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 2, lwd = 2.0)


plot(ef, p.max = 0.1, col = "black")

#legend_text3 <- c("Unsaturated", "Saturated", "High Water")
#legend(0.54, 0.54, legend_text3, pch = 16, col = c("brown", "dark green", "blue"), pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(0.54, 0.54, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()
```

###NMDS

```{r NMDS, include = F, echo = F}

NMDS <- metaMDS(shared, k=3, trace = F)
NMDS
NMDS <- metaMDS(shared, previous.best = NMDS, k=3, trace = F)
NMDS

NMDS_scores <- scores(NMDS)

NMDS1 <- NMDS_scores[ ,1]
NMDS2 <- NMDS_scores[ ,2]

NMDS_scores <- as.data.frame(NMDS_scores)

ef <- envfit(NMDS, meta_alpha[ , c(7,9:10)], na.rm = T)
ef


```

The following is an NMDS (stress = `r NMDS$stress`) showing Lineage as different shapes and site by color. The ellipses are sd by site. 

```{r NMDS plot, include=T, echo = F}

clrs <- c(SAT_HI = "blue", SAT = "dark green", UN = "brown")
pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
par(xpd = NA)
plot.window(xlim = c(-0.25,0.25), ylim = c(-0.25,0.25))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS, "sites", pch = pchs[as.character(meta_alpha$Lineage)], 
      col = clrs[as.character(meta_alpha$Sat_lev)], cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 1, lwd = 2.0)
ordiellipse(NMDS, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", col = "black", conf = 0.95, lty = 2, lwd = 2.0)

plot(ef, p.max = 0.1, col = "black")

mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.147")


legend_text <- c("Site             P=0.001", "Lineage      P=0.776")
legend(0, -0.14, legend_text, pch = NULL, xpd = T, title = "Significance", cex = 0.8, bty = "n", xjust = 0.5) 

legend_text2 <- c("Native", "Non-Native")
legend(0.27, -0.14, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text3 <- c("Unsaturated", "Saturated", "High Water")
legend(0.27, 0.27, legend_text3, pch = 16, col = c("brown", "dark green", "blue"), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()

```
```{r NMDS plot by lineage, include=T, echo = F}

pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-0.25,0.25), ylim = c(-0.25,0.25))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS, "sites", pch = pchs[as.character(meta_alpha$Lineage)] , 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )
#plot(ef, p.max = 0.1, col = "pink")
mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.147")

ordiellipse(NMDS, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 2, lwd = 2.0)
ordiellipse(NMDS, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)

legend_text2 <- c("Native", "Non-Native")
legend(0.28,0.28, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```
```{r NMDS plot by sat level, include=T, echo = F}

clrs2 <- c(UN = "black", SAT = "dark green", SAT_HI = "blue")

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
par(xpd = NA)
plot.window(xlim = c(-0.25,0.25), ylim = c(-0.25,0.25))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS, "sites", pch = 21 , 
      bg = clrs2[as.character(meta_alpha$Sat_lev)], cex = 1.5)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )
mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.147")

ordiellipse(NMDS, meta_alpha$Sat_lev == "UN", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS, meta_alpha$Sat_lev == "SAT", show.groups = TRUE, kind = "se", conf = 0.95, col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS, meta_alpha$Sat_lev == "SAT_HI", show.groups = TRUE, kind = "se", conf = 0.95, col = "blue", lty = 1, lwd = 2.0)

legend_text2 <- c("Unsaturated", "Saturated", "Standing Water")
legend(0.27,0.27, legend_text2, pch = 21, pt.bg= c("black","dark green","blue"), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()

```

```{r simper, include = T, echo = F}
simp <- simper(shared, meta_alpha$Lineage)
simpsum <- summary(simp, ordered = T)
topten <- simpsum$Inv_Nat[c(1:10), ]
topten

```




```{r, PCoA, echo = F, include = T}
pcoa <- read.table(file="data/Bickford.braycurtis.pcoa.axes", header=T)

site_color <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")
pchs <- c(Nat = 22, Inv = 24)
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 2, 9 ))
par(xpd = NA)

plot(x=pcoa$axis1, y=pcoa$axis3, xlab="PCo Axis 1", ylab="PCo Axis 3",
            xlim=c(-0.4, 0.4), ylim=c(-0.5, 0.4), pch=pchs[as.character(meta_alpha$Lineage)], col="black", bg=site_color[as.character(meta_alpha$Site)], lwd=1, cex=(pcoa$axis2+1),
            main="PCoA of BrayCurtis Distances Between Root Samples")

legend_text <- c("Bullard Lake", "Chelsea", "Cecil Bay", "Cheboygan Marsh", "Castle Rock", "Route 2", "Sturgeon Bay","Point LeBarb")
legend(0.44,0.44, legend_text, pch = 16, 
       col = c("blue","dark green","red","coral","black","gray","purple", "brown"), 
       pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(0.44, -0.24, legend_text2, pch = c(15,17), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()

```
###Remove rare taxa

I removed rare taxa using relative abundance data. Any OTU that made up less than 0.1% of the total sequences was removed. This is more stringent than removing singletons, but ensures that rare taxa are not responsible for site effects. The following are results of a permanova of only abundant taxa by site and lineage. 
```{r, Permanova abundant, echo = F, include = T}
library(ape)

shared <- read.table(file="data/Bickford.subsample.shared", header=T, stringsAsFactors=F, row.names=2)
shared <- shared[,-c(1,2)]

rel_abund <- shared / apply(shared, 1, sum)
mean_rel_abund <- apply(rel_abund, 2, mean)
otu_order <- order(mean_rel_abund, decreasing=T)
rel_abund <- rel_abund[,otu_order]

stopifnot(rownames(shared) == metadata$sampleID)

mean_rel_abund <- apply(rel_abund, 2, mean)
abundant <- mean_rel_abund > 0.001
rel_abund_subset <- rel_abund[, abundant]
shared_abundant <- shared[ , abundant]

write.table(shared_abundant, "data/bac_abund_otus.txt", quote = F, sep = "\t", row.names = T)

permabundant <- adonis(shared_abundant ~ Site + Sat_lev + Lineage, data = meta_alpha)
permabundant
```
```{r pcoa abundant, include = T, echo = F}
ab_dist <- vegdist(shared_abundant, method = "bray")
pcoa_ab <- pcoa(ab_dist)
pcoa_ab_vecs <- as.data.frame(pcoa_ab$vectors)

site_color <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")
pchs <- c(Nat = 22, Inv = 24)
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 2, 9 ))
par(xpd = NA)

plot(x = pcoa_ab_vecs$Axis.1, y = pcoa_ab_vecs$Axis.2, xlab="PCo Axis 1", ylab="PCo Axis 2", xlim=c(-0.4, 0.4), ylim=c(-0.6, 0.3), pch=pchs[as.character(meta_alpha$Lineage)], col="black", bg=site_color[as.character(meta_alpha$Site)], lwd=1, cex=(pcoa_ab_vecs$Axis.3+1),
            main="PCoA of BrayCurtis Distances Between Root Samples")
legend_text <- c("Bullard Lake", "Chelsea", "Cecil Bay", "Cheboygan Marsh", "Castle Rock", "Route 2", "Sturgeon Bay","Point LeBarb")
legend(0.44,0.34, legend_text, pch = 16, 
       col = c("blue","dark green","red","coral","black","gray","purple", "brown"), 
       pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(0.44, -0.34, legend_text2, pch = c(15,17), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()
```

```{r NMDS abundant, include = F, echo = F}
NMDS_ab <- metaMDS(shared_abundant, trymax = 100, k=3, trace = F)
NMDS_ab
NMDS_ab <- metaMDS(shared_abundant, previous.best = NMDS_ab, k=3, trace = F)
NMDS_ab

NMDSab_scores <- scores(NMDS_ab)

NMDS1_ab <- NMDSab_scores[ ,1]
NMDS2_ab <- NMDSab_scores[ ,2]

NMDSab_scores <- as.data.frame(NMDSab_scores)

ef <- envfit(NMDS_ab, meta_alpha[ , c(6:14)], na.rm = T)
ef
```

Removing rare taxa reduced the total OTU number from `r length(colnames(shared))` to `r length(colnames(shared_abundant))`

There is still a significant difference in the community using only abundant taxa. 

###NMDS with Rare Taxa removed
```{r NMDS abundant plot1, include=T, echo = F}

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")
pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS_ab, "sites", pch = pchs[as.character(meta_alpha$Lineage)], 
      col = clrs[as.character(meta_alpha$Site)], cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS_ab, meta_alpha$Site == "BL", show.groups = TRUE, kind = "se", conf = 0.95, col = "blue", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CB", show.groups = TRUE, kind = "se", conf = 0.95, col = "red", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CH", show.groups = TRUE, kind = "se", conf = 0.95, col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CM", show.groups = TRUE, kind = "se", conf = 0.95, col = "coral", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "CR", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Site == "Rt2", show.groups = TRUE, kind = "se", conf = 0.95, col = "dark gray", lty = 1, lwd = 2.0)

mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.139")
plot(ef, p.max = 0.1, col = "pink")

legend_text <- c("Bullard Lake", "Chelsea", "Cecil Bay", "Cheboygan Marsh", "Castle Rock", "Route 2", "Sturgeon Bay","Point LeBarb")
legend(1.08,1.08, legend_text, pch = 16, 
       col = c("blue","dark green","red","coral","black","gray","purple", "brown"), 
       pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(1.08,-0.5, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```
```{r NMDS abundant plot2, include=T, echo = F}

pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS_ab, "sites", pch = pchs[as.character(meta_alpha$Lineage)] , 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )
plot(ef, p.max = 0.1, col = "pink")
mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.139")

ordiellipse(NMDS_ab, meta_alpha$Lineage == "Nat", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 2, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Lineage == "Inv", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)

legend_text2 <- c("Native", "Non-Native")
legend(1.08,1.08, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```
```{r NMDS abundant plot3, include=T, echo = F}

clrs2 <- c(UN = "black", SAT = "dark green", SAT_HI = "blue")

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-1,1), ylim = c(-1,1))
axis(side = 1)
axis(side = 2, las = 1)
points(NMDS_ab, "sites", pch = 21 , 
      bg = clrs2[as.character(meta_alpha$Sat_lev)], cex = 1.5)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )
mtext(side = 3, line = -1, at = 0, las = 1, text = "Stress = 0.139")

ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "UN", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "SAT", show.groups = TRUE, kind = "se", conf = 0.95, col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS_ab, meta_alpha$Sat_lev == "SAT_HI", show.groups = TRUE, kind = "se", conf = 0.95, col = "blue", lty = 1, lwd = 2.0)

legend_text2 <- c("Unsaturated", "Saturated", "Standing Water")
legend(1.08,1.08, legend_text2, pch = 21, pt.bg= c("black","dark green","blue"), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()


```
I also performed a Kruskal-Wallace test to see if the relative abundance of any individual taxon differed by site or lineage. All tests were non-significant indicating that no individual otu relative abundances are significantly different by site or lineage 


##Taxonomic Analysis

```{r Taxonomy setup, echo = F, include = F}
source("code/seqfun.R")

taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")

shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))

# how do I get the otus from the Proteobacteria?

proteo_otus <- taxonomy[taxonomy$phylum == "Proteobacteria", "otu"]
proteo_shared <- shared[ , proteo_otus]

# how do I combine the number of sequences from each of the Proteobacteria OTUs

    # in the below, 1 is for rows and 2 is for columns
proteo_count <- apply(proteo_shared, 1, sum)

# how do I repeat this for all phyla?
#make a loop

#need to know the phylum names - phylum_names / phylum_name
phylum_names <- unique(taxonomy$phylum)
# need somwhere to put data - allphylum_shared
n_phyla <- length(phylum_names)
n_samples <- nrow(shared)
allphylum_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_phyla))
rownames(allphylum_shared) <- rownames(shared)
colnames(allphylum_shared) <- phylum_names

#my loop
for(i in phylum_names){
  phylum_otus <- taxonomy[taxonomy$phylum == i, "otu"]
  phylum_shared <- shared[ , phylum_otus]
  if(length(phylum_otus) > 1){
    phylum_count <- apply(phylum_shared, 1, sum)
    } else {
      phylum_count <- phylum_shared
    }
  allphylum_shared[ , i] <- phylum_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(allphylum_shared, 1, sum)
phylum_rel_abund <- allphylum_shared / n_seqs[1]

tot_rel_abund <- numeric()
for(h in colnames(phylum_rel_abund)){
  y <- mean(phylum_rel_abund[ ,h])
  tot_rel_abund[h] <- y
}
sum(tot_rel_abund)
```
###By Phylum

The following show all bacterial Phyla by relative sequence abundance

```{r Phylum relative abundance, echo = F, include = T}
barplot(height = tot_rel_abund[1:4], beside = T)
```

```{r tax by lineage, echo = F, include = F}
SampleID <- rownames(allphylum_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]

allphylum_shared <- data.frame(SampleID, allphylum_shared)
meta_phylum_shared <- inner_join(allphylum_shared, metadata, by = c( "SampleID" = "Code"))

nat_shared <- meta_phylum_shared[meta_phylum_shared$Lineage == "Nat", ]
non_shared <- meta_phylum_shared[meta_phylum_shared$Lineage == "Inv", ]

nat_shared <- nat_shared[ ,2:5]
rownames(nat_shared) <- natID
non_shared <- non_shared[ ,2:5]
rownames(non_shared) <- nonID


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_shared, 1, sum)
nat_phylum_rel_abund <- nat_shared / nat_seqs[1]

nat_rel_abund <- numeric()
for(h in colnames(nat_phylum_rel_abund)){
  y <- mean(nat_phylum_rel_abund[ ,h])
  nat_rel_abund[h] <- y
}
sum(nat_rel_abund)

# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_phylum_rel_abund <- non_shared / non_seqs[1]

non_rel_abund <- numeric()
for(h in colnames(non_phylum_rel_abund)){
  y <- mean(non_phylum_rel_abund[ ,h])
  non_rel_abund[h] <- y
}
sum(non_rel_abund)

lin_rel_abund <- data.frame(Native = nat_rel_abund, NonNative = non_rel_abund)

top_phyla <- as.matrix(lin_rel_abund)
top_phyla <- t(top_phyla)
```

```{r tax by lineage with stats, echo = F, include = F}

topphyla_shared <- allphylum_shared[2:5]

seqs <- apply(topphyla_shared, 1, sum)
topphyla_ra <- topphyla_shared / seqs
topphyla_ra <- data.frame(SampleID, topphyla_ra)

meta_top_phyla <- inner_join(topphyla_ra, metadata, by = c( "SampleID" = "Code"))


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_shared, 1, sum)
nat_phylum_rel_abund <- nat_shared / nat_seqs

nat_av_ra <- apply(nat_phylum_rel_abund, 2, mean)
nat_sd_ra <- apply(nat_phylum_rel_abund, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(25)


# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_phylum_rel_abund <- non_shared / non_seqs

non_av_ra <- apply(non_phylum_rel_abund, 2, mean)
non_sd_ra <- apply(non_phylum_rel_abund, 2, sd)
non_se_ra <- non_sd_ra/sqrt(24)

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_phyla <- as.matrix(lin_rel_average)
top_av_phyla <- t(top_av_phyla)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra

lin_rel_se <- data.frame(Native = nat_se_ra, NonNative = non_se_ra)

top_se_phyla <- as.matrix(lin_rel_se)
top_se_phyla <- t(top_se_phyla)

an_ra_pro <- aov(meta_top_phyla$Proteobacteria ~ meta_top_phyla$Site + meta_top_phyla$Lineage * meta_top_phyla$Sat_lev)
summary(an_ra_pro)

an_ra_fir <- aov(meta_top_phyla$Firmicutes ~ meta_top_phyla$Site + meta_top_phyla$Lineage * meta_top_phyla$Sat_lev)
summary(an_ra_fir)

an_ra_bac <- aov(meta_top_phyla$Bacteroidetes ~ meta_top_phyla$Site + meta_top_phyla$Lineage * meta_top_phyla$Sat_lev)
summary(an_ra_bac)

an_ra_act <- aov(meta_top_phyla$Actinobacteria ~ meta_top_phyla$Site + meta_top_phyla$Lineage * meta_top_phyla$Sat_lev)
summary(an_ra_act)

```



```{r top phylum plot, echo = F, include=T}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1.4), ylim = c(-1,1))

barplot(height = top_av_phyla, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_phyla), at = c(2,5,8,11))

mtext("P-Values",side = 4, line = 1, las = 1, at = 13.5, cex = 1)
mtext(c("Lineage","Site","L X S"),side = 4, las = 1, line = c(-0.5,3,6), at = 12.5, cex = 0.9)

arrows(x0 = 1.25, y0 = 1, y1 = 12, angle = 90, length = 0.5, lwd = 0.75)
arrows(x0 = 1.55, y0 = 1, y1 = 12, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("0.257","0.352","<0.001","0.045"),side = 4, line = 3, at = c(2,5,8,11), las = 1, cex = 0.8)
mtext(c("0.021","0.238","0.008","0.611"),side = 4, line = 0, at = c(2,5,8,11), las = 1, cex = 0.8)
mtext(c("0.250","0.143","0.114","0.001"),side = 4, line = 6, at = c(2,5,8,11), las = 1, cex = 0.8)


legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r Taxonomy setup abundant, echo = F, include = F}

L <- taxonomy$otu %in% colnames(shared_abundant)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared_abundant))

# how do I get the otus from the Proteobacteria?

proteo_otus <- taxonomy[taxonomy$phylum == "Proteobacteria", "otu"]
proteo_shared_ab <- shared_abundant[ , proteo_otus]

# how do I combine the number of sequences from each of the Proteobacteria OTUs

    # in the below, 1 is for rows and 2 is for columns
proteo_count <- apply(proteo_shared_ab, 1, sum)

# how do I repeat this for all phyla?
#make a loop

#need to know the phylum names - phylum_names / phylum_name
phylum_names <- unique(taxonomy$phylum)
# need somwhere to put data - allphylum_shared
n_phyla <- length(phylum_names)
n_samples <- nrow(shared_abundant)
allphylum_shared_ab <- data.frame(matrix(0, nrow = n_samples, ncol = n_phyla))
rownames(allphylum_shared_ab) <- rownames(shared_abundant)
colnames(allphylum_shared_ab) <- phylum_names

#my loop
for(i in phylum_names){
  phylum_otus <- taxonomy[taxonomy$phylum == i, "otu"]
  phylum_shared <- shared_abundant[ , phylum_otus]
  if(length(phylum_otus) > 1){
    phylum_count <- apply(phylum_shared, 1, sum)
    } else {
      phylum_count <- phylum_shared
    }
  allphylum_shared_ab[ , i] <- phylum_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(allphylum_shared_ab, 1, sum)
phylum_rel_abund <- allphylum_shared_ab / n_seqs

tot_rel_abund <- numeric()
for(h in colnames(phylum_rel_abund)){
  y <- mean(phylum_rel_abund[ ,h])
  tot_rel_abund[h] <- y
}
sum(tot_rel_abund)
```

The following show all bacterial Phyla by relative sequence abundance

```{r Phylum relative abundance in abundant taxa, echo = F, include = T}
barplot(height = tot_rel_abund[1:4], beside = T)
```

Proteobacteria makes up `r (tot_rel_abund['Proteobacteria'])*100`% of the total sequences!

###By Genus

```{r Rel abund setup (genus), echo = F, include = F}

taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")

shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))

otu_proteo_genus <- taxonomy[taxonomy$phylum == "Proteobacteria", ]

#make a loop

#need to know the genus names within proteobacteria
genus_names <- unique(otu_proteo_genus$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(proteo_shared)
proteo_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(proteo_genera_shared) <- rownames(proteo_shared)
colnames(proteo_genera_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- otu_proteo_genus[otu_proteo_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  proteo_genera_shared[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
n_seqs <- apply(proteo_genera_shared, 1, sum)
genus_rel_abund <- proteo_genera_shared / n_seqs

tot_genus_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_genus_rel_abund[h] <- y
}
sum(tot_genus_rel_abund)
tot_genus_rel_abund

L <- sort.list(tot_genus_rel_abund, decreasing = T)
tot_genus_rel_abund <- tot_genus_rel_abund[L]

genus_names <- unique(otu_proteo_genus$genus)
cl_genus_names <- genus_names[genus_names != "unclassified"]
# need somwhere to put data - asco_genera_shared
n_genera <- length(cl_genus_names)
n_samples <- nrow(proteo_shared)
proteo_cl_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(proteo_cl_genera_shared) <- rownames(proteo_shared)
colnames(proteo_cl_genera_shared) <- cl_genus_names

#my loop
for(i in cl_genus_names){
  genus_otus <- otu_proteo_genus[otu_proteo_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  proteo_cl_genera_shared[ , i] <- genus_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(proteo_cl_genera_shared, 1, sum)
cl_genus_rel_abund <- proteo_cl_genera_shared / n_seqs

tot_cl_genus_rel_abund <- numeric()
for(h in colnames(cl_genus_rel_abund)){
  y <- mean(cl_genus_rel_abund[ ,h])
  tot_cl_genus_rel_abund[h] <- y
}
sum(tot_cl_genus_rel_abund)

L <- sort.list(tot_cl_genus_rel_abund, decreasing = T)
tot_cl_genus_rel_abund <- tot_cl_genus_rel_abund[L]

top_genera_rel_abund <- tot_cl_genus_rel_abund[tot_cl_genus_rel_abund >= 0.01]

```

The following is a plot of relative abundance by genus within Proteobacteria. I have removed all genera that were unclassified. Unclassified genera made up `r tot_genus_rel_abund['unclassified']*100`% of the total Proteobacteria  
Only the genera with a relative abundance more than 1% of classified genera are displayed here. Only the top 5 are graphed.

```{r Rel abund by Genus plot1, echo=F, include = T}
top_genera_rel_abund


barplot(height = top_genera_rel_abund[1:5], beside = T)

```
```{r genus by lin, echo = F, include = F}
# 3. calculate the relative abundance
SampleID <- rownames(proteo_genera_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]


nat_shared <- proteo_genera_shared[natID, ]
non_shared <- proteo_genera_shared[nonID, ]


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_shared, 1, sum)
nat_genus_rel_abund <- nat_shared / nat_seqs

nat_rel_abund <- numeric()
for(h in colnames(nat_genus_rel_abund)){
  y <- mean(nat_genus_rel_abund[ ,h])
  nat_rel_abund[h] <- y
}
sum(nat_rel_abund)

# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_genus_rel_abund <- non_shared / non_seqs

non_rel_abund <- numeric()
for(h in colnames(non_genus_rel_abund)){
  y <- mean(non_genus_rel_abund[ ,h])
  non_rel_abund[h] <- y
}
sum(non_rel_abund)

top_nat_rel_abund <- nat_rel_abund[1:5]
top_non_rel_abund <- non_rel_abund[1:5]

top_nat_rel_abund
top_non_rel_abund

top_rel_abund <- data.frame(Native = top_nat_rel_abund, NonNative = top_non_rel_abund)

top_genus <- as.matrix(top_rel_abund)
top_genus <- t(top_genus)

```

```{r genus by lin for stats, echo = F, include = F}
# 3. calculate the relative abundance

topgenus_ra <- cl_genus_rel_abund[1:5]
topgenus_ra <- data.frame(SampleID, topgenus_ra)

meta_top_genus <- inner_join(topgenus_ra, metadata, by = c( "SampleID" = "Code"))
rownames(meta_top_genus) <- meta_top_genus$SampleID

nat_genusra <- meta_top_genus[natID, ]
non_genusra <- meta_top_genus[nonID, ]


nat_av_ra <- apply(nat_genusra[2:6], 2, mean)
nat_sd_ra <- apply(nat_genusra[2:6], 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(25)

non_av_ra <- apply(non_genusra[2:6], 2, mean)
non_sd_ra <- apply(non_genusra[2:6], 2, sd)
non_se_ra <- non_sd_ra/sqrt(24)

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_genus <- as.matrix(lin_rel_average)
top_av_genus <- t(top_av_genus)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


an_ra_sudo <- aov(meta_top_genus$Pseudomonas ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_sudo)

an_ra_jan <- aov(meta_top_genus$Janthinobacterium ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_jan)

an_ra_aer <- aov(meta_top_genus$Aeromonas ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_aer)

an_ra_dug <- aov(meta_top_genus$Duganella ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_dug)

an_ra_rah <- aov(meta_top_genus$Rahnella ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_rah)

```

```{r Rel abund by Genus and Lin, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,0.7), ylim = c(-1,1))

barplot(height = top_av_genus, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.7), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_genus), at = c(2,5,8,11,14))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 17, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 15.5, cex = 0.9)

arrows(x0 = 0.82, y0 = 1, y1 = 14.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("***","*","ns","*","*"), side = 4, line = 3, at = c(1.33,4.33,8,10.33,13.33), las = 1, cex = c(2,2,1,2,2))
mtext(c("*","ns","*", "ns", "ns"),side = 4, line = 0, at = c(1.33,5,7.33,11,14), las = 1, cex = c(2,1,2,1,1))

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```
```{r Rel abund setup (Firmicutes), echo = F, include = F}

taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")

L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))


shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))

otu_firm_genus <- taxonomy[taxonomy$phylum == "Firmicutes", ]
firm_shared <- shared[ , otu_firm_genus$otu]

#make a loop

#need to know the genus names within proteobacteria
genus_names <- unique(otu_firm_genus$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(firm_shared)
firm_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(firm_genera_shared) <- rownames(firm_shared)
colnames(firm_genera_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- otu_firm_genus[otu_firm_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  firm_genera_shared[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
firm_seqs <- apply(firm_genera_shared, 1, sum)
no_firm <- names(firm_seqs[firm_seqs == 0])
with_firm <- names(firm_seqs[firm_seqs != 0])
firm_genera_shared <- firm_genera_shared[with_firm , ]


n_seqs <- apply(firm_genera_shared, 1, sum)
genus_rel_abund <- firm_genera_shared / n_seqs

tot_genus_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_genus_rel_abund[h] <- y
}
sum(tot_genus_rel_abund)
tot_genus_rel_abund

L <- sort.list(tot_genus_rel_abund, decreasing = T)
tot_genus_rel_abund <- tot_genus_rel_abund[L]



top_genera_rel_abund <- tot_genus_rel_abund[tot_genus_rel_abund >= 0.01]

```


```{r firmicutes genus by lin, echo = F, include = F}
# 3. calculate the relative abundance
SampleID <- rownames(firm_genera_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]


nat_shared <- firm_genera_shared[natID, ]
non_shared <- firm_genera_shared[nonID, ]

firm_seqs <- apply(firm_genera_shared, 2, sum)
L <- order(firm_seqs, decreasing = T)
firm_seqs <- firm_seqs[L]
top_firms <- names(firm_seqs[1:5])


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_shared, 1, sum)
nat_genus_rel_abund <- nat_shared / nat_seqs

nat_rel_abund <- numeric()
for(h in colnames(nat_genus_rel_abund)){
  y <- mean(nat_genus_rel_abund[ ,h])
  nat_rel_abund[h] <- y
}
sum(nat_rel_abund)

# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
no_firm <- names(non_seqs[non_seqs == 0])
with_firm <- names(non_seqs[non_seqs != 0])
non_shared <- non_shared[with_firm , ]
non_seqs <- apply(non_shared, 1, sum)


non_genus_rel_abund <- non_shared / non_seqs

non_rel_abund <- numeric()
for(h in colnames(non_genus_rel_abund)){
  y <- mean(non_genus_rel_abund[ ,h])
  non_rel_abund[h] <- y
}
sum(non_rel_abund)

top_nat_rel_abund <- nat_rel_abund[top_firms]
top_non_rel_abund <- non_rel_abund[top_firms]

top_nat_rel_abund
top_non_rel_abund

top_rel_abund <- data.frame(Native = top_nat_rel_abund, NonNative = top_non_rel_abund)

top_genus <- as.matrix(top_rel_abund)
top_genus <- t(top_genus)

```

```{r firm genus by lin for stats, echo = F, include = F}
# 3. calculate the relative abundance
firm_SampleID <- SampleID[SampleID = with_firm]

topgenus_ra <- genus_rel_abund[top_firms]
SampleID <- rownames(topgenus_ra)
topgenus_ra <- data.frame(SampleID, topgenus_ra)

meta_top_genus <- inner_join(topgenus_ra, metadata, by = c( "SampleID" = "Code"))
rownames(meta_top_genus) <- meta_top_genus$SampleID

nat_genusra <- meta_top_genus[natID, ]
non_with_firm <- nonID %in% with_firm
nonID <- nonID[non_with_firm]
non_genusra <- meta_top_genus[nonID, ]

nat_av_ra <- apply(nat_genusra[2:6], 2, mean)
nat_sd_ra <- apply(nat_genusra[2:6], 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(25)

non_av_ra <- apply(non_genusra[2:6], 2, mean)
non_sd_ra <- apply(non_genusra[2:6], 2, sd)
non_se_ra <- non_sd_ra/sqrt(24)

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_genus <- as.matrix(lin_rel_average)
top_av_genus <- t(top_av_genus)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


an_ra_exi <- aov(meta_top_genus$Exiguobacterium ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_exi)

an_ra_tric <- aov(meta_top_genus$Trichococcus ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_tric)

an_ra_paen <- aov(meta_top_genus$Paenibacillus ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_paen)

an_ra_clos <- aov(meta_top_genus$Clostridium_sensu_stricto_1 ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_clos)

an_ra_carn <- aov(meta_top_genus$Carnobacterium ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_carn)

```

```{r Rel abund by Firm Genus and Lin, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 12, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = top_av_genus, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.4), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
axis(side = 2, las = 1, labels = colnames(top_av_genus), at = c(2,5,8,11,14))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 17, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 15.5, cex = 0.9)

arrows(x0 = 0.5, y0 = 1, y1 = 16, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("**","***","ns","ns","ns"),side = 4, line = 3, at = c(1.5,4.5,8,11,14), las = 1, cex = c(2,2,1,1,1))
mtext(c("*","ns","ns", "ns", "ns"),side = 4, line = 0, at = c(1.5,5,8,11,14), las = 1, cex = c(2,1,1,1,1))



legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r Rel abund setup (simper), echo = F, include = F}

ggtaxonomy <- tax_table("data/Bickford.gg.cons.taxonomy", "GG")

topshared <- shared[ ,rownames(topten)]

L <- ggtaxonomy$otu %in% colnames(topshared)
ggtaxonomy <- ggtaxonomy[L, ]
stopifnot(nrow(ggtaxonomy)==ncol(topshared))

n_seqs <- apply(topshared , 1, sum)
rel_abund <- topshared / n_seqs

nat_topshared <- topshared[grepl("Nat", rownames(topshared)), ]
non_topshared <- topshared[grepl("Inv", rownames(topshared)), ]

# 3. calculate the relative abundance
nat_seqs <- apply(nat_topshared , 1, sum)
nat_rel_abund <- nat_topshared / nat_seqs

top_nat_rel_abund <- numeric()
for(h in colnames(nat_rel_abund)){
  y <- mean(nat_rel_abund[ ,h])
  top_nat_rel_abund[h] <- y
}
sum(top_nat_rel_abund)
top_nat_rel_abund


non_seqs <- apply(non_topshared , 1, sum)
non_rel_abund <- non_topshared / non_seqs

top_non_rel_abund <- numeric()
for(h in colnames(non_rel_abund)){
  y <- mean(non_rel_abund[ ,h])
  top_non_rel_abund[h] <- y
}
sum(top_non_rel_abund)
top_non_rel_abund



```

```{r simp by lin for stats, echo = F, include = F}
# 3. calculate the relative abundance

top_rel_abund <- data.frame("SampleID" = rownames(topshared),rel_abund)

meta_top <- inner_join(top_rel_abund, metadata, by = c( "SampleID" = "Code"))
rownames(meta_top) <- meta_top$SampleID

nat_av_ra <- apply(nat_rel_abund[1:5], 2, mean)
nat_sd_ra <- apply(nat_rel_abund[1:5], 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(nrow(nat_rel_abund))

non_av_ra <- apply(non_rel_abund[1:5], 2, mean)
non_sd_ra <- apply(non_rel_abund[1:5], 2, sd)
non_se_ra <- non_sd_ra/sqrt(nrow(non_rel_abund))

rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

topnames <- paste(ggtaxonomy$genus, ggtaxonomy$species, sep = "_")
rownames(rel_average) <- topnames[1:5]

top_av_simp <- as.matrix(rel_average)
top_av_simp <- t(top_av_simp)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


an_ra_1 <- aov(meta_top$Otu0001 ~ meta_top$Site * meta_top$Lineage)
summary(an_ra_1)

an_ra_4 <- aov(meta_top$Otu0004 ~ meta_top$Site * meta_top$Lineage)
summary(an_ra_4)

an_ra_2 <- aov(meta_top$Otu0002 ~ meta_top$Site * meta_top$Lineage)
summary(an_ra_2)

an_ra_3 <- aov(meta_top$Otu0003~ meta_top$Site * meta_top$Lineage)
summary(an_ra_3)

an_ra_6 <- aov(meta_top$Otu0006 ~ meta_top$Site * meta_top$Lineage)
summary(an_ra_6)

```

```{r Rel abund of simpotus and Lin, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 5, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = top_av_simp, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.5), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
axis(side = 2, las = 1, labels = colnames(top_av_simp), at = c(2,5,8,11,14))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 17, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 15.5, cex = 0.9)

arrows(x0 = 0.6, y0 = 1, y1 = 16, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("ns","**","**","**","ns"),side = 4, line = 3, at = c(2,4.5,7.5,10.5,14), las = 1, cex = c(1,2,2,2,1))
mtext(c("ns","ns","ns",".", "*"),side = 4, line = 0, at = c(2,5,8,11.33,13.5), las = 1, cex = c(1,1,1,2,2))



legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r Rel abund setup (genus) only abundant taxa, echo = F, include = F}
taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")

L <- taxonomy$otu %in% colnames(shared_abundant)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared_abundant))

otu_proteo_genus <- taxonomy[taxonomy$phylum == "Proteobacteria", ]

proteo_shared_ab <- shared_abundant[ , otu_proteo_genus$otu]

#make a loop

#need to know the genus names within proteobacteria
genus_names <- unique(otu_proteo_genus$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(proteo_shared_ab)
proteo_genera_shared_ab <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(proteo_genera_shared_ab) <- rownames(proteo_shared)
colnames(proteo_genera_shared_ab) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- otu_proteo_genus[otu_proteo_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  proteo_genera_shared_ab[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
n_seqs <- apply(proteo_genera_shared_ab, 1, sum)
genus_rel_abund <- proteo_genera_shared_ab / n_seqs

tot_genus_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_genus_rel_abund[h] <- y
}
sum(tot_genus_rel_abund)
tot_genus_rel_abund

L <- sort.list(tot_genus_rel_abund, decreasing = T)
tot_genus_rel_abund <- tot_genus_rel_abund[L]

genus_names <- unique(otu_proteo_genus$genus)
cl_genus_names <- genus_names[genus_names != "unclassified"]
# need somwhere to put data - asco_genera_shared
n_genera <- length(cl_genus_names)
n_samples <- nrow(proteo_shared_ab)
proteo_cl_genera_shared_ab <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(proteo_cl_genera_shared_ab) <- rownames(proteo_shared_ab)
colnames(proteo_cl_genera_shared_ab) <- cl_genus_names

#my loop
for(i in cl_genus_names){
  genus_otus <- otu_proteo_genus[otu_proteo_genus$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  proteo_cl_genera_shared_ab[ , i] <- genus_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(proteo_cl_genera_shared_ab, 1, sum)
cl_genus_rel_abund <- proteo_cl_genera_shared_ab / n_seqs

tot_cl_genus_rel_abund <- numeric()
for(h in colnames(cl_genus_rel_abund)){
  y <- mean(cl_genus_rel_abund[ ,h])
  tot_cl_genus_rel_abund[h] <- y
}
sum(tot_cl_genus_rel_abund)
tot_cl_genus_rel_abund

L <- sort.list(tot_cl_genus_rel_abund, decreasing = T)
tot_cl_genus_rel_abund <- tot_cl_genus_rel_abund[L]

top_genera_rel_abund <- tot_cl_genus_rel_abund[tot_cl_genus_rel_abund >= 0.01]

```

```{r Rel abund by Genus plot abundant, echo=F, include = T}
top_genera_rel_abund


barplot(height = top_genera_rel_abund[1:5], beside = T)

```

```{r pseudomonus permanova, echo=F, include = T}
taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")
L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))


sudo_otus <- taxonomy$otu[taxonomy$genus == "Pseudomonas"]
sudo_shared <- shared[, sudo_otus]

perm_sudo <- adonis(sudo_shared ~ Site + Sat_lev + Lineage, data = meta_alpha)
perm_sudo


```
```{r pseudomonus permanova abundant, echo=F, include = T}
L <- taxonomy$otu %in% colnames(shared_abundant)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared_abundant))



sudo_otus <- taxonomy$otu[taxonomy$genus == "Pseudomonas"]
sudo_shared_ab <- shared_abundant[ , sudo_otus]

perm_sudo_ab <- adonis(sudo_shared_ab ~ Site + Sat_lev + Lineage, data = meta_alpha)
perm_sudo_ab


```
```{r pseudomonas NMDS abundant, echo = F, include = F}
NMDS_sudo_ab <- metaMDS(sudo_shared_ab, trymax = 100, k=2)
NMDS_sudo_ab
NMDS_sudo_ab <- metaMDS(sudo_shared_ab, previous.best = NMDS_ab)
NMDS_sudo_ab

NMDS_sudo_ab_scores <- scores(NMDS_sudo_ab)

NMDS1_sudo_ab <- NMDS_sudo_ab_scores[ ,1]
NMDS2_sudo_ab <- NMDS_sudo_ab_scores[ ,2]

NMDS_sudo_ab_scores <- as.data.frame(NMDS_sudo_ab_scores)

```
```{r NMDS plot pseudo common, echo = F, include = T}

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "orange", Rt2 = "gray", SB = "purple")
pchs <- c(Nat = 1, Inv = 16)

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 2, 3, 0.5, 9 ))
plot.window(xlim = c(-0.5,0.75), ylim = c(-0.75,0.5))
axis(side = 1)
axis(side = 2, las = 1)
points(x = NMDS_sudo_ab_scores$NMDS1, y = NMDS_sudo_ab_scores$NMDS2, pch = pchs[as.character(meta_alpha$Lineage)], 
      col = clrs[as.character(meta_alpha$Site)], cex = 1.5, lwd = 2)

mtext(side = 1, line = 2, text = "NMDS1")
mtext(side = 2, line = 3, text = "NMDS2" )

ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "BL", show.groups = TRUE, kind = "se", conf = 0.95, col = "blue", lty = 1, lwd = 2.0)
ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "CB", show.groups = TRUE, kind = "se", conf = 0.95, col = "red", lty = 1, lwd = 2.0)
ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "CH", show.groups = TRUE, kind = "se", conf = 0.95, col = "dark green", lty = 1, lwd = 2.0)
ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "CM", show.groups = TRUE, kind = "se", conf = 0.95, col = "coral", lty = 1, lwd = 2.0)
ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "CR", show.groups = TRUE, kind = "se", conf = 0.95, col = "black", lty = 1, lwd = 2.0)
ordiellipse(NMDS_sudo_ab, meta_alpha$Site == "Rt2", show.groups = TRUE, kind = "se", conf = 0.95, col = "gray", lty = 1, lwd = 2.0)

legend_text <- c("Bullard Lake", "Chelsea", "Cecil Bay", "Cheboygan Marsh", "Castle Rock", "Route 2", "Sturgeon Bay","Point LeBarb")
legend(0.8,0.55, legend_text, pch = 16, 
       col = c("blue","dark green","red","coral","black","gray","purple", "brown"), 
       pt.lwd = 2, pt.cex = 1.5, xpd = T)

legend_text2 <- c("Native", "Non-Native")
legend(0.8,-0.556, legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T)
box()



```


##Function
#From Picrust

```{r functional assessment, echo = F, include = T}
fungenes <- read.table("data/picrust_assessments.csv", header = T, sep = ",", stringsAsFactors = F)

fungenes <- t(fungenes)
fungenes <- fungenes[-1, ]

funperm <- adonis(fungenes ~ Site * Lineage + Sat_lev, data = meta_alpha)
funperm
```





```{r Rel abund setup (all genera), echo = F, include = F}

taxonomy <- tax_table("data/Bickford.cons.taxonomy", "SILVA")

shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


L <- taxonomy$otu %in% colnames(shared)
taxonomy <- taxonomy[L, ]
stopifnot(nrow(taxonomy)==ncol(shared))

#otu_proteo_genus <- taxonomy[taxonomy$phylum == "Proteobacteria", ]

#make a loop

#need to know the genus names within proteobacteria
genus_names <- unique(taxonomy$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(shared)
genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(genera_shared) <- rownames(shared)
colnames(genera_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- taxonomy[taxonomy$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  genera_shared[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
n_seqs <- apply(genera_shared, 1, sum)
genus_rel_abund <- genera_shared / n_seqs

tot_genus_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_genus_rel_abund[h] <- y
}
sum(tot_genus_rel_abund)
tot_genus_rel_abund

L <- sort.list(tot_genus_rel_abund, decreasing = T)
tot_genus_rel_abund <- tot_genus_rel_abund[L]

genus_names <- unique(taxonomy$genus)
cl_genus_names <- genus_names[genus_names != "unclassified"]
# need somwhere to put data - asco_genera_shared
n_genera <- length(cl_genus_names)
n_samples <- nrow(shared)
cl_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(cl_genera_shared) <- rownames(shared)
colnames(cl_genera_shared) <- cl_genus_names

#my loop
for(i in cl_genus_names){
  genus_otus <- taxonomy[taxonomy$genus == i, "otu"]
  genus_shared <- shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  cl_genera_shared[ , i] <- genus_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(cl_genera_shared, 1, sum)
cl_genus_rel_abund <- cl_genera_shared / n_seqs

tot_cl_genus_rel_abund <- numeric()
for(h in colnames(cl_genus_rel_abund)){
  y <- mean(cl_genus_rel_abund[ ,h])
  tot_cl_genus_rel_abund[h] <- y
}
sum(tot_cl_genus_rel_abund)

L <- sort.list(tot_cl_genus_rel_abund, decreasing = T)
tot_cl_genus_rel_abund <- tot_cl_genus_rel_abund[L]

top_genera_rel_abund <- tot_cl_genus_rel_abund[tot_cl_genus_rel_abund >= 0.01]
top_names <- names(top_genera_rel_abund[1:7])

```

```{r allgenera, include = T, echo = F}
topgenus_ra <- cl_genus_rel_abund[ , top_names]

nat_genusra <- topgenus_ra[grepl("Nat", rownames(topgenus_ra)), ]
non_genusra <- topgenus_ra[grepl("Inv", rownames(topgenus_ra)), ]


nat_av_ra <- apply(nat_genusra, 2, mean)
nat_sd_ra <- apply(nat_genusra, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(nrow(nat_genusra))

non_av_ra <- apply(non_genusra, 2, mean)
non_sd_ra <- apply(non_genusra, 2, sd)
non_se_ra <- non_sd_ra/sqrt(nrow(non_genusra))

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_genus <- as.matrix(lin_rel_average)
top_av_genus <- t(top_av_genus)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


an_ra_sudo <- aov(topgenus_ra$Pseudomonas ~ Site * Lineage, data = meta_alpha)
summary(an_ra_sudo)

an_ra_fla <- aov(topgenus_ra$Flavobacterium ~ Site * Lineage, data = meta_alpha)
summary(an_ra_fla)

an_ra_jan <- aov(topgenus_ra$Janthinobacterium ~ Site * Lineage, data = meta_alpha)
summary(an_ra_jan)

an_ra_rhi <- aov(topgenus_ra$Rhizobium ~ Site * Lineage, data = meta_alpha)
summary(an_ra_rhi)

an_ra_dug <- aov(topgenus_ra$Duganella ~ Site * Lineage, data = meta_alpha)
summary(an_ra_dug)

an_ra_tric <- aov(topgenus_ra$Trichococcus ~ Site * Lineage, data = meta_alpha)
summary(an_ra_tric)

an_ra_aer <- aov(topgenus_ra$Aeromonas ~ Site * Lineage, data = meta_alpha)
summary(an_ra_aer)

```
```{r Rel abund by all Genus and Lin, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,0.6), ylim = c(-1,1))

barplot(height = top_av_genus, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.6), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5,16.5,19.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5,17.5,20.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_genus), at = c(2,5,8,11,14,17,20))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 24.5, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 22.5, cex = 0.9)

arrows(x0 = 0.73, y0 = 1, y1 = 21.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("<0.001","<0.001"," 0.050","<0.001"," 0.123"," 0.139"," 0.086"), side = 4, line = 3, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)
mtext(c("0.012","0.337","0.590","0.021","0.084","0.346","0.197"),side = 4, line = 0, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r Rel abund by all Genus and Lin (astriks), echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,0.6), ylim = c(-1,1))

barplot(height = top_av_genus, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.6), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5,16.5,19.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5,17.5,20.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_genus), at = c(2,5,8,11,14,17,20))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 24.5, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 22.5, cex = 0.9)

arrows(x0 = 0.73, y0 = 1, y1 = 21.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("***","***","*","***","ns","ns","."), side = 4, line = 3, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)
mtext(c("*","ns","ns","*",".","ns","ns"),side = 4, line = 0, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```
```{r function from ijsem, echo = F, include = T}

#read table
ijsem<-read.delim("data/IJSEM_pheno_db_v1.0.txt", sep="\t", header=T, check.names=F, fill=T, na.strings=c("NA", "", "Not indicated", " Not indicated","not indicated", "Not Indicated", "n/a", "N/A", "Na", "Not given", "not given","Not given for yeasts", "not indicated, available in the online version", "Not indicated for yeasts", "Not Stated", "Not described for yeasts", "Not determined", "Not determined for yeasts"))

#simplify column names
colnames(ijsem)<-c("Habitat", "Year", "DOI", "rRNA16S", "GC", "Oxygen",
                  "Length", "Width", "Motility", "Spore", "MetabAssays", "Genus", "Species", "Strain", "pH_optimum", "pH_range", "Temp_optimum", "Temp_range", "Salt_optimum", "Salt_range", "Pigment", "Shape", "Aggregation", "FirstPage", "CultureCollection", "CarbonSubstrate", "Genome", "Gram", "Subhabitat", "Biolog")

#clean Habitat column
levels(ijsem$Habitat)[levels(ijsem$Habitat)=="freshwater (river, lake, pond)"]<-"freshwater"
levels(ijsem$Habitat)[levels(ijsem$Habitat)=="freshwater sediment (river, lake, pond"]<-"freshwater sediment"

#clean Oxygen column
levels(ijsem$Oxygen)[levels(ijsem$Oxygen)=="aerobic"]<-"obligate aerobe"
levels(ijsem$Oxygen)[levels(ijsem$Oxygen)=="anerobic"]<-"obligate anerobe"
levels(ijsem$Oxygen)[levels(ijsem$Oxygen)=="microerophile"]<-"microaerophile"

#clean pH_optimum column
ijsem$pH_optimum<-as.character(ijsem$pH_optimum)
#this step splits the range values and takes the mean value
#values that are not numeric are transformed to NAs
ijsem$pH_optimum<-sapply(ijsem$pH_optimum, simplify=T, function(x){mean(as.numeric(unlist(strsplit(x, split="-", fixed=T))))})
#remove pH values <0 and >10
ijsem$pH_optimum[ijsem$pH_optimum<0 | ijsem$pH_optimum>10]<-NA

#clean Temp_optimum column
ijsem$Temp_optimum<-as.character(ijsem$Temp_optimum)
#this step splits the range values and takes the mean value
#values that are not numeric are transformed to NAs
ijsem$Temp_optimum<-sapply(ijsem$Temp_optimum, simplify=T, function(x){mean(as.numeric(unlist(strsplit(x, split="-", fixed=T))))})

#clean Salt_optimum column
ijsem$Salt_optimum<-as.character(ijsem$Salt_optimum)
#this step splits the range values and takes the mean value
#values that are not numeric are transformed to NAs
ijsem$Salt_optimum<-sapply(ijsem$Salt_optimum, simplify=T, function(x){mean(as.numeric(unlist(strsplit(x, split="-", fixed=T))))})
#there are some formatting issues that should be solved


```
```{r data query, echo = F, include = T}
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

ggtaxonomy <- tax_table("data/Bickford.gg2.cons.taxonomy", "GG")

shared <- read.table(file= "data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared <- shared[ ,-c(1,2)]


#L <- colnames(shared) %in% rownames(gen_traits)
#match_shared <- shared[L, ]
#stopifnot(nrow(ggtaxonomy)==ncol(shared))

table(ijsem$Habitat)
sub_ijsem <- ijsem[ijsem$Habitat == "estuarine sediment" | ijsem$Habitat == "estuarine water" | ijsem$Habitat == "freshwater" | ijsem$Habitat == "freshwater sediment" | ijsem$Habitat == "marine sediment" | ijsem$Habitat == "other" | ijsem$Habitat == "plant associated" | ijsem$Habitat == "plant endophyte" | ijsem$Habitat == "seawater" | ijsem$Habitat == "soil", ]

same <- unique(taxonomy$genus) %in% unique(ijsem$Genus)

matched <- unique(ggtaxonomy$genus)[same]

ij_genus_matches <- sub_ijsem[sub_ijsem$Genus %in% genus_names, ]

sudo_matches <- ij_genus_matches[ij_genus_matches$Genus == "Pseudomonas", ]
table(sudo_matches$Oxygen) / nrow(sudo_matches)

aero_matches <- ij_genus_matches[ij_genus_matches$Genus == "Aeromonas", ]
table(aero_matches$Oxygen)

gen_traits <- matrix(NA, nrow = length(unique(ij_genus_matches$Genus)), ncol = 3)

rownames(gen_traits) <- unique(ij_genus_matches$Genus)
colnames(gen_traits) <- c("gram", "oxygen", "ox_per")

for(i in rownames(gen_traits)){
  gram <- as.character(ij_genus_matches[ij_genus_matches$Genus == i, "Gram"])
  gen_traits[i, 1] <- gram[1]
}

for(ii in rownames(gen_traits)){
  oxlev <- as.character(ij_genus_matches[ij_genus_matches$Genus == ii, "Oxygen"])
  ox <- as.character(getmode(oxlev))
  gen_traits[ii, 2] <- ox
  ox_per <- length(oxlev[oxlev == ox]) / length(oxlev)
  gen_traits[ii, 3] <- ox_per
}



```


```{r Rel abund setup (gram), echo = F, include = F}

#make a loop calculating rel abundance for >50% threshold
gen_traits <- as.data.frame(gen_traits)
gram <- c("negative", "positive")
trait_gens <- rownames(gen_traits)
gen_traits <- data.frame("Genus" = trait_gens, gen_traits)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_ox))
rownames(ox_shared) <- rownames(cl_genera_shared)
colnames(ox_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits[gen_traits$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox_shared, 1, sum)
ox_rel_abund <- ox_shared / n_seqs

nat_ox_shared <- ox_shared[grepl("Nat", rownames(ox_shared)), ]
inv_ox_shared <- ox_shared[grepl("Inv", rownames(ox_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

nat_oxi_rel_abund <- numeric()
for(h in colnames(nat_ox_rel_abund)){
  y <- mean(nat_ox_rel_abund[ ,h])
  nat_oxi_rel_abund[h] <- y
}
sum(nat_oxi_rel_abund)
nat_oxi_rel_abund

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

non_oxi_rel_abund <- numeric()
for(h in colnames(non_ox_rel_abund)){
  y <- mean(non_ox_rel_abund[ ,h])
  non_oxi_rel_abund[h] <- y
}
sum(non_oxi_rel_abund)
non_oxi_rel_abund

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
nat_sd_ra <- apply(nat_ox_rel_abund, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(nrow(nat_ox_rel_abund))

non_av_ra <- apply(non_ox_rel_abund, 2, mean)
non_sd_ra <- apply(non_ox_rel_abund, 2, sd)
non_se_ra <- non_sd_ra/sqrt(nrow(non_ox_rel_abund))

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)
lin_rel_average <- as.matrix(lin_rel_average)
lin_rel_average <- t(lin_rel_average)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


an_ra_facan <- aov(ox_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_ra_facan)

an_ra_obaer <- aov(ox_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_ra_obaer)

an_ra_an <- aov(ox_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_ra_an)
```

```{r Rel abund by oxygen requirement, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 9, 1, 5 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = lin_rel_average, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
axis(side = 2, las = 1, labels = c("anaerobes", "Facultative", "aerobes", "Obligate", "Anaerobes"), at = c(1.5,2.5,4.5,5.5,8), tick = F)
axis(side = 2, las = 1, labels = F, at = c(2,5,8))
mtext("Significant Differences",side = 4, las = 1, line = -2.5, at = 10, cex = 1)
mtext(c("Lineage","Saturation"),side = 4, las = 1, line = c(-1,2.5), at = 9, cex = 0.9)

arrows(x0 = 1.18, y0 = 1, y1 = 8.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("ns","ns","*"),side = 4, line = 3, at = c(2,5,7.5), las = 1, cex = c(1,1,2))
mtext(c("**","*","ns"),side = 4, line = 0, at = c(1.5,4.5,8), las = 1, cex = c(2,2,1))



legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```


```{r sensitivity, echo = F, include = F}
gen_traits <- as.data.frame(gen_traits)

gen_traits$ox_per <- as.character(gen_traits$ox_per)
gen_traits$ox_per <- as.numeric(gen_traits$ox_per)
gen_traits60 <- gen_traits[gen_traits$ox_per > 0.6, ]
gen_traits70 <- gen_traits[gen_traits$ox_per > 0.7, ]
gen_traits80 <- gen_traits[gen_traits$ox_per > 0.8, ]
gen_traits90 <- gen_traits[gen_traits$ox_per > 0.9, ]
gen_traits95 <- gen_traits[gen_traits$ox_per > 0.95, ]
gen_traits99 <- gen_traits[gen_traits$ox_per > 0.99, ]

trait_gens <- rownames(gen_traits60)
gen_traits60 <- data.frame("Genus" = trait_gens, gen_traits60)


```

```{r sensitivity cont, echo = F, include = T}
diff50 <- non_av_ra - nat_av_ra

#make a loop calculating rel abundance for >60% threshold

# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox60_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox60_shared) <- rownames(cl_genera_shared)
colnames(ox60_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits60[gen_traits60$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox60_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox60_shared, 1, sum)
ox60_rel_abund <- ox60_shared / n_seqs

nat_ox_shared <- ox60_shared[grepl("Nat", rownames(ox60_shared)), ]
inv_ox_shared <- ox60_shared[grepl("Inv", rownames(ox60_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff60 <- non_av_ra - nat_av_ra

#make a loop calculating rel abundance for >70% threshold
trait_gens <- rownames(gen_traits70)
gen_traits70 <- data.frame("Genus" = trait_gens, gen_traits70)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox70_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox70_shared) <- rownames(cl_genera_shared)
colnames(ox70_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits70[gen_traits70$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox70_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox70_shared, 1, sum)
ox70_rel_abund <- ox70_shared / n_seqs

nat_ox_shared <- ox70_shared[grepl("Nat", rownames(ox70_shared)), ]
inv_ox_shared <- ox70_shared[grepl("Inv", rownames(ox70_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff70 <- non_av_ra - nat_av_ra
#make a loop calculating rel abundance for >80% threshold
trait_gens <- rownames(gen_traits80)
gen_traits80 <- data.frame("Genus" = trait_gens, gen_traits80)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox80_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox80_shared) <- rownames(cl_genera_shared)
colnames(ox80_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits80[gen_traits80$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox80_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox80_shared, 1, sum)
ox80_rel_abund <- ox80_shared / n_seqs

nat_ox_shared <- ox80_shared[grepl("Nat", rownames(ox80_shared)), ]
inv_ox_shared <- ox80_shared[grepl("Inv", rownames(ox80_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff80 <- non_av_ra - nat_av_ra
#make a loop calculating rel abundance for >90% threshold
trait_gens <- rownames(gen_traits90)
gen_traits90 <- data.frame("Genus" = trait_gens, gen_traits90)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox90_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox90_shared) <- rownames(cl_genera_shared)
colnames(ox90_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits90[gen_traits90$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox90_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox90_shared, 1, sum)
ox90_rel_abund <- ox90_shared / n_seqs

nat_ox_shared <- ox90_shared[grepl("Nat", rownames(ox90_shared)), ]
inv_ox_shared <- ox90_shared[grepl("Inv", rownames(ox90_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff90 <- non_av_ra - nat_av_ra
#make a loop calculating rel abundance for >95% threshold
trait_gens <- rownames(gen_traits95)
gen_traits95 <- data.frame("Genus" = trait_gens, gen_traits95)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox95_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox95_shared) <- rownames(cl_genera_shared)
colnames(ox95_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits95[gen_traits95$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox95_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox95_shared, 1, sum)
ox95_rel_abund <- ox95_shared / n_seqs

nat_ox_shared <- ox95_shared[grepl("Nat", rownames(ox95_shared)), ]
inv_ox_shared <- ox95_shared[grepl("Inv", rownames(ox95_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff95 <- non_av_ra - nat_av_ra
#make a loop calculating rel abundance for >99% threshold
trait_gens <- rownames(gen_traits99)
gen_traits99 <- data.frame("Genus" = trait_gens, gen_traits99)
# need somwhere to put data - asco_genera_shared

ox <- c("facultative anaerobe", "obligate aerobe", "anaerobic")
n_ox <- length(ox)
n_samples <- nrow(cl_genera_shared)
ox99_shared <- matrix(0, nrow = n_samples, ncol = n_ox)
rownames(ox99_shared) <- rownames(cl_genera_shared)
colnames(ox99_shared) <- ox

for(i in ox){
  ox_genus <- as.character(gen_traits99[gen_traits99$oxygen == i, "Genus" ])
  L <- colnames(cl_genera_shared) %in% ox_genus
  cn <- colnames(cl_genera_shared)[L]
  o_shared <- cl_genera_shared[ , cn]
  if(length(ox_genus) > 1){
    ox_count <- apply(o_shared, 1, sum)
  } else {
    ox_count <- o_shared
  }
  ox99_shared[ , i] <- ox_count
  
}

n_seqs <- apply(ox99_shared, 1, sum)
ox99_rel_abund <- ox99_shared / n_seqs

nat_ox_shared <- ox99_shared[grepl("Nat", rownames(ox99_shared)), ]
inv_ox_shared <- ox99_shared[grepl("Inv", rownames(ox99_shared)), ]


####HERE# 3. calculate the relative abundance
nat_seqs <- apply(nat_ox_shared, 1, sum)
nat_ox_rel_abund <- nat_ox_shared / nat_seqs

non_seqs <- apply(inv_ox_shared, 1, sum)
non_ox_rel_abund <- inv_ox_shared / non_seqs

nat_av_ra <- apply(nat_ox_rel_abund, 2, mean)
non_av_ra <- apply(non_ox_rel_abund, 2, mean)
diff99 <- non_av_ra - nat_av_ra


#for loop here?
per <- (sum(ox_shared)/sum(shared))*100
cat("at 50% threshold", per, "% of sequences represented\n")
cat("60%\n")
per <- (sum(ox60_shared)/sum(shared))*100
cat("at 60% threshold", per,"% of total sequences represented\n")
ox60_rel_abund <- as.data.frame(ox60_rel_abund)
an_60_facan <- aov(ox60_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_60_facan)

an_60_obaer <- aov(ox60_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_60_obaer)

an_60_an <- aov(ox60_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_60_an)

cat("70%\n")
per <- (sum(ox70_shared)/sum(shared))*100
cat("at 70% threshold", per,"% of total sequences represented\n")
ox70_rel_abund <- as.data.frame(ox70_rel_abund)
an_70_facan <- aov(ox70_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_70_facan)

an_70_obaer <- aov(ox70_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_70_obaer)

an_70_an <- aov(ox70_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_70_an)

cat("80%\n")
per <- (sum(ox80_shared)/sum(shared))*100
cat("at 80% threshold", per,"% of total sequences represented\n")
ox80_rel_abund <- as.data.frame(ox80_rel_abund)
an_80_facan <- aov(ox80_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_80_facan)

an_80_obaer <- aov(ox80_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_80_obaer)

an_80_an <- aov(ox80_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_80_an)

cat("90%\n")
per <- (sum(ox90_shared)/sum(shared))*100
cat("at 60% threshold", per,"% of total sequences represented\n")
ox90_rel_abund <- as.data.frame(ox90_rel_abund)
an_90_facan <- aov(ox90_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_90_facan)

an_90_obaer <- aov(ox90_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_90_obaer)

an_90_an <- aov(ox90_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_90_an)

cat("95%\n")
per <- (sum(ox95_shared)/sum(shared))*100
cat("at 95% threshold", per,"% of total sequences represented\n")
ox95_rel_abund <- as.data.frame(ox95_rel_abund)
an_95_facan <- aov(ox95_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_95_facan)

an_95_obaer <- aov(ox95_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_95_obaer)

an_95_an <- aov(ox95_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_95_an)

cat("99%\n")
per <- (sum(ox99_shared)/sum(shared))*100
cat("at 99% threshold", per,"% of total sequences represented\n")
ox99_rel_abund <- as.data.frame(ox99_rel_abund)
an_99_facan <- aov(ox99_rel_abund$`facultative anaerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("facan\n")
summary(an_99_facan)

an_99_obaer <- aov(ox99_rel_abund$`obligate aerobe` ~ Lineage * Sat_lev, data = meta_alpha)
cat("obaer\n")
summary(an_99_obaer)

an_99_an <- aov(ox99_rel_abund$anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
cat("an\n")
summary(an_99_an)

threshold <- data.frame(diff50, diff60, diff70, diff80, diff90, diff95, diff99)
threshold <- t(threshold)
c <- c(50,60,70,80,90,95,99)
threshold <- as.matrix(threshold)
threshold <- threshold*100

colnames(threshold) <- c("facan", "obaer", "anaer")

```

```{r threshold plot, echo = F. include = T}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 4, 3, 1 ))
par(xpd = NA)
plot.window(xlim = c(50,100), ylim = c(-10,10))

plot(x = c, y = threshold[ , "facan"], pch = 20, xlim = c(50,100), ylim = c(-10,10), xlab = "Threshold level", ylab = "Difference in RA (Inv - Nat)")
#lines(x = c, y = threshold[ , "facan"])
points(x = c, y = threshold[ , "obaer"], pch = 21)
#lines(x = c, y = threshold[ , "obaer"], pch = 21)
points(x = c, y = threshold[ , "anaer"], pch = 22)
#lines(x = c, y = threshold[ , "anaer"], pch = 22)

mtext("Percent of Total Sequences Represented",side = 1, line = -11, at = 75, cex = 0.8)
mtext(c("78%","76%","70%","69%","69%","17%","12%"),side = 1, at = c(50,60,70,80,90,95,99), line = -9.5, cex = 0.8)

arrows(x0 = 48, x1 = 102, y0 = 0, angle = 0, length = 0)
mtext(c("*","*"),side = 2, line = -1.5, at = c(-5.5,6), las = 1, cex = 1)
mtext(c("*","*"),side = 2, line = -5.1, at = c(-8,7), las = 1, cex = 1)




legend("bottom", c("Facultative Anaerobe", "Obligate Aerobe", "Anaerobe" ), pch = c(20,21,22), xpd = T, bty = "n", cex = 0.8)
```

```{r saturation and fac anaerobes}
natunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Nat"]
nonunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Inv"]
natsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Nat"]
nonsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Inv"]
natsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Nat"]
nonsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Inv"]
nat_un_shared <- nat_ox_shared[natunsat_sites, ]
non_un_shared <- inv_ox_shared[nonunsat_sites, ]
nat_sat_shared <- nat_ox_shared[natsat_sites, ]
non_sat_shared <- inv_ox_shared[nonsat_sites, ]
nat_sathi_shared <- nat_ox_shared[natsathi_sites, ]
non_sathi_shared <- inv_ox_shared[nonsathi_sites, ]

facan_bysat <- matrix(NA, nrow = 4, ncol = 3)
rownames(facan_bysat) <- c("Native", "NatSE", "Non-Native", "NonSE")
colnames(facan_bysat) <- c("Unsaturated","Saturated", "High Water")

nat_un_seqs <- nat_seqs[natunsat_sites]
rel_nat_un <- nat_un_shared/nat_un_seqs
facan_bysat[1,1] <- mean(rel_nat_un[ ,1])
sdev <- sd(rel_nat_un[ ,1])
facan_bysat[2,1] <- sdev/sqrt(nrow(rel_nat_un))
nat_sat_seqs <- nat_seqs[natsat_sites]
rel_nat_sat <- nat_sat_shared/nat_sat_seqs
facan_bysat[1,2] <- mean(rel_nat_sat[ ,1])
sdev <- sd(rel_nat_sat[ ,1])
facan_bysat[2,2] <- sdev/sqrt(nrow(rel_nat_sat))
nat_sathi_seqs <- nat_seqs[natsathi_sites]
rel_nat_sathi <- nat_sathi_shared/nat_sathi_seqs
facan_bysat[1,3] <- mean(rel_nat_sathi[ ,1])
sdev <- sd(rel_nat_sathi[ ,1])
facan_bysat[2,3] <- sdev/sqrt(nrow(rel_nat_sathi))

non_un_seqs <- non_seqs[nonunsat_sites]
rel_non_un <- non_un_shared/non_un_seqs
facan_bysat[3,1] <- mean(rel_non_un[ ,1])
sdev <- sd(rel_non_un[ ,1])
facan_bysat[4,1] <- sdev/sqrt(nrow(rel_non_un))
non_sat_seqs <- non_seqs[nonsat_sites]
rel_non_sat <- non_sat_shared/non_sat_seqs
facan_bysat[3,2] <- mean(rel_non_sat[ ,1])
sdev <- sd(rel_non_sat[ ,1])
facan_bysat[4,2] <- sdev/sqrt(nrow(rel_non_sat))
non_sathi_seqs <- non_seqs[nonsathi_sites]
rel_non_sathi <- non_sathi_shared/non_sathi_seqs
facan_bysat[3,3] <- mean(rel_non_sathi[ ,1])
sdev <- sd(rel_non_sathi[ ,1])
facan_bysat[4,3] <- sdev/sqrt(nrow(rel_non_sathi))

y0_nat <- (facan_bysat["Native", ] - facan_bysat["NatSE", ])*100
y1_nat <- (facan_bysat["Native", ] + facan_bysat["NatSE", ])*100

y0_non <- (facan_bysat["Non-Native", ] - facan_bysat["NonSE", ])*100
y1_non <- (facan_bysat["Non-Native", ] + facan_bysat["NonSE", ])*100

```

```{r plot of facan by satlev}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 4, 3, 1 ))
par(xpd = NA)
plot.window(xlim = c(0,3), ylim = c(0,35))

points(x = c(0.5,1.5,2.5), y = facan_bysat["Native", ]*100, pch = 20, ylim = c(0,35))
axis(side = 1, labels = colnames(facan_bysat), at = c(0.5,1.5,2.5))
axis(side = 2, at = c(0:7)*5, labels = T) 
mtext("Relative Abundance", side = 2, at = 17.5, line = 2)
mtext("Facultative Anaerobes", side = 3, at = 0.5, line = -1, las = 1)

points(x = c(0.5,1.5,2.5), y = facan_bysat["Non-Native", ]*100, pch = 21)
arrows(y0 = y0_nat, y1 = y1_nat, x0 = c(0.5,1.5,2.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(y0 = y0_non, y1 = y1_non, x0 = c(0.5,1.5,2.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)

legend("topright", c("Native", "Non-Native"), pch = c(20,21), xpd = T, bty = "n")
box()
```

```{r saturation and fac anaerobes}
natunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Nat"]
nonunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Inv"]
natsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Nat"]
nonsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Inv"]
natsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Nat"]
nonsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Inv"]
nat_un_shared <- nat_ox_shared[natunsat_sites, ]
non_un_shared <- inv_ox_shared[nonunsat_sites, ]
nat_sat_shared <- nat_ox_shared[natsat_sites, ]
non_sat_shared <- inv_ox_shared[nonsat_sites, ]
nat_sathi_shared <- nat_ox_shared[natsathi_sites, ]
non_sathi_shared <- inv_ox_shared[nonsathi_sites, ]

obaer_bysat <- matrix(NA, nrow = 4, ncol = 3)
rownames(obaer_bysat) <- c("Native", "NatSE", "Non-Native", "NonSE")
colnames(obaer_bysat) <- c("Unsaturated","Saturated", "High Water")

obaer_bysat[1,1] <- mean(rel_nat_un[ ,2])
sdev <- sd(rel_nat_un[ ,2])
obaer_bysat[2,1] <- sdev/sqrt(nrow(rel_nat_un))
obaer_bysat[1,2] <- mean(rel_nat_sat[ ,2])
sdev <- sd(rel_nat_sat[ ,2])
obaer_bysat[2,2] <- sdev/sqrt(nrow(rel_nat_sat))
obaer_bysat[1,3] <- mean(rel_nat_sathi[ ,2])
sdev <- sd(rel_nat_sathi[ ,2])
obaer_bysat[2,3] <- sdev/sqrt(nrow(rel_nat_sathi))

obaer_bysat[3,1] <- mean(rel_non_un[ ,2])
sdev <- sd(rel_non_un[ ,2])
obaer_bysat[4,1] <- sdev/sqrt(nrow(rel_non_un))
obaer_bysat[3,2] <- mean(rel_non_sat[ ,2])
sdev <- sd(rel_non_sat[ ,2])
obaer_bysat[4,2] <- sdev/sqrt(nrow(rel_non_sat))
obaer_bysat[3,3] <- mean(rel_non_sathi[ ,2])
sdev <- sd(rel_non_sathi[ ,2])
obaer_bysat[4,3] <- sdev/sqrt(nrow(rel_non_sathi))

y0_nat <- (obaer_bysat["Native", ] - obaer_bysat["NatSE", ])*100
y1_nat <- (obaer_bysat["Native", ] + obaer_bysat["NatSE", ])*100

y0_non <- (obaer_bysat["Non-Native", ] - obaer_bysat["NonSE", ])*100
y1_non <- (obaer_bysat["Non-Native", ] + obaer_bysat["NonSE", ])*100
```

```{r plot of obaer by satlev}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 4, 3, 1 ))
par(xpd = NA)
plot.window(xlim = c(0,3), ylim = c(50,100))

points(x = c(0.5,1.5,2.5), y = obaer_bysat["Native", ]*100, pch = 20)
axis(side = 1, labels = colnames(obaer_bysat), at = c(0.5,1.5,2.5))
axis(side = 2, at = c(10:20)*5, labels = T) 
mtext("Relative Abundance", side = 2, at = 75, line = 2)
mtext("Obligate Aerobes", side = 1, at = 0.5, line = -1, las = 1)

points(x = c(0.5,1.5,2.5), y = obaer_bysat["Non-Native", ]*100, pch = 21)
arrows(y0 = y0_nat, y1 = y1_nat, x0 = c(0.5,1.5,2.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(y0 = y0_non, y1 = y1_non, x0 = c(0.5,1.5,2.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)

legend("bottomright", c("Native", "Non-Native"), pch = c(20,21), xpd = T, bty = "n")
box()
```


```{r bugbase, echo = F, include = F}
bbase <- read.table("data/bb_predictions.txt", header = T, sep = "\t")
rownames(bbase) <- bbase$X

bbase_nat <- bbase[grepl("Nat", rownames(bbase)), ]
bbase_non <- bbase[grepl("Inv", rownames(bbase)), ]

oxbylin <- matrix(NA, nrow = 2, ncol = 3)
rownames(oxbylin) <- c("Native", "Non-Native")
colnames(oxbylin) <- c("Aerobes","Facultative Anaerobes", "Anaerobes")
NatSE <- numeric()
NonSE <- numeric()

oxbylin[1,1] <- mean(bbase_nat$Aerobic)
sdev <- sd(bbase_nat$Aerobic)
NatSE <- sdev/sqrt(nrow(bbase_nat))
oxbylin[1,2] <- mean(bbase_nat$Facultatively_Anaerobic)
sdev <- sd(bbase_nat$Facultatively_Anaerobic)
NatSE <- c(NatSE, sdev/sqrt(nrow(bbase_nat)))
oxbylin[1,3] <- mean(bbase_nat$Anaerobic)
sdev <- sd(bbase_nat$Anaerobic)
NatSE <- c(NatSE, sdev/sqrt(nrow(bbase_nat)))

oxbylin[2,1] <- mean(bbase_non$Aerobic)
sdev <- sd(bbase_non$Aerobic)
NonSE <- sdev/sqrt(nrow(bbase_non))
oxbylin[2,2] <- mean(bbase_non$Facultatively_Anaerobic)
sdev <- sd(bbase_non$Facultatively_Anaerobic)
NonSE <- c(NonSE, sdev/sqrt(nrow(bbase_non)))
oxbylin[2,3] <- mean(bbase_non$Anaerobic)
sdev <- sd(bbase_non$Anaerobic)
NonSE <- c(NonSE, sdev/sqrt(nrow(bbase_non)))

x0_nat <- (oxbylin["Native", ] - NatSE )
x1_nat <- (oxbylin["Native", ] + NatSE )

x0_non <- (oxbylin["Non-Native", ] - NonSE )
x1_non <- (oxbylin["Non-Native", ] + NonSE )

an_bb_aer <- aov(bbase$Aerobic ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_bb_aer)

an_bb_an <- aov(bbase$Anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_bb_an)

an_bb_facan <- aov(bbase$Facultatively_Anaerobic ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_bb_facan)

an_bb_ost <- aov(bbase$Stress_Tolerant ~ Lineage * Sat_lev, data = meta_alpha)
summary(an_bb_ost)

```

```{r Rel abund by oxygen requirement bb, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = oxbylin, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
axis(side = 2, las = 1, labels = c("Aerobes", "anaerobes", "Facultative", "Anaerobes"), at = c(2,4.5,5.5,8), tick = F)
axis(side = 2, las = 1, labels = F, at = c(2,5,8))
mtext("P-values",side = 4, las = 1, line = 2, at = 10, cex = 1)
mtext(c("Lineage","Site", "L X S"),side = 4, las = 1, line = c(-0.5,3,6), at = 9, cex = 0.9)

arrows(x0 = 1.2, y0 = 1, y1 = 8.5, angle = 90, length = 0.5, lwd = 0.75)
arrows(x0 = 1.45, y0 = 1, y1 = 8.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("0.003","<0.001","0.105"),side = 4, line = 3, at = c(2,5,8), las = 1, cex = 0.8)
mtext(c("0.917","0.528","0.616"),side = 4, line = 0, at = c(2,5,8), las = 1, cex = 0.8)
mtext(c("0.004","0.124","0.030"),side = 4, line = 6, at = c(2,5,8), las = 1, cex = 0.8)



legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r saturation and fac anaerobes}
natunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Nat"]
nonunsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "UN" & meta_alpha$Lineage == "Inv"]
natsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Nat"]
nonsat_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT" & meta_alpha$Lineage == "Inv"]
natsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Nat"]
nonsathi_sites <- meta_alpha$Code[meta_alpha$Sat_lev == "SAT_HI" & meta_alpha$Lineage == "Inv"]
nat_un_bb <- bbase[natunsat_sites, ]
non_un_bb <- bbase[nonunsat_sites, ]
nat_sat_bb <- bbase[natsat_sites, ]
non_sat_bb <- bbase[nonsat_sites, ]
nat_sathi_bb <- bbase[natsathi_sites, ]
non_sathi_bb <- bbase[nonsathi_sites, ]

aer_bysat <- matrix(NA, nrow = 4, ncol = 3)
rownames(aer_bysat) <- c("Native", "NatSE", "Non-Native", "NonSE")
colnames(aer_bysat) <- c("Unsaturated","Saturated", "HighWater")

aer_bysat[1,1] <- mean(nat_un_bb$Aerobic)
sdev <- sd(nat_un_bb$Aerobic)
aer_bysat[2,1] <- sdev/sqrt(nrow(nat_un_bb))
aer_bysat[1,2] <- mean(nat_sat_bb$Aerobic)
sdev <- sd(nat_sat_bb$Aerobic)
aer_bysat[2,2] <- sdev/sqrt(nrow(nat_sat_bb))
aer_bysat[1,3] <- mean(nat_sathi_bb$Aerobic)
sdev <- sd(nat_sathi_bb$Aerobic)
aer_bysat[2,3] <- sdev/sqrt(nrow(nat_sathi_bb))

aer_bysat[3,1] <- mean(non_un_bb$Aerobic)
sdev <- sd(non_un_bb$Aerobic)
aer_bysat[4,1] <- sdev/sqrt(nrow(non_un_bb))
aer_bysat[3,2] <- mean(non_sat_bb$Aerobic)
sdev <- sd(non_sat_bb$Aerobic)
aer_bysat[4,2] <- sdev/sqrt(nrow(non_sat_bb))
aer_bysat[3,3] <- mean(non_sathi_bb$Aerobic)
sdev <- sd(non_sathi_bb$Aerobic)
aer_bysat[4,3] <- sdev/sqrt(nrow(non_sathi_bb))

y0_nat <- (aer_bysat["Native", ] - aer_bysat["NatSE", ])
y1_nat <- (aer_bysat["Native", ] + aer_bysat["NatSE", ])

y0_non <- (aer_bysat["Non-Native", ] - aer_bysat["NonSE", ])
y1_non <- (aer_bysat["Non-Native", ] + aer_bysat["NonSE", ])

aer <- t(aer_bysat)

meta_bb <- inner_join(bbase, metadata, by = c("X"="Code"))

unsat <- meta_bb[meta_bb$Sat_lev == "UN", ]
satur <- meta_bb[meta_bb$Sat_lev == "SAT", ]
sathi <- meta_bb[meta_bb$Sat_lev == "SAT_HI", ]

aer_un <- aov(unsat$Aerobic ~ unsat$Lineage)
summary(aer_un)

aer_sat <- aov(satur$Aerobic ~ satur$Lineage)
summary(aer_sat)

aer_sathi <- aov(sathi$Aerobic ~ sathi$Lineage)
summary(aer_sathi)

```

```{r plot of obaer by satlev}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 1, 4 ))
par(xpd = NA)
plot.window(xlim = c(0,3), ylim = c(0,1))

barplot(height = aer_bysat[c(1,3), ], pch = 20, beside = T, horiz = T, axisnames = F, xlim = c(0,1), col = c("white", "gray"))
axis(side = 2, las = 1, labels = c("Unsaturated", "Saturated", "High Water"), at = c(2,5,8))
#axis(side = 1, labels = colnames(obaer_bysat), at = c(0.5,1.5,2.5))
#axis(side = 2, at = c(13:17)*5, labels = T, las = 1) 
mtext("Relative Abundance", side = 1, at = .5, line = 2)
mtext("Obligate Aerobes", side = 3, at = 0.2, line = 0, las = 1)

#points(x = c(0.5,1.5,2.5), y = aer_bysat["Non-Native", ]*100, pch = 21)
arrows(x0 = y0_nat, x1 = y1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = y0_non, x1 = y1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)

mtext(c("P=0.173","P=0.894","P=0.456"),side = 4, line = -3, at = c(2,5,8), las = 1, cex = 0.8)



```

```{r facan by sat level, echo = F, include = T}
facan_bysat <- matrix(NA, nrow = 4, ncol = 3)
rownames(facan_bysat) <- c("Native", "NatSE", "Non-Native", "NonSE")
colnames(facan_bysat) <- c("Unsaturated","Saturated", "High Water")

facan_bysat[1,1] <- mean(nat_un_bb$Facultatively_Anaerobic)
sdev <- sd(nat_un_bb$Facultatively_Anaerobic)
facan_bysat[2,1] <- sdev/sqrt(nrow(nat_un_bb))
facan_bysat[1,2] <- mean(nat_sat_bb$Facultatively_Anaerobic)
sdev <- sd(nat_sat_bb$Facultatively_Anaerobic)
facan_bysat[2,2] <- sdev/sqrt(nrow(nat_sat_bb))
facan_bysat[1,3] <- mean(nat_sathi_bb$Facultatively_Anaerobic)
sdev <- sd(nat_sathi_bb$Facultatively_Anaerobic)
facan_bysat[2,3] <- sdev/sqrt(nrow(nat_sathi_bb))

facan_bysat[3,1] <- mean(non_un_bb$Facultatively_Anaerobic)
sdev <- sd(non_un_bb$Facultatively_Anaerobic)
facan_bysat[4,1] <- sdev/sqrt(nrow(non_un_bb))
facan_bysat[3,2] <- mean(non_sat_bb$Facultatively_Anaerobic)
sdev <- sd(non_sat_bb$Facultatively_Anaerobic)
facan_bysat[4,2] <- sdev/sqrt(nrow(non_sat_bb))
facan_bysat[3,3] <- mean(non_sathi_bb$Facultatively_Anaerobic)
sdev <- sd(non_sathi_bb$Facultatively_Anaerobic)
facan_bysat[4,3] <- sdev/sqrt(nrow(non_sathi_bb))

y0_nat <- (facan_bysat["Native", ] - facan_bysat["NatSE", ])
y1_nat <- (facan_bysat["Native", ] + facan_bysat["NatSE", ])

y0_non <- (facan_bysat["Non-Native", ] - facan_bysat["NonSE", ])
y1_non <- (facan_bysat["Non-Native", ] + facan_bysat["NonSE", ])


facan_un <- aov(unsat$Facultatively_Anaerobic ~ unsat$Lineage)
summary(facan_un)

facan_sat <- aov(satur$Facultatively_Anaerobic ~ satur$Lineage)
summary(facan_sat)

facan_sathi <- aov(sathi$Facultatively_Anaerobic ~ sathi$Lineage)
summary(facan_sathi)
```

```{r plot of facan by satlev}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 1, 4 ))
par(xpd = NA)
plot.window(xlim = c(0,3), ylim = c(0,1))

barplot(height = facan_bysat[c(1,3), ], beside = T, horiz = T, axisnames = F, xlim = c(0,1), col = c("white", "gray"))
axis(side = 2, las = 1, labels = c("Unsaturated", "Saturated", "High Water"), at = c(2,5,8))
#axis(side = 1, labels = colnames(obaer_bysat), at = c(0.5,1.5,2.5))
#axis(side = 2, at = c(13:17)*5, labels = T, las = 1) 
mtext("Relative Abundance", side = 1, at = .5, line = 2)
mtext("Facultative Anaerobes", side = 3, at = 0.8, line = 0, las = 1)
#mtext("Significance", side = 3, at = 0.5, line = 0, las = 1, cex = 0.8)

#points(x = c(0.5,1.5,2.5), y = aer_bysat["Non-Native", ]*100, pch = 21)
arrows(x0 = y0_nat, x1 = y1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = y0_non, x1 = y1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)

mtext(c("P=0.757","P=0.023","P=0.197"),side = 4, line = -10, at = c(2,5,8), las = 1, cex = 0.8)

```

```{r facan by sat level, echo = F, include = T}
an_bysat <- matrix(NA, nrow = 4, ncol = 3)
rownames(an_bysat) <- c("Native", "NatSE", "Non-Native", "NonSE")
colnames(an_bysat) <- c("Unsaturated","Saturated", "High Water")

an_bysat[1,1] <- mean(nat_un_bb$Anaerobic)
sdev <- sd(nat_un_bb$Anaerobic)
an_bysat[2,1] <- sdev/sqrt(nrow(nat_un_bb))
an_bysat[1,2] <- mean(nat_sat_bb$Anaerobic)
sdev <- sd(nat_sat_bb$Anaerobic)
an_bysat[2,2] <- sdev/sqrt(nrow(nat_sat_bb))
an_bysat[1,3] <- mean(nat_sathi_bb$Anaerobic)
sdev <- sd(nat_sathi_bb$Anaerobic)
an_bysat[2,3] <- sdev/sqrt(nrow(nat_sathi_bb))

an_bysat[3,1] <- mean(non_un_bb$Anaerobic)
sdev <- sd(non_un_bb$Anaerobic)
an_bysat[4,1] <- sdev/sqrt(nrow(non_un_bb))
an_bysat[3,2] <- mean(non_sat_bb$Anaerobic)
sdev <- sd(non_sat_bb$Anaerobic)
an_bysat[4,2] <- sdev/sqrt(nrow(non_sat_bb))
an_bysat[3,3] <- mean(non_sathi_bb$Anaerobic)
sdev <- sd(non_sathi_bb$Anaerobic)
an_bysat[4,3] <- sdev/sqrt(nrow(non_sathi_bb))

y0_nat <- (an_bysat["Native", ] - an_bysat["NatSE", ])
y1_nat <- (an_bysat["Native", ] + an_bysat["NatSE", ])

y0_non <- (an_bysat["Non-Native", ] - an_bysat["NonSE", ])
y1_non <- (an_bysat["Non-Native", ] + an_bysat["NonSE", ])

an_un <- aov(unsat$Anaerobic ~ unsat$Lineage)
summary(an_un)

an_sat <- aov(satur$Anaerobic ~ satur$Lineage)
summary(an_sat)

an_sathi <- aov(sathi$Anaerobic ~ sathi$Lineage)
summary(an_sathi) 
```

```{r plot of an by satlev}
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 1, 4 ))
par(xpd = NA)
plot.window(xlim = c(0,3), ylim = c(0,1))

barplot(height = an_bysat[c(1,3), ], beside = T, horiz = T, axisnames = F, xlim = c(0,1), col = c("white", "gray"))
axis(side = 2, las = 1, labels = c("Unsaturated", "Saturated", "High Water"), at = c(2,5,8))
#axis(side = 1, labels = colnames(obaer_bysat), at = c(0.5,1.5,2.5))
#axis(side = 2, at = c(13:17)*5, labels = T, las = 1) 
mtext("Relative Abundance", side = 1, at = .5, line = 2)
mtext("Anaerobes", side = 3, at = 0.8, line = 0, las = 1)

#points(x = c(0.5,1.5,2.5), y = aer_bysat["Non-Native", ]*100, pch = 21)
arrows(x0 = y0_nat, x1 = y1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = y0_non, x1 = y1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)

mtext(c("P=0.605","P=0.513","P=0.951"),side = 4, line = -10, at = c(2,5,8), las = 1, cex = 0.8)


legend(x=0.8, y=4, c("Native", "Non-Native"), pch = 22, col = "black", pt.bg = c("white","dark gray"), xpd = T, bty = "n")

```

#ALL the regressions

```{r regressions, echo = F, include = T}
library(pryr)
#percent col vs sat
meta_alpha$SoilP <- as.numeric(meta_alpha$SoilP)
meta_alpha$SoilN <- as.numeric(meta_alpha$SoilN)
meta_top_phyla$SoilP <- as.numeric(meta_top_phyla$SoilP)
meta_top_phyla$SoilN <- as.numeric(meta_top_phyla$SoilN)

#Shannon vs. sat

regnat.p2.1 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.1)
reginv.p2.1 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.1)


p2.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Shannon Diversity", las = 1)
  abline(regnat.p2.1, lty = 2)
  abline(reginv.p2.1)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p2.2 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.2)
reginv.p2.2 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.2)


p2.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Shannon Diversity", las = 1)
  abline(regnat.p2.2, lty = 2)
  abline(reginv.p2.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs N

regnat.p2.3 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p2.3)
reginv.p2.3 <- lm(meta_alpha$npshannon[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p2.3)


p2.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$npshannon, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Shannon Diversity", las = 1)
  abline(regnat.p2.3, lty = 2)
  abline(reginv.p2.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs. sat

regnat.p3.1 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.1)
reginv.p3.1 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.1)


p3.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Chao Richness", las = 1)
  abline(regnat.p3.1, lty = 2)
  abline(reginv.p3.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p3.2 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.2)
reginv.p3.2 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.2)


p3.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Chao Richness", las = 1)
  abline(regnat.p3.2, lty = 2)
  abline(reginv.p3.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs N

regnat.p3.3 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p3.3)
reginv.p3.3 <- lm(meta_alpha$chao[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p3.3)


p3.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$chao, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Chao Richness", las = 1)
  abline(regnat.p3.3, lty = 2)
  abline(reginv.p3.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs. sat

regnat.p4.1 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p4.1 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.1)


p4.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Bacterial Species Observed", las = 1)
  abline(regnat.p4.1, lty = 2)
  abline(reginv.p4.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs P

regnat.p4.2 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.2)
reginv.p4.2 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.2)


p4.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Bacterial Species Observed", las = 1)
  abline(regnat.p4.2, lty = 2)
  abline(reginv.p4.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#sobs vs N

regnat.p4.3 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.3)
reginv.p4.3 <- lm(meta_alpha$sobs[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p4.3)


p4.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_alpha$sobs, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Bacterial Species Observed", las = 1)
  abline(regnat.p4.3, lty = 2)
  abline(reginv.p4.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs. sat

a1pts <- pcoa.pts[ , 1]

regnat.p5.1 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p5.1 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.1)


p5.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.1, lty = 2)
  abline(reginv.p5.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs P

regnat.p5.2 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p5.2)
reginv.p5.2 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.2)


p5.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.2, lty = 2)
  abline(reginv.p5.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs N

regnat.p5.3 <- lm(a1pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p5.3)
reginv.p5.3 <- lm(a1pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p5.3)


p5.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = a1pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.3, lty = 2)
  abline(reginv.p5.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs. sat

a2pts <- pcoa.pts[ , 2]

regnat.p6.1 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.1)
reginv.p6.1 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.1)


p6.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 2", las = 1)
  abline(regnat.p6.1, lty = 2)
  abline(reginv.p6.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs P

regnat.p6.2 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.2)
reginv.p6.2 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.2)


p6.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 2", las = 1)
  abline(regnat.p6.2, lty = 2)
  abline(reginv.p6.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs N

regnat.p6.3 <- lm(a2pts[grepl("Nat", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p6.3)
reginv.p6.3 <- lm(a2pts[grepl("Inv", rownames(pcoa.pts))] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p6.3)


p6.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = a2pts, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 2", las = 1)
  abline(regnat.p6.3, lty = 2)
  abline(reginv.p6.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Proteo Rel. Abund vs. sat

regnat.p7.1 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p7.1)
reginv.p7.1 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p7.1)


p7.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_phyla$Sat, y = meta_top_phyla$Proteobacteria, pch = pchs[as.character(meta_top_phyla$Lineage)], xlab = "Soil Saturation", ylab = "Proteobacteria Relative Abundance", las = 1)
  abline(regnat.p7.1, lty = 2)
  abline(reginv.p7.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Proteo Rel. Abund vs P

regnat.p7.2 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$SoilP[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p7.2)
reginv.p7.2 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$SoilP[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p7.2)


p7.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_phyla$SoilP, y = meta_top_phyla$Proteobacteria, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Proteobacteria Relative Abundance", las = 1)
  abline(regnat.p7.2, lty = 2)
  abline(reginv.p7.2)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs N

regnat.p7.3 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p7.3)
reginv.p7.3 <- lm(meta_top_phyla$Proteobacteria[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p7.3)


p7.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_phyla$SoilN, y = meta_top_phyla$Proteobacteria, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Proteobacteria Relative Abundance", las = 1)
  abline(regnat.p7.3, lty = 2)
  abline(reginv.p7.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs. sat

regnat.p8.1 <- lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p8.1)
reginv.p8.1 <- lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p8.1)


p8.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_top_phyla$Bacteroidetes, pch = pchs[as.character(meta_top_phyla$Lineage)], xlab = "Soil Saturation", ylab = "Bacteriodetes Relative Abundance", las = 1)
  abline(regnat.p8.1, lty = 2)
  abline(reginv.p8.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs P

regnat.p8.2 <- lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p8.2)
reginv.p8.2 <-lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p8.2)


p8.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_top_phyla$Bacteroidetes, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Bacteroidetes Relative Abundance", las = 1)
  abline(regnat.p8.2, lty = 2)
  abline(reginv.p8.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs N

regnat.p8.3 <- lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p8.3)
reginv.p8.3 <- lm(meta_top_phyla$Bacteroidetes[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p8.3)


p8.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_top_phyla$Bacteroidetes, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Bacteroidetes Relative Abundance", las = 1)
  abline(regnat.p8.3, lty = 2)
  abline(reginv.p8.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sap Rel. Abund vs Sat

regnat.p9.1 <- lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p9.1)
reginv.p9.1 <- lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$Sat[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p9.1)


p9.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_top_phyla$Firmicutes, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Firmicutes Relative Abundance", las = 1)
  abline(regnat.p9.1, lty = 2)
  abline(reginv.p9.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}
#Sap Rel. Abund vs P

regnat.p9.2 <-lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$SoilP[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p9.2)
reginv.p9.2 <- lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$SoilP[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p9.2)


p9.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_top_phyla$Firmicutes, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Firmicutes Relative Abundance", las = 1)
  abline(regnat.p9.2, lty = 2)
  abline(reginv.p9.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs N

regnat.p9.3 <- lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Nat"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Nat"])
summary(regnat.p9.3)
reginv.p9.3 <- lm(meta_top_phyla$Firmicutes[meta_top_phyla$Lineage == "Inv"] ~ meta_top_phyla$SoilN[meta_top_phyla$Lineage == "Inv"])
summary(reginv.p9.3)


p9.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_top_phyla$Firmicutes, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Firmicutes Relative Abundance", las = 1)
  abline(regnat.p9.3, lty = 2)
  abline(reginv.p9.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Actino vs. sat

regnat.p10.1 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p10.1)
reginv.p10.1 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p10.1)


p10.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = meta_top_phyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Actinobacteria Relative Abundance", las = 1)
  abline(regnat.p10.1, lty = 2)
  abline(reginv.p10.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Gib Rel. Abund vs P

regnat.p10.2 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p10.2)
reginv.p10.2 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p10.2)


p10.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = meta_top_phyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil P", ylab = "Actinobacteria Relative Abundance", las = 1)
  abline(regnat.p10.2, lty = 2)
  abline(reginv.p10.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Gib Rel. Abund vs N

regnat.p10.3 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p10.3)
reginv.p10.3 <- lm(meta_top_phyla$Actinobacteria[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p10.3)


p10.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = meta_top_phyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil N", ylab = "Actinobacteria Relative Abundance", las = 1)
  abline(regnat.p10.3, lty = 2)
  abline(reginv.p10.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p11.1 <- lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p11.1)
reginv.p11.1 <- lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p11.1)


p11.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Pseudomonas Relative Abundance", las = 1)
  abline(regnat.p11.1, lty = 2)
  abline(reginv.p11.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p11.2 <-lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p11.2)
reginv.p11.2 <- lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p11.2)


p11.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Pseudomonas Relative Abundance", las = 1)
  abline(regnat.p11.2, lty = 2)
  abline(reginv.p11.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p11.3 <- lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p11.3)
reginv.p11.3 <- lm(topgenus_ra$Pseudomonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p11.3)


p11.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Pseudomonas Relative Abundance", las = 1)
  abline(regnat.p11.3, lty = 2)
  abline(reginv.p11.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p12.1 <- lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p12.1)
reginv.p12.1 <- lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p12.1)


p12.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Flavobacterium Relative Abundance", las = 1)
  abline(regnat.p12.1, lty = 2)
  abline(reginv.p12.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p12.2 <-lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p12.2)
reginv.p12.2 <- lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p12.2)


p12.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Flavobacterium Relative Abundance", las = 1)
  abline(regnat.p12.2, lty = 2)
  abline(reginv.p12.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p12.3 <- lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p12.3)
reginv.p12.3 <- lm(topgenus_ra$Flavobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p12.3)


p12.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Flavobacterium Relative Abundance", las = 1)
  abline(regnat.p12.3, lty = 2)
  abline(reginv.p12.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p13.1 <- lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p13.1)
reginv.p13.1 <- lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p13.1)


p13.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Janthinobacterium Relative Abundance", las = 1)
  abline(regnat.p13.1, lty = 2)
  abline(reginv.p13.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p13.2 <-lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p13.2)
reginv.p13.2 <- lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p13.2)


p13.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Janthinobacterium Relative Abundance", las = 1)
  abline(regnat.p13.2, lty = 2)
  abline(reginv.p13.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p13.3 <- lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p13.3)
reginv.p13.3 <- lm(topgenus_ra$Janthinobacterium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p13.3)


p13.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Janthinobacterium Relative Abundance", las = 1)
  abline(regnat.p13.3, lty = 2)
  abline(reginv.p13.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p14.1 <- lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p14.1)
reginv.p14.1 <- lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p14.1)


p14.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Rhizobium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Rhizobium Relative Abundance", las = 1)
  abline(regnat.p14.1, lty = 2)
  abline(reginv.p14.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p14.2 <-lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p14.2)
reginv.p14.2 <- lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p14.2)


p14.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Rhizobium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Rhizobium Relative Abundance", las = 1)
  abline(regnat.p14.2, lty = 2)
  abline(reginv.p14.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p14.3 <- lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p14.3)
reginv.p14.3 <- lm(topgenus_ra$Rhizobium[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p14.3)


p14.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Rhizobium, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Rhizobium Relative Abundance", las = 1)
  abline(regnat.p14.3, lty = 2)
  abline(reginv.p14.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}


#Stag Rel. Abund vs. sat

regnat.p15.1 <- lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p15.1)
reginv.p15.1 <- lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p15.1)


p15.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Duganella, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Duganella Relative Abundance", las = 1)
  abline(regnat.p15.1, lty = 2)
  abline(reginv.p15.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p15.2 <-lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p15.2)
reginv.p15.2 <- lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p15.2)


p15.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Duganella, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Duganella Relative Abundance", las = 1)
  abline(regnat.p15.2, lty = 2)
  abline(reginv.p15.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p15.3 <- lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p15.3)
reginv.p15.3 <- lm(topgenus_ra$Duganella[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p15.3)


p15.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Duganella, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Duganella Relative Abundance", las = 1)
  abline(regnat.p15.3, lty = 2)
  abline(reginv.p15.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p16.1 <- lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p16.1)
reginv.p16.1 <- lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p16.1)


p16.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Trichococcus, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Trichococcus Relative Abundance", las = 1)
  abline(regnat.p16.1, lty = 2)
  abline(reginv.p16.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p16.2 <-lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p16.2)
reginv.p16.2 <- lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p16.2)


p16.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Trichococcus, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Duganella Relative Abundance", las = 1)
  abline(regnat.p16.2, lty = 2)
  abline(reginv.p16.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p16.3 <- lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p16.3)
reginv.p16.3 <- lm(topgenus_ra$Trichococcus[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p16.3)


p16.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Trichococcus, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Trichococcus Relative Abundance", las = 1)
  abline(regnat.p16.3, lty = 2)
  abline(reginv.p16.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p17.1 <- lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p17.1)
reginv.p17.1 <- lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p17.1)


p17.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = topgenus_ra$Aeromonas, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Aeromonas Relative Abundance", las = 1)
  abline(regnat.p17.1, lty = 2)
  abline(reginv.p17.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p17.2 <-lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p17.2)
reginv.p17.2 <- lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p17.2)


p17.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = topgenus_ra$Aeromonas, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Aeromonas Relative Abundance", las = 1)
  abline(regnat.p17.2, lty = 2)
  abline(reginv.p17.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p17.3 <- lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p17.3)
reginv.p17.3 <- lm(topgenus_ra$Aeromonas[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p17.3)


p17.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = topgenus_ra$Aeromonas, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Aeromonas Relative Abundance", las = 1)
  abline(regnat.p17.3, lty = 2)
  abline(reginv.p17.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p18.1 <- lm(bbase$Aerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p18.1)
reginv.p18.1 <- lm(bbase$Aerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p18.1)


p18.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = bbase$Aerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Aerobe Relative Abundance", las = 1)
  abline(regnat.p18.1, lty = 2)
  abline(reginv.p18.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p18.2 <-lm(bbase$Aerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p18.2)
reginv.p18.2 <- lm(bbase$Aerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p18.2)


p18.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = bbase$Aerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Aerobe Relative Abundance", las = 1)
  abline(regnat.p18.2, lty = 2)
  abline(reginv.p18.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p18.3 <- lm(bbase$Aerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p18.3)
reginv.p18.3 <- lm(bbase$Aerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p18.3)


p18.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = bbase$Aerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Aerobe Relative Abundance", las = 1)
  abline(regnat.p18.3, lty = 2)
  abline(reginv.p18.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p19.1 <- lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p19.1)
reginv.p19.1 <- lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p19.1)


p19.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  abline(regnat.p19.1, lty = 2)
  abline(reginv.p19.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p19.2 <-lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p19.2)
reginv.p19.2 <- lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p19.2)


p19.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  abline(regnat.p19.2, lty = 2)
  abline(reginv.p19.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p19.3 <- lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p19.3)
reginv.p19.3 <- lm(bbase$Facultatively_Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p19.3)


p19.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  abline(regnat.p19.3, lty = 2)
  abline(reginv.p19.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p20.1 <- lm(bbase$Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Nat"])
summary(regnat.p20.1)
reginv.p20.1 <- lm(bbase$Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$Sat[meta_alpha$Lineage == "Inv"])
summary(reginv.p20.1)


p20.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$Sat, y = bbase$Anaerobic, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Anaerobe Relative Abundance", las = 1)
  abline(regnat.p20.1, lty = 2)
  abline(reginv.p20.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p20.2 <-lm(bbase$Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Nat"])
summary(regnat.p20.2)
reginv.p20.2 <- lm(bbase$Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilP[meta_alpha$Lineage == "Inv"])
summary(reginv.p20.2)


p20.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilP, y = bbase$Anaerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil P", ylab = "Anaerobe Relative Abundance", las = 1)
  abline(regnat.p20.2, lty = 2)
  abline(reginv.p20.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p20.3 <- lm(bbase$Anaerobic[meta_alpha$Lineage == "Nat"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Nat"])
summary(regnat.p20.3)
reginv.p20.3 <- lm(bbase$Anaerobic[meta_alpha$Lineage == "Inv"] ~ meta_alpha$SoilN[meta_alpha$Lineage == "Inv"])
summary(reginv.p20.3)


p20.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha$SoilN, y = bbase$Anaerobic, pch = pchs[as.character(meta_alpha$Lineage)], xlab = "Soil N", ylab = "Anaerobe Relative Abundance", las = 1)
  abline(regnat.p20.3, lty = 2)
  abline(reginv.p20.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}


```
```{r regression plots, echo = F, include = T}

# Display the saved plot


p1.1
p1.2
p1.3
p2.1
p2.2
p2.3
p3.1
p3.2
p3.3
p4.1
p4.2
p4.3
p5.1
p5.2
p5.3
p6.1
p6.2
p6.3
p7.1
p7.2
p7.3
p8.1
p8.2
p8.3
p9.1
p9.2
p9.3
p10.1
p10.2
p10.3
p11.1
p11.2
p11.3
p12.1
p12.2
p12.3
p13.1
p13.2
p13.3
p14.1
p14.2
p14.3
p15.1
p15.2
p15.3
p16.1
p16.2
p16.3
p17.1
p17.2
p17.3
p18.1
p18.2
p18.3
p19.1
p19.2
p19.3
p20.1
p20.2
p20.3
```
```{r ANCOVAs, echo = F, include = T}



#Shannon
results <- lm(npshannon ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Chao
results <- lm(chao ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Sobs
results <- lm(sobs ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 1
results <- lm(a1pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 2
results <- lm(a2pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Proteo RA
results <- lm(Proteobacteria ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#firmicutes RA
results <- lm(Firmicutes ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Bact RA
results <- lm(Bacteroidetes ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Act RA
results <- lm(Actinobacteria ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Pseudo
results <- lm(topgenus_ra$Pseudomonas ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Flavo
results <- lm(topgenus_ra$Flavobacterium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Jantho
results <- lm(topgenus_ra$Janthinobacterium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Rhiz
results <- lm(topgenus_ra$Rhizobium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Dug
results <- lm(topgenus_ra$Duganella ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Tric
results <- lm(topgenus_ra$Trichococcus ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Aeromonas
results <- lm(topgenus_ra$Aeromonas ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

results <- lm(bbase$Aerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#fac an RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2
```

```{r ANOVAs, echo = F, include = T}
library(car)
#Shannon
results <- lm(npshannon ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Chao
results <- lm(chao ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sobs
results <- lm(sobs ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 1
results <- lm(a1pts ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 2
results <- lm(a2pts ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Asco RA
results <- lm(Proteobacteria ~  Lineage * Site, data = meta_top_phyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Basidio RA
results <- lm(Firmicutes ~  Lineage * Site, data = meta_top_phyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Bacteriodetes RA
results <- lm(Bacteroidetes ~  Lineage * Site, data = meta_top_phyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Actinobacteria RA
results <- lm(Actinobacteria ~  Lineage * Site, data = meta_top_phyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Psuedo RA
results <- lm(topgenus_ra$Pseudomonas ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Flavobacterium RA
results <- lm(topgenus_ra$Flavobacterium ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Janthinobacterium RA
results <- lm(topgenus_ra$Janthinobacterium ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#rhizobium
results <- lm(topgenus_ra$Rhizobium ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#duganella
results <- lm(topgenus_ra$Duganella ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#tric RA
results <- lm(topgenus_ra$Trichococcus ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aeromonas
results <- lm(topgenus_ra$Aeromonas ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aerobe RA
results <- lm(bbase$Aerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#facan RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage * Site, data = meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova


```