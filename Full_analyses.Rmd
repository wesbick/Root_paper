---
title: "Root_paper_full"
author: "Wes Bickford"
date: "6/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
library(permute); library(vegan); library(dplyr); library(knitr); library(ape); library(DAAG); library(MASS); library(car); library(pryr); library(car)
```

Load data

```{r load data, include = F, echo = F}
metadata <- read.csv(file = "~/git_repos/Root_paper/bacteria/data/15metadata.csv", stringsAsFactors = F)
metadata$SoilN <- as.numeric(metadata$SoilN)
metadata$SoilP <- as.numeric(metadata$SoilP)


#fungal colonization
percol15 <- read.csv("~/git_repos/Root_paper/microscopy/root_col_15.csv", stringsAsFactors = F)
meta_col <- inner_join(metadata, percol15, by = c("Code"="SampleID"))
meta_col$Site.x <- as.factor(meta_col$Site.x)
meta_col$TisN <- as.numeric(meta_col$TisN)
meta_col$SoilP <- as.numeric(meta_col$SoilP)
meta_col$SoilN <- as.numeric(meta_col$SoilN)
meta_col$Sat <- as.numeric(meta_col$Sat)

#fungal alpha diversity from mothur
alphaFUN <- read.table(file = "~/git_repos/Root_paper/ITS/data/Bickford.groups.ave-std.summary", header=T)
Falpha_mean <- alphaFUN[alphaFUN$method == "ave", ]
Falpha_mean$group <- as.character(Falpha_mean$group)
meta_alpha_fun <- inner_join(metadata, Falpha_mean, by = c("Code"="group"))

meta_alpha_fun$Site <- as.factor(meta_alpha_fun$Site)
meta_alpha_fun$Lineage <- as.factor(meta_alpha_fun$Lineage)
meta_alpha_fun$SoilP <- as.numeric(meta_alpha_fun$SoilP)
meta_alpha_fun$SoilN <- as.numeric(meta_alpha_fun$SoilN)
meta_alpha_fun$SoilC <- as.numeric(meta_alpha_fun$SoilC)
meta_alpha_fun$TisN <- as.numeric(meta_alpha_fun$TisN)
meta_alpha_fun$TisP <- as.numeric(meta_alpha_fun$TisP)
meta_alpha_fun$TisC <- as.numeric(meta_alpha_fun$TisC)
meta_alpha_fun$Sat_lev <- as.factor(meta_alpha_fun$Sat_lev)
meta_alpha_fun$Sat <- as.numeric(meta_alpha_fun$Sat)
meta_alpha_fun$Lat <- as.factor(meta_alpha_fun$Lat)

#fungal sequence OTU table
shared_fun <- read.table(file= "~/git_repos/Root_paper/ITS/data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)
shared_fun <- shared_fun[ ,-c(1,2)]

#bacterial alpha diversity
Balpha <- read.table(file = "~/git_repos/Root_paper/bacteria/data/Bickford.groups.ave-std.summary", header=T)

Balpha_mean <- Balpha[Balpha$method == "ave", ]
Balpha_mean$group <- as.character(Balpha_mean$group)

bac_meta_alpha <- inner_join(metadata, Balpha_mean, by = c("Code"="group"))

bac_meta_alpha$Site <- as.factor(bac_meta_alpha$Site)
bac_meta_alpha$Lineage <- as.factor(bac_meta_alpha$Lineage)
bac_meta_alpha$SoilP <- as.numeric(bac_meta_alpha$SoilP)
bac_meta_alpha$SoilN <- as.numeric(bac_meta_alpha$SoilN)
bac_meta_alpha$SoilC <- as.numeric(bac_meta_alpha$SoilC)
bac_meta_alpha$TisN <- as.numeric(bac_meta_alpha$TisN)
bac_meta_alpha$TisP <- as.numeric(bac_meta_alpha$TisP)
bac_meta_alpha$TisC <- as.numeric(bac_meta_alpha$TisC)
bac_meta_alpha$Sat_lev <- as.factor(bac_meta_alpha$Sat_lev)
bac_meta_alpha$Sat <- as.numeric(bac_meta_alpha$Sat)
bac_meta_alpha$Lat <- as.factor(bac_meta_alpha$Lat)


#bacterial sequence OTU table
bac_shared <- read.table(file= "~/git_repos/Root_paper/bacteria/data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)

bac_shared <- bac_shared[ ,-c(1,2)]


#oomycete alpha diversity
oomalpha <- read.table(file = "~/git_repos/Root_paper/Oom/data/Bickford.groups.ave-std.summary", header=T)

oomalpha_mean <- oomalpha[oomalpha$method == "ave", ]
oomalpha_mean$group <- as.character(oomalpha_mean$group)

oom_meta_alpha <- inner_join(metadata, oomalpha_mean, by = c("Code"="group"))

oom_meta_alpha$Lineage <- as.factor(oom_meta_alpha$Lineage)
oom_meta_alpha$Site <- as.factor(oom_meta_alpha$Site)

#oomycete sequence OTU table
oom_shared <- read.table(file= "~/git_repos/Root_paper/Oom/data/Bickford.subsample.shared", header = T, stringsAsFactors = F, row.names = 2)

oom_shared <- oom_shared[ ,-c(1,2)]
```

```{r Figure 1a: nat vs non percol, echo=F, include=T}
nt_percol_mat <- matrix(NA, nrow = 8, ncol = 4)
rownames(nt_percol_mat) <- unique(percol15$Site)
colnames(nt_percol_mat) <- c("Invasive", "Inv_sterr", "Native", "Nat_sterr")

for(ii in rownames(nt_percol_mat)){
  sub <- percol15[percol15$Site == ii & percol15$Lineage == "Inv", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$per_col[pp]
    }
  }else{
    site <- sub$per_col
  }
  nt_percol_mat[ii, 1] <- mean(site)
  nt_percol_mat[ii, 2] <- (sd(site))/(sqrt(num))
  sub <- percol15[percol15$Site == ii & percol15$Lineage == "Nat", ]
  num <- nrow(sub)
  site <- rep(NA, num)
  if(num > 1){
    for(pp in 1:num){
      site[pp] <- sub$per_col[pp]
    }
  }else{
    site <- sub$per_col
  }
  nt_percol_mat[ii, 3] <- mean(site)
  nt_percol_mat[ii, 4] <- (sd(site))/(sqrt(num))
}
nt_by_site <- as.data.frame(nt_percol_mat)


```



```{r Fig. 1, echo = F, include = T}
clrs2 <- c(Nat = "white", Inv = "dark gray")
meta_col$Lineage.x <- as.factor(meta_col$Lineage.x)

png("~/git_repos/Root_paper/Figures/fig1b.png", height = 6, width = 9, units = "in", res = 300)
clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "orange", Rt2 = "gray", SB = "purple")

png("~/git_repos/Root_paper/Figures/fig1.png", height = 6, width = 12, units = "in", res = 300)
quartz.options(height=6 , width = 12)
plot.new()
par(oma = c(1, 1, 1, 1))
par(mar = c(3, 4, 3, 3))
par(mfrow=c(1,2))
#plot.window(xlim = c(0,0.4), ylim = c(0, 0.4))
axis(1)
axis(2)
plot(x = nt_by_site$Native, y = nt_by_site$Invasive, pch = 16, col = clrs[rownames(nt_by_site)], cex = 1.5, xlim = c(0,0.4), ylim = c(0, 0.4), ylab = "Non-Native Percent Colonization")
arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native + nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 90, length = 0.03)
arrows(x0 = nt_by_site$Native, x1 = nt_by_site$Native - nt_by_site$Nat_sterr, y0 = nt_by_site$Invasive, angle = 90, length = 0.03)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive + nt_by_site$Inv_sterr, angle = 90, length = 0.03)
arrows(x0 = nt_by_site$Native, y0 = nt_by_site$Invasive, y1 = nt_by_site$Invasive - nt_by_site$Inv_sterr, angle = 90, length = 0.03)
#points(x = nt_by_site$Native, y = nt_by_site$Invasive, pch = 16, col = clrs[rownames(nt_by_site)], cex = 1.5)
box()
lines(x = c(0,0.5,1), y = c(0,0.5,1), type = "l")
mtext(side = 1, line = 3, text = "Native Percent Colonization")
mtext(text = "a)", las = 1, side = 3, line = -1, at = 0, cex = 1, adj = 0)
#mtext(side = 2, line = 3, text = "Non-Native Percent Colonization")
par(mar = c(3, 4, 3, 3))
boxplot(per_col ~ Lineage.x + Sat_lev, data = meta_col,
        ylab = "Percent Colonization",
        ylim = c(0,0.6), col = clrs2[levels(meta_col$Lineage.x)],
        names = F,
        range = 0)
mtext(text = "b)", las = 1, side = 3, line = -1, at = 0.5, cex = 1, adj = 0)

mtext(side=1, at=c(1.5,3.5,5.5), line=0.5, text = c("Standing Water", "Saturated", "Unsaturated"), cex = 1, font = 2)

legend("topright", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"))

dev.off()
```

Fig. 1: a) Percent fungal colonization of roots of Native and Non-native Phragmites. Each point represents the average colonization at a site in the non-native patches relative vs. the native patches. Error bars indicate standard error. Diagonal line represents equal colonization among plant lineages. Colors represent sites (blue = BL, red = CB, green = CH, coral = CM, black = CR, brown = PLB, gray = Rt2, purple = SB). b) Effects of soil saturation on fungal colonization. Black lines indicate the median; bars indicate the full spread of data.


```{r Fig 2, echo = F, include = T}
alpha_mat <- matrix(NA, nrow = 2, ncol = 2)
rownames(alpha_mat) <- c("Nat", "Inv")
colnames(alpha_mat) <- c("Observed", "Chao")

for(ii in rownames(alpha_mat)){
  sobs <- oom_meta_alpha[oom_meta_alpha$Lineage == ii, "sobs"]
  chao <- oom_meta_alpha[oom_meta_alpha$Lineage == ii, "chao"]
  alpha_mat[ii, 1] <- mean(sobs)
  alpha_mat[ii, 2] <- mean(chao)
}

se_sobs_inv <- sd(oom_meta_alpha[oom_meta_alpha$Lineage == "Inv", "sobs"]) / sqrt(length(oom_meta_alpha[oom_meta_alpha$Lineage == "Inv", "sobs"]))
se_sobs_nat <- sd(oom_meta_alpha[oom_meta_alpha$Lineage == "Nat", "sobs"]) / sqrt(length(oom_meta_alpha[oom_meta_alpha$Lineage == "Nat", "sobs"]))
se_chao_inv <- sd(oom_meta_alpha[oom_meta_alpha$Lineage == "Inv", "chao"]) / sqrt(length(oom_meta_alpha[oom_meta_alpha$Lineage == "Inv", "chao"]))
se_chao_nat <- sd(oom_meta_alpha[oom_meta_alpha$Lineage == "Nat", "chao"]) / sqrt(length(oom_meta_alpha[oom_meta_alpha$Lineage == "Nat", "chao"]))

x0_nat <- c((alpha_mat[1,1] - se_sobs_inv), (alpha_mat[1,2] - se_chao_nat))
x1_nat <- c((alpha_mat[1,1] + se_sobs_inv), (alpha_mat[1,2] + se_chao_nat))

x0_non <- c((alpha_mat[2,1] - se_sobs_inv), (alpha_mat[2,2] - se_chao_inv))
x1_non <- c((alpha_mat[2,1] + se_sobs_inv), (alpha_mat[2,2] + se_chao_inv))


png("~/git_repos/Root_paper/Figures/fig2.png", height = 6, width = 9, units = "in", res = 300)
quartz.options(height=6, width=9)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 5, 5, 8))
par(xpd = NA)

plot.window(xlim = c(0,1), ylim = c(0,18))

barplot(height = alpha_mat, beside=T, horiz = T, axisnames = F, xlab = "Oomycete OTUs", xlim = c(0,50), col = c("white", "gray"))

arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
axis(side = 2, las = 1, labels = colnames(alpha_mat), at = c(2,5))


mtext("P-values",side = 4, line = 3, las = 1, at = 7.5, cex = 1)
#mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-0.5,2.9), at = 6.75, cex = 0.9)
arrows(x0 = 55, y0 = 1, y1 = 6.25, angle = 90, lwd = 0.75, length = 0.5)
arrows(x0 = 60, y0 = 1, y1 = 6.25, angle = 90, lwd = 0.75, length = 0.5)
mtext(c("0.980","0.985","Site"), las = 1, side = 4, line = 3.5, at = c(2,5,6.75), cex = 0.8, adj = 0)
mtext(c("0.048","0.061","Lineage"),side = 4, las = 1, at = c(2,5,6.75), line = 2, cex = 0.8, adj = 1)
mtext(c("0.998","0.994","L X S"),side = 4, las = 1, at = c(2,5,6.75), line = 6.5, cex = 0.8, adj = 0)

legend("bottomright", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), bty = "n", cex = 0.8)

dev.off()
```

```{r PCoA setup, echo = F, include = T}
#bacteria
braybac <- vegdist(sqrt(bac_shared), method = "bray")
pcoa.bac <- cmdscale(braybac, k=(NROW(bac_shared)-1), eig = TRUE, add = TRUE)
bac_pcoa.pts <- as.data.frame(pcoa.bac["points"])
pcoa.eig <- eigenvals(pcoa.bac)
bac_var.axes <- pcoa.eig/sum(pcoa.eig)
bac_var.axes

bac_meta_alpha$SoilP <- as.numeric(bac_meta_alpha$SoilP)
bac_meta_alpha$SoilN <- as.numeric(bac_meta_alpha$SoilN)
bac_meta_alpha$SoilC <- as.numeric(bac_meta_alpha$SoilC)
bac_meta_alpha$TisN <- as.numeric(bac_meta_alpha$TisN)
bac_meta_alpha$TisP <- as.numeric(bac_meta_alpha$TisP)
bac_meta_alpha$TisC <- as.numeric(bac_meta_alpha$TisC)
bac_meta_alpha$Sat <- as.numeric(bac_meta_alpha$Sat)
bac_meta_alpha$Sat_lev <- as.factor(bac_meta_alpha$Sat_lev)
bac_meta_alpha$Lat <- as.factor(bac_meta_alpha$Lat)

bac_ef <- envfit(pcoa.bac, bac_meta_alpha[ , c(3,7,9:10)], na.rm = T)
bac_ef

#fungi
brayfun <- vegdist(sqrt(shared_fun), method = "bray")
pcoa.fun <- cmdscale(brayfun, k=(NROW(shared_fun)-1), eig = TRUE, add = TRUE)
fun_pcoa.pts <- as.data.frame(pcoa.fun["points"])
pcoa.eig <- eigenvals(pcoa.fun)
fun_var.axes <- pcoa.eig/sum(pcoa.eig)

meta_alpha_fun$SoilP <- as.numeric(meta_alpha_fun$SoilP)
meta_alpha_fun$SoilN <- as.numeric(meta_alpha_fun$SoilN)
meta_alpha_fun$SoilC <- as.numeric(meta_alpha_fun$SoilC)
meta_alpha_fun$TisN <- as.numeric(meta_alpha_fun$TisN)
meta_alpha_fun$TisP <- as.numeric(meta_alpha_fun$TisP)
meta_alpha_fun$TisC <- as.numeric(meta_alpha_fun$TisC)
meta_alpha_fun$Sat <- as.numeric(meta_alpha_fun$Sat)
meta_alpha_fun$Sat_lev <- as.factor(meta_alpha_fun$Sat_lev)
meta_alpha_fun$Lat <- as.factor(meta_alpha_fun$Lat)

fun_ef <- envfit(pcoa.fun, meta_alpha_fun[ , c(3,7,9:11)], na.rm = T)
fun_ef

#oomycetes
brayoom <- vegdist(sqrt(oom_shared), method = "bray")
pcoa.oom <- cmdscale(brayoom, k=(NROW(oom_shared)-1), eig = TRUE, add = TRUE)
oom_pcoa.pts <- as.data.frame(pcoa.oom["points"])
pcoa.eig <- eigenvals(pcoa.oom)
oom_var.axes <- pcoa.eig/sum(pcoa.eig)
oom_var.axes

oom_meta_alpha$SoilP <- as.numeric(oom_meta_alpha$SoilP)
oom_meta_alpha$SoilN <- as.numeric(oom_meta_alpha$SoilN)
oom_meta_alpha$SoilC <- as.numeric(oom_meta_alpha$SoilC)
oom_meta_alpha$TisN <- as.numeric(oom_meta_alpha$TisN)
oom_meta_alpha$TisP <- as.numeric(oom_meta_alpha$TisP)
oom_meta_alpha$TisC <- as.numeric(oom_meta_alpha$TisC)
oom_meta_alpha$Sat <- as.numeric(oom_meta_alpha$Sat)
oom_meta_alpha$Sat_lev <- as.factor(oom_meta_alpha$Sat_lev)
oom_meta_alpha$Lat <- as.factor(oom_meta_alpha$Lat)

oom_ef <- envfit(pcoa.oom, oom_meta_alpha[ , c(7,9:10)], na.rm = T)
oom_ef
```
```{r fig 3, include=T, echo = F}

pchs <- c(Nat = 1, Inv = 16)

png("~/git_repos/Root_paper/Figures/fig3.png", height = 3.5, width = 10.5, units = "in", res = 300)
quartz.options(height=8, width=24)
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 4, 2, 2 ))

plot.new()

xx <- c(1,2,3)
lmat <- matrix( xx, nrow = 1, ncol = 3, byrow = T)
layout(lmat)   # function that tells R how to divide up the plot window
#layout.show(3)


#png("~/git_repos/Root_paper/Figures/fig3a.png", height = 6, width = 7.5, units = "in", res = 300)

#3a
plot.new()
plot.window(xlim = c(-0.5,0.5), ylim = c(-0.5,0.5))
par(mar = c( 4, 4, 2, 3 ))
par(xpd = NA)
axis(side = 1)
axis(side = 2, las = 1, at = seq(-0.5, 0.5, by = 0.2))
mtext(side = 1, line = 3, text = "PCo 1 (15.2%)")
mtext(side = 2, line = 3, text = "PCo 2 (7.7%)" )
#par(mar = c( 4, 12, 2, 15 ))
points(x = bac_pcoa.pts[ , 1], y = bac_pcoa.pts[ ,2], asp = 1, pch = pchs[as.character(bac_meta_alpha$Lineage)], 
      col = "black", cex = 1.5, lwd = 2)
mtext(text = "a)", las = 1, side = 3, line = -2, at = -0.5, cex = 1.2, adj = 0)
plot(bac_ef, p.max = 0.1, col = "black")
box()


#3b
plot.new()
par(mar = c( 4, 3, 2, 3 ))
plot.window(xlim = c(-0.5,0.5), ylim = c(-0.5,0.5))
axis(side = 1, at = seq(-0.5, 0.5, by = 0.2))
axis(side = 2, las = 1, at = seq(-0.5, 0.5, by = 0.2))
points(x = fun_pcoa.pts[ , 1], y = fun_pcoa.pts[ ,2], asp = 1, pch = pchs[as.character(meta_alpha_fun$Lineage)], 
      col = "black", cex = 1.5, lwd = 2)

mtext(side = 1, line = 3, text = "PCo 1 (14.2%)")
mtext(side = 2, line = 3, text = "PCo 2 (7.8%)" )

mtext(text = "b)", las = 1, side = 3, line = -2, at = -0.5, cex = 1.2, adj = 0)

plot(fun_ef, p.max = 0.1, col = "black")
box()

#3c
plot.new()
plot.window(xlim = c(-1,1), ylim = c(-1,1))

axis(side = 1)
axis(side = 2, las = 1)

points(x = oom_pcoa.pts[ , 1], y = oom_pcoa.pts[ ,2], asp = 1, pch = pchs[as.character(oom_meta_alpha$Lineage)], 
      col = "black", cex = 1.5, lwd = 2)
mtext(side = 1, line = 3, text = "PCo 1 (12.1%)")
mtext(side = 2, line = 3, text = "PCo 2 (9.8%)" )


mtext(text = "c)", las = 1, side = 3, line = -2, at = -1, cex = 1.2, adj = 0)
axis(side = 1)
axis(side = 2, las = 1)
plot(oom_ef, p.max = 0.1, col = "black")

legend_text2 <- c("Native", "Non-Native")
legend("topright", legend_text2, pch = c(1,16), pt.lwd = 2, pt.cex = 1.5, xpd = T, cex = 1.2)

box()
dev.off()
```

Fig. 3: Principle coordinate analyses (PCoA) of a) bacterial, b) fungal, and c) oomycete communities. Points represent the microbial community within a single root sample. Vectors displayed are environmental fit of variables (Soil N, Soil P, and Soil Saturation) to ordination space significant at the a = 0.10 level (See Table 1 for P-values).

```{r Bacterial Taxonomy setup, echo = F, include = F}
source("~/git_repos/Root_paper/bacteria/code/seqfun.R")

bac_taxonomy <- tax_table("~/git_repos/Root_paper/bacteria/data/Bickford.cons.taxonomy", "SILVA")

L <- bac_taxonomy$otu %in% colnames(bac_shared)
bac_taxonomy <- bac_taxonomy[L, ]
stopifnot(nrow(bac_taxonomy)==ncol(bac_shared))

#need to know the phylum names - phylum_names / phylum_name
phylum_names <- unique(bac_taxonomy$phylum)
# need somwhere to put data - allphylum_shared
n_phyla <- length(phylum_names)
n_samples <- nrow(bac_shared)
bacphylum_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_phyla))
rownames(bacphylum_shared) <- rownames(bac_shared)
colnames(bacphylum_shared) <- phylum_names

#my loop
for(i in phylum_names){
  phylum_otus <- bac_taxonomy[bac_taxonomy$phylum == i, "otu"]
  phylum_shared <- bac_shared[ , phylum_otus]
  if(length(phylum_otus) > 1){
    phylum_count <- apply(phylum_shared, 1, sum)
    } else {
      phylum_count <- phylum_shared
    }
  bacphylum_shared[ , i] <- phylum_count
  
}

#split by plant lineage
SampleID <- rownames(bacphylum_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]

bacphylum_shared <- data.frame(SampleID, bacphylum_shared)
meta_bac_shared <- inner_join(bacphylum_shared, metadata, by = c( "SampleID" = "Code"))


nat_bac_shared <- meta_bac_shared[meta_bac_shared$Lineage == "Nat", ]
non_bac_shared <- meta_bac_shared[meta_bac_shared$Lineage == "Inv", ]

nat_bac_shared <- nat_bac_shared[ ,2:5]
rownames(nat_bac_shared) <- natID
non_bac_shared <- non_bac_shared[ ,2:5]
rownames(non_bac_shared) <- nonID


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_bac_shared, 1, sum)
nat_bac_rel_abund <- nat_bac_shared / nat_seqs

nat_rel_abund <- numeric()
for(h in colnames(nat_bac_rel_abund)){
  y <- mean(nat_bac_rel_abund[ ,h])
  nat_rel_abund[h] <- y
}
sum(nat_rel_abund)

# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_bac_shared, 1, sum)
non_bac_rel_abund <- non_bac_shared / non_seqs

non_rel_abund <- numeric()
for(h in colnames(non_bac_rel_abund)){
  y <- mean(non_bac_rel_abund[ ,h])
  non_rel_abund[h] <- y
}
sum(non_rel_abund)

bac_lin_rel_abund <- data.frame(Native = nat_rel_abund, NonNative = non_rel_abund)

bac_top_phyla <- as.matrix(bac_lin_rel_abund)
bac_top_phyla <- t(bac_top_phyla)

#stats
topbphyla_shared <- bacphylum_shared[2:5]

seqs <- apply(topbphyla_shared, 1, sum)
topbphyla_ra <- topbphyla_shared / seqs
topbphyla_ra <- data.frame(SampleID, topbphyla_ra)

meta_top_bphyla <- inner_join(topbphyla_ra, metadata, by = c( "SampleID" = "Code"))


# 3. calculate the relative abundance for native

natbac_av_ra <- apply(nat_bac_rel_abund, 2, mean)
natbac_sd_ra <- apply(nat_bac_rel_abund, 2, sd)
natbac_se_ra <- natbac_sd_ra/sqrt(25)


# 3. calculate the relative abundance for invasive

nonbac_av_ra <- apply(non_bac_rel_abund, 2, mean)
nonbac_sd_ra <- apply(non_bac_rel_abund, 2, sd)
nonbac_se_ra <- nonbac_sd_ra/sqrt(24)

baclin_rel_average <- data.frame(Native = natbac_av_ra, NonNative = nonbac_av_ra)

topbac_av_phyla <- as.matrix(baclin_rel_average)
topbac_av_phyla <- t(topbac_av_phyla)

x0_nonbac <- nonbac_av_ra - nonbac_se_ra
x1_nonbac <- nonbac_av_ra + nonbac_se_ra

x0_natbac <- natbac_av_ra - natbac_se_ra
x1_natbac <- natbac_av_ra + natbac_se_ra

baclin_rel_se <- data.frame(Native = natbac_se_ra, NonNative = nonbac_se_ra)

topbac_se_phyla <- as.matrix(baclin_rel_se)
topbac_se_phyla <- t(topbac_se_phyla)


#Proteo RA
results <- lm(Proteobacteria ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Firm RA
results <- lm(Firmicutes ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Bacteriodetes RA
results <- lm(Bacteroidetes ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Actinobacteria RA
results <- lm(Actinobacteria ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova
```

```{r fig 4, echo = F, include=T}
png("~/git_repos/Root_paper/Figures/fig4.png", height = 6, width = 9, units = "in", res = 300)
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 4, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1.4), ylim = c(-1,1))

barplot(height = topbac_av_phyla, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))
arrows(x0 = x0_natbac, x1 = x1_natbac, y0 = c(1.5,4.5,7.5,10.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
arrows(x0 = x0_nonbac, x1 = x1_nonbac, y0 = c(2.5,5.5,8.5,11.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(topbac_av_phyla), at = c(2,5,8,11))

mtext("P-Values",side = 4, line = 1, las = 1, at = 13.5, cex = 1)
mtext(c("Lineage","Site","L X S"),side = 4, las = 1, line = c(-0.5,3,6), at = 12.5, cex = 0.9)

arrows(x0 = 1.09, y0 = 1, y1 = 12, angle = 90, length = 0.5, lwd = 0.75)
arrows(x0 = 1.18, y0 = 1, y1 = 12, angle = 90, length = 0.5, lwd = 0.75)
#P values come from ANOVA results in above chunck
mtext(c("0.257","0.352","<0.001","0.045"),side = 4, line = 3, at = c(2,5,8,11), las = 1, cex = 0.8)
mtext(c("0.021","0.238","0.008","0.611"),side = 4, line = 0, at = c(2,5,8,11), las = 1, cex = 0.8)
mtext(c("0.250","0.143","0.114","0.001"),side = 4, line = 6, at = c(2,5,8,11), las = 1, cex = 0.8)


legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r bugbase, echo = F, include = F}
bbase <- read.table("~/git_repos/Root_Paper/bacteria/data/bb_predictions.txt", header = T, sep = "\t")
rownames(bbase) <- bbase$X

bbase_nat <- bbase[grepl("Nat", rownames(bbase)), ]
bbase_non <- bbase[grepl("Inv", rownames(bbase)), ]

oxbylin <- matrix(NA, nrow = 2, ncol = 3)
rownames(oxbylin) <- c("Native", "Non-Native")
colnames(oxbylin) <- c("Aerobes","Facultative Anaerobes", "Anaerobes")
NatSE <- numeric()
NonSE <- numeric()

oxbylin[1,1] <- mean(bbase_nat$Aerobic)
sdev <- sd(bbase_nat$Aerobic)
NatSE <- sdev/sqrt(nrow(bbase_nat))
oxbylin[1,2] <- mean(bbase_nat$Facultatively_Anaerobic)
sdev <- sd(bbase_nat$Facultatively_Anaerobic)
NatSE <- c(NatSE, sdev/sqrt(nrow(bbase_nat)))
oxbylin[1,3] <- mean(bbase_nat$Anaerobic)
sdev <- sd(bbase_nat$Anaerobic)
NatSE <- c(NatSE, sdev/sqrt(nrow(bbase_nat)))

oxbylin[2,1] <- mean(bbase_non$Aerobic)
sdev <- sd(bbase_non$Aerobic)
NonSE <- sdev/sqrt(nrow(bbase_non))
oxbylin[2,2] <- mean(bbase_non$Facultatively_Anaerobic)
sdev <- sd(bbase_non$Facultatively_Anaerobic)
NonSE <- c(NonSE, sdev/sqrt(nrow(bbase_non)))
oxbylin[2,3] <- mean(bbase_non$Anaerobic)
sdev <- sd(bbase_non$Anaerobic)
NonSE <- c(NonSE, sdev/sqrt(nrow(bbase_non)))

x0_nat <- (oxbylin["Native", ] - NatSE )
x1_nat <- (oxbylin["Native", ] + NatSE )

x0_non <- (oxbylin["Non-Native", ] - NonSE )
x1_non <- (oxbylin["Non-Native", ] + NonSE )

#Aerobe RA
results <- lm(bbase$Aerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#facan RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova


```

```{r Fig 5, echo=F, include = T}
png("~/git_repos/Root_paper/Figures/fig5.png", height = 6, width = 9, units = "in", res = 300)
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 6, 4, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = oxbylin, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5), angle = 90, length = 0.05, code = 3, lwd = 1.5)
axis(side = 2, las = 1, labels = c("Aerobes", "anaerobes", "Facultative", "Anaerobes"), at = c(2,4.75,5.25,8), tick = F)
axis(side = 2, las = 1, labels = F, at = c(2,5,8))
mtext("P-values",side = 4, las = 1, line = 2, at = 10, cex = 1)
mtext(c("Lineage","Site", "L X S"),side = 4, las = 1, line = c(-0.5,3,6), at = 9, cex = 0.9)

arrows(x0 = 1.09, y0 = 1, y1 = 8.5, angle = 90, length = 0.5, lwd = 0.75)
arrows(x0 = 1.18, y0 = 1, y1 = 8.5, angle = 90, length = 0.5, lwd = 0.75)
#P values come from ANOVA results in above chunck

mtext(c("0.003","<0.001","0.105"),side = 4, line = 3, at = c(2,5,8), las = 1, cex = 0.8)
mtext(c("0.917","0.528","0.616"),side = 4, line = 0, at = c(2,5,8), las = 1, cex = 0.8)
mtext(c("0.004","0.124","0.030"),side = 4, line = 6, at = c(2,5,8), las = 1, cex = 0.8)



legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r funguild setup, echo = F, include = F}

guilds <- read.table("~/git_repos/Root_Paper/ITS/data/for_funguild.guilds_matched.txt", header = T, sep = "\t", stringsAsFactors = F)

#make metadata file for guilds
guild_data <- guilds[ , -c(2:48)]
guild_data$Trophic.Mode <- as.factor(guild_data$Trophic.Mode)
guild_data$TrophicMod <- as.factor(guild_data$TrophicMod)
guild_data$Guild <- as.factor(guild_data$Guild)
summary(guild_data)

matched_guild_shared <- guilds[ , c(1:48)]
matched_guild_shared <- data.frame(guild_data$TrophicMod, matched_guild_shared)

### I want rel abundance of each guild
trans_matched_guild_shared <- data.frame(t(matched_guild_shared))

# how do I combine the number of sequences from each of the OTUs

# in the below, 1 is for rows and 2 is for columns
trans_matched <- trans_matched_guild_shared[-c(1,2), ]

# how do I repeat this for all phyla?
#make a loop

#need to know the unique trophic modes 
trophic_names <- unique(guild_data$TrophicMod)
# need somwhere to put data - a new shared file
n_modes <- length(trophic_names)
n_samples <- nrow(trans_matched)
trophic_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_modes))
rownames(trophic_shared) <- rownames(trans_matched)
colnames(trophic_shared) <- trophic_names

#my loop
for(i in trophic_names){
  trophic_otus <- guild_data[guild_data$TrophicMod == i, "OTU"]
  guild_shared <- shared_fun[ , trophic_otus]
  if(length(trophic_otus) > 1){
    trophic_count <- apply(guild_shared, 1, sum)
  } else {
    trophic_count <- guild_shared
  }
  trophic_shared[ , i] <- trophic_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(trophic_shared, 1, sum)
trophic_rel_abund <- trophic_shared / n_seqs

plotnames <- rownames(trophic_rel_abund) 
trophic_rel_abund <- data.frame(SampleID = plotnames, trophic_rel_abund)

meta_trophic <- inner_join(trophic_rel_abund, metadata, by = c( "SampleID" = "Code"))
rownames(meta_trophic) <- meta_trophic$SampleID
meta_trophic$SoilN <- as.numeric(meta_trophic$SoilN)
meta_trophic$SoilN <- as.numeric(meta_trophic$SoilN)
meta_trophic$Sat <- as.numeric(meta_trophic$Sat)


trophic_rel_abund <- trophic_rel_abund[ , -1]


tot_trophic_rel_abund <- numeric()
for(h in colnames(trophic_rel_abund)){
  y <- mean(trophic_rel_abund[ ,h])
  tot_trophic_rel_abund[h] <- y
}
sum(tot_trophic_rel_abund)
tot_trophic_rel_abund

L <- sort.list(tot_trophic_rel_abund, decreasing = T)
tot_trophic_rel_abund <- tot_trophic_rel_abund[L]


```

```{r trophicmode by lin, echo = F, include = F}
# 3. calculate the relative abundance
SampleID <- rownames(trophic_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]


nat_shared <- trophic_shared[natID, ]
non_shared <- trophic_shared[nonID, ]


# 3. calculate the relative abundance for native

nat_seqs <- apply(nat_shared, 1, sum)
nat_trophic_rel_abund <- nat_shared / nat_seqs


# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_trophic_rel_abund <- non_shared / non_seqs

nat_av_ra <- apply(nat_trophic_rel_abund, 2, mean)
nat_sd_ra <- apply(nat_trophic_rel_abund, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(23)

non_av_ra <- apply(non_trophic_rel_abund, 2, mean)
non_sd_ra <- apply(non_trophic_rel_abund, 2, sd)
non_se_ra <- non_sd_ra/sqrt(24)

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_trophic <- as.matrix(lin_rel_average)
top_av_trophic <- t(top_av_trophic)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra

#Path RA
results <- lm(Pathotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sap RA
results <- lm(Saprotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Path:Sym RA
results <- lm(Pathotroph.Symbiotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sym RA
results <- lm(Symbiotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova
```


```{r Fig 6, echo=F, include = T}
png("~/git_repos/Root_paper/Figures/fig6.png", height = 6, width = 9, units = "in", res = 300)
quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 10, 4, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = top_av_trophic, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.65), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5), angle = 90, length = 0.05, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_trophic), at = c(2,5,8,11))

mtext("P-Values",side = 4, line = 1, las = 1, at = 14.5, cex = 1)
mtext(c("Lineage","Site","L X S"),side = 4, las = 1, line = c(-1,2.5,5), at = 13, cex = 0.9)

arrows(x0 = 0.705, y0 = 1, y1 = 12, angle = 90, lwd = 0.75, length = 0.5)
arrows(x0 = 0.775, y0 = 1, y1 = 12, angle = 90, lwd = 0.75, length = 0.5)
mtext(c("0.008","<0.001","0.516","0.391"),side = 4, line = 2.5, las = 1, at = c(2,5,8,11), cex = 0.8)
mtext(c("0.281","0.253","0.717","0.889"),side = 4, line = 0, las = 1, at = c(2,5,8,11), cex = 0.8)
mtext(c("0.073","0.038","0.383","0.055"),side = 4, line = 5.2, las = 1, at = c(2,5,8,11), cex = 0.8)

legend(0.18, 13, c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n", cex = 0.8)


```


#SAMPLING EFFORT
##Bacteria

```{r Rarefaction setup, echo = F, include = F}
rarefy <- read.table(file = "~/git_repos/Root_paper/bacteria/data/Bickford.groups.rarefaction", header=T, stringsAsFactors=F)

ave_columns <- grep(pattern = "X0", colnames(rarefy))
ave_rarefy <- rarefy[ , ave_columns]
reg <- "X0\\.\\d\\d\\.(\\w+\\d*\\w+\\d*)"
sample_id <- gsub(pattern = reg, "\\1", colnames(ave_rarefy))

numsampled <- rarefy$numsampled

colnames(ave_rarefy) <- sample_id

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")


```

###Bacterial rarefaction Curves

These are rarefaction curves for all samples. Samples were rarefied to 483 sequences as that was the lowest number at any site. 

```{r Rarefaction plot, echo = F, include = T}
plot(NA, type = "l",
     xlab = "Number of Sequences Sampled",
     ylab = "Number of OTUs Observed",
     ylim = c(0,350),
     xlim = c(0,2000)
     )
for(i in sample_id){
      points(ave_rarefy[ ,i] ~ numsampled, type= "l",
             col=clrs[metadata[metadata$Code==i, "Site"]],
             lwd = 2, lty = 1
       )
}
abline(v=483)
```

```{r bacterial goods coverage, echo = F, include = T}
clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")

boxplot(coverage ~ Site, data = bac_meta_alpha,
        ylab = "Good's Coverage",
        ylim = c(0.7,1), col = clrs[levels(bac_meta_alpha$Site)],
        names = unique(bac_meta_alpha$Site),
        range = 0)


```
##Fungi

```{r Rarefaction plot, echo = F, include = T}
meta_alpha_fun$Site <- as.factor(meta_alpha_fun$Site)
rarefy <- read.table(file = "~/git_repos/Root_paper/ITS/data/Bickford.groups.rarefaction", header=T, stringsAsFactors=F)

ave_columns <- grep(pattern = "X1", colnames(rarefy))
ave_rarefy <- rarefy[ , ave_columns]

numsampled <- rarefy$numsampled

sample_IDs <- gsub(pattern = "X1.", replacement = "", x=colnames(ave_rarefy))
colnames(ave_rarefy) <- sample_IDs

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")


plot(NA, type = "l",
     xlab = "Number of Sequences Sampled",
     ylab = "Number of OTUs Observed",
     ylim = c(0,150),
     xlim = c(0,3000)
     )
for(i in sample_IDs){
      points(ave_rarefy[ ,i] ~ numsampled, type= "l",
             col=clrs[metadata[metadata$Code==i, "Site"]],
             lwd = 2, lty = 1
       )
}
abline(v=200)

```

```{r Fungal goods coverage, echo = F, include = T}
clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")

boxplot(coverage ~ Site, data = meta_alpha_fun,
        ylab = "Good's Coverage",
        ylim = c(0.7,1), col = clrs[levels(meta_alpha_fun$Site)],
        names = unique(meta_alpha_fun$Site),
        range = 0)


```
##Oomycetes

```{r Rarefaction setup, echo = F, include = F}
#source('data_setup.R')
#mean(metadata$n_seqs)

rarefy <- read.table(file = "~/git_repos/Root_paper/Oom/data/Bickford.groups.rarefaction", header=T, stringsAsFactors=F)

ave_columns <- grep(pattern = "X1", colnames(rarefy))
ave_rarefy <- rarefy[ , ave_columns]
reg <- "X1\\.(\\w+\\d*\\w+\\d*)"
sample_id <- gsub(pattern = reg, "\\1", colnames(ave_rarefy))

numsampled <- rarefy$numsampled

colnames(ave_rarefy) <- sample_id

clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")


```

##Rarefaction Curves

These are rarefaction curves for all samples. Samples were rarefied to 483 sequences as that was the lowest number at any site. 

```{r Rarefaction plot, echo = F, include = T}
plot(NA, type = "l",
     xlab = "Number of Sequences Sampled",
     ylab = "Number of OTUs Observed",
     ylim = c(0,90),
     xlim = c(0,3000)
     )
for(i in sample_id){
      points(ave_rarefy[ ,i] ~ numsampled, type= "l",
             col=clrs[metadata[metadata$Code==i, "Site"]],
             lwd = 2, lty = 1
       )
}
abline(v=459)

```

```{r oomycete goods coverage, echo = F, include = T}
clrs <- c(BL = "blue", CB = "red", CH = "dark green", CM = "coral", CR = "black", PLB = "brown", Rt2 = "dark gray", SB = "purple")

boxplot(coverage ~ Site, data = oom_meta_alpha,
        ylab = "Good's Coverage",
        ylim = c(0.9,1), col = clrs[levels(oom_meta_alpha$Site)],
        names = unique(oom_meta_alpha$Site),
        range = 0)


```
#Supplemental Info

```{r PCA setup, echo = F, include = T}
metadata$Site <- as.factor(metadata$Site)
metadata$Lineage <- as.factor(metadata$Lineage)
metadata$Sat_lev <- as.factor(metadata$Sat_lev)
metadata$Lat <- as.factor(metadata$Lat)
metadata$SoilP <- as.numeric(metadata$SoilP)
metadata$SoilN <- as.numeric(metadata$SoilN)
metadata$SoilC <- as.numeric(metadata$SoilC)
metadata$TisN <- as.numeric(metadata$TisN)
metadata$TisC <- as.numeric(metadata$TisC)
metadata$TisP <- as.numeric(metadata$TisP)

metadata$Sat <- as.numeric(metadata$Sat)

logvars <- log(metadata[ , c(7,9:11)]+1)
logvars <- data.frame(metadata$Site, metadata$Lineage, metadata$Sat_lev, logvars)
logvars <- logvars[is.finite(logvars$SoilN), ]

env.rda <- rda(logvars[ , -c(1:3)])
pca.pts <- as.data.frame(scores(env.rda)["sites"])
vec.coords <- as.data.frame(scores(env.rda)["species"])

```

```{r Fig. S4: PCA plot, echo = F, include = T}
quartz.options(height=6 , width = 6)
plot.new()
par(oma = c(1, 1, 1, 1))
par(mar = c(3, 3, 0.5, 3))
par(xpd = NA)
plot.window(xlim = c(-2,1), ylim = c(-2,1))
axis(1)
axis(2)


points(pca.pts$sites.PC1, pca.pts$sites.PC2)
lines(x = c(0,0,0), y = c(-2,0,1), lty = 3)
lines(x = c(-2,0,1), y = c(0,0,0), lty = 3)
arrows(x0 = 0, x1 = vec.coords$species.PC1, y0 = 0, y1 = vec.coords$species.PC2, angle = 30, col = "red", length = 0.05)
text(x = vec.coords$species.PC1, y = vec.coords$species.PC2, label = rownames(vec.coords), cex = 0.8, pos = 1, col = "red")

mtext(side = 1, line = 3, text = "PC1")
mtext(side = 2, line = 3, text = "PC2")

```

```{r Fungal Taxonomy setup, echo = F, include = F}
source("~/git_repos/Root_paper/ITS/code/seqfun.R")

otu_phylum_genus <- tax_table("~/git_repos/Root_paper/ITS/data/Bickford.cons.taxonomy", "UNITE")


L <- otu_phylum_genus$otu %in% colnames(shared_fun)
otu_phylum_genus <- otu_phylum_genus[L, ]
stopifnot(nrow(otu_phylum_genus)==ncol(shared_fun))

#need to know the phylum names - phylum_names / phylum_name
phylum_names <- unique(otu_phylum_genus$phylum)
# need somwhere to put data - allphylum_shared
n_phyla <- length(phylum_names)
n_samples <- nrow(shared_fun)
allfunphylum_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_phyla))
rownames(allfunphylum_shared) <- rownames(shared_fun)
colnames(allfunphylum_shared) <- phylum_names

#my loop
for(i in phylum_names){
  phylum_otus <- otu_phylum_genus[otu_phylum_genus$phylum == i, "otu"]
  phylum_shared <- shared_fun[ , phylum_otus]
  if(length(phylum_otus) > 1){
    phylum_count <- apply(phylum_shared, 1, sum)
    } else {
      phylum_count <- phylum_shared
    }
  allfunphylum_shared[ , i] <- phylum_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(allfunphylum_shared, 1, sum)
phylum_rel_abund <- allfunphylum_shared / n_seqs[1]

tot_rel_abund <- numeric()
for(h in colnames(phylum_rel_abund)){
  y <- mean(phylum_rel_abund[ ,h])
  tot_rel_abund[h] <- y
}
sum(tot_rel_abund)

uncl <- tot_rel_abund[2] + tot_rel_abund[3]

tot_rel_abund_cl <- c(tot_rel_abund[1], uncl, tot_rel_abund[4], tot_rel_abund[5], tot_rel_abund[6], tot_rel_abund[7])

names(tot_rel_abund_cl) <- c("Ascomycota", "Unclassified", "Basidiomycota", "Zygomycota", "Rozellomycota", "Glomeromycota")

L <- order(tot_rel_abund_cl, decreasing = T)
tot_rel_abund_cl <- tot_rel_abund_cl[L]

SampleID <- rownames(allfunphylum_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]

allfunphylum_shared <- data.frame(SampleID, allfunphylum_shared)
Unclassified <- allfunphylum_shared[3] + allfunphylum_shared[4]
colnames(Unclassified) = "Unclassified"

allfunphylum_shared <- data.frame(allfunphylum_shared[1:2], Unclassified, allfunphylum_shared[5:8])

topfunphyla_shared <- allfunphylum_shared[2:7]

seqs <- apply(topfunphyla_shared, 1, sum)
topfunphyla_ra <- topfunphyla_shared / seqs
topfunphyla_ra <- data.frame(SampleID, topfunphyla_ra)

meta_top_funphyla <- inner_join(topfunphyla_ra, metadata, by = c( "SampleID" = "Code"))
meta_funphylum_shared <- inner_join(allfunphylum_shared, metadata, by = c( "SampleID" = "Code"))


```
```{r Fungal Rel abund setup (genus), echo = F, include = F}
otu_asco_genus <- otu_phylum_genus[otu_phylum_genus$phylum == "Ascomycota", ]

asco_otus <- otu_phylum_genus[otu_phylum_genus$phylum == "Ascomycota", "otu"]
asco_shared <- shared_fun[ , asco_otus]

# how do I combine the number of sequences from each of the Acomycota OTUs

# in the below, 1 is for rows and 2 is for columns
ascomycota_count <- apply(asco_shared, 1, sum)

# how do I repeat this for all phyla?
#make a loop

#need to know the genus names within ascomycota
genus_names <- unique(otu_asco_genus$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(asco_shared)
asco_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(asco_genera_shared) <- rownames(asco_shared)
colnames(asco_genera_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- otu_asco_genus[otu_asco_genus$genus == i, "otu"]
  genus_shared <- shared_fun[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  asco_genera_shared[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
n_seqs <- apply(asco_genera_shared, 1, sum)
genus_rel_abund <- asco_genera_shared / n_seqs

tot_genus_rel_abund <- numeric()
for(h in colnames(genus_rel_abund)){
  y <- mean(genus_rel_abund[ ,h])
  tot_genus_rel_abund[h] <- y
}
sum(tot_genus_rel_abund)


L <- sort.list(tot_genus_rel_abund, decreasing = T)
tot_genus_rel_abund <- tot_genus_rel_abund[L]

genus_names <- unique(otu_asco_genus$genus)
cl_genus_names <- genus_names[genus_names != "unclassified"]
# need somwhere to put data - asco_genera_shared
n_genera <- length(cl_genus_names)
n_samples <- nrow(asco_shared)
asco_cl_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(asco_cl_genera_shared) <- rownames(asco_shared)
colnames(asco_cl_genera_shared) <- cl_genus_names

#my loop
for(i in cl_genus_names){
  genus_otus <- otu_asco_genus[otu_asco_genus$genus == i, "otu"]
  genus_shared <- shared_fun[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(genus_shared, 1, sum)
  } else {
    genus_count <- genus_shared
  }
  asco_cl_genera_shared[ , i] <- genus_count
  
}

# 3. calculate the relative abundance
n_seqs <- apply(asco_cl_genera_shared, 1, sum)
cl_genus_rel_abund <- asco_cl_genera_shared / n_seqs

tot_cl_genus_rel_abund <- numeric()
for(h in colnames(cl_genus_rel_abund)){
  y <- mean(cl_genus_rel_abund[ ,h])
  tot_cl_genus_rel_abund[h] <- y
}
sum(tot_cl_genus_rel_abund)


L <- sort.list(tot_cl_genus_rel_abund, decreasing = T)
tot_cl_genus_rel_abund <- tot_cl_genus_rel_abund[L]

top_genera_rel_abund <- tot_cl_genus_rel_abund[tot_cl_genus_rel_abund >= 0.01]

genus_rel_abund <- data.frame(SampleID, genus_rel_abund)
top_genus_ra <- genus_rel_abund[1:9]

meta_top_genus <- inner_join(top_genus_ra, metadata, by = c( "SampleID" = "Code"))

```


```{r Table S4: Fungi ANOVAs, echo = F, include = T}

#Fungal Colonization
results <- lm(per_col ~  Lineage.x * Site.x, data = meta_col, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Shannon
results <- lm(npshannon ~  Lineage * Site, data = meta_alpha_fun, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Chao
results <- lm(chao ~  Lineage * Site, data = meta_alpha_fun, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sobs
results <- lm(sobs ~  Lineage * Site, data = meta_alpha_fun, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 1
a1pts <- fun_pcoa.pts[ , 1]
results <- lm(a1pts ~  Lineage * Site, data = meta_alpha_fun, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 2
a2pts <- fun_pcoa.pts[ , 2]
results <- lm(a2pts ~  Lineage * Site, data = meta_alpha_fun, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Asco RA
results <- lm(Ascomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Basidio RA
results <- lm(Basidiomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Unclassified RA
results <- lm(Unclassified ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Zygomycota RA
results <- lm(Zygomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Rozellomycota RA
results <- lm(Rozellomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Glomeromycota RA
results <- lm(Glomeromycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Gib RA
results <- lm(Gibberella ~  Lineage * Site, data = meta_top_genus, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Micro
results <- lm(Microdochium ~  Lineage * Site, data = meta_top_genus, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Tetra
results <- lm(Tetracladium ~  Lineage * Site, data = meta_top_genus, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Stag RA
results <- lm(Stagonospora ~  Lineage * Site, data = meta_top_genus, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Cadophora
results <- lm(Cadophora ~  Lineage * Site, data = meta_top_genus, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Path RA
results <- lm(Pathotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sap RA
results <- lm(Saprotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Path:Sym RA
results <- lm(Pathotroph.Symbiotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sym RA
results <- lm(Symbiotroph ~  Lineage * Site, data = meta_trophic, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova
```

```{r Table S5: ANCOVAs, echo = F, include = T}

#Fungal Colonization
results <- lm(per_col ~  Lineage.x + Lineage.x:Sat + Sat + SoilP + SoilN, data = meta_col)
summary(results)
ancova2 <- anova(results)
ancova2

#Shannon
results <- lm(npshannon ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha_fun)
summary(results)
ancova2 <- anova(results)
ancova2

#Chao
results <- lm(chao ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha_fun)
summary(results)
ancova2 <- anova(results)
ancova2

#Sobs
results <- lm(sobs ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha_fun)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 1
results <- lm(a1pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha_fun)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 2
results <- lm(a2pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_alpha_fun)
summary(results)
ancova2 <- anova(results)
ancova2

#Asco RA
results <- lm(Ascomycota ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_funphyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Gib RA
results <- lm(Gibberella ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_genus)
summary(results)
ancova2 <- anova(results)
ancova2

#Stag RA
results <- lm(Stagonospora ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_genus)
summary(results)
ancova2 <- anova(results)
ancova2

#Path RA
results <- lm(Pathotroph ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_trophic)
summary(results)
ancova2 <- anova(results)
ancova2

#Sap RA
results <- lm(Saprotroph ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_trophic)
summary(results)
ancova2 <- anova(results)
ancova2
```

```{r Fig. S5 setup, echo = F, include = F}

#percent col vs sat

regnat.p1.1 <- lm(meta_col$per_col[meta_col$Lineage.x == "Nat"] ~ meta_col$Sat[meta_col$Lineage.x == "Nat"])
summary(regnat.p1.1)
reginv.p1.1 <- lm(meta_col$per_col[meta_col$Lineage.x == "Inv"] ~ meta_col$Sat[meta_col$Lineage.x == "Inv"])
summary(reginv.p1.1)


p1.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_col$Sat, y = meta_col$per_col, pch = pchs[as.character(meta_col$Lineage.x)], xlab = "Soil Saturation", ylab = "Percent Colonization", las = 1)
  abline(regnat.p1.1, lty = 2)
  abline(reginv.p1.1)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#percol vs P

regnat.p1.2 <- lm(meta_col$per_col[meta_col$Lineage.x == "Nat"] ~ meta_col$SoilP[meta_col$Lineage.x == "Nat"])
summary(regnat.p1.2)
reginv.p1.2 <- lm(meta_col$per_col[meta_col$Lineage.x == "Inv"] ~ meta_col$SoilP[meta_col$Lineage.x == "Inv"])
summary(reginv.p1.2)

p1.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_col$SoilP, y = meta_col$per_col, pch = pchs[as.character(meta_col$Lineage.x)], xlab = "Soil P", ylab = "Percent Colonization", las = 1)
  # abline(regnat.p1.2, lty = 2)
  # abline(reginv.p1.2)
#  legend("topleft", c("Non-native", "Native"), pch = c(16, 1))
}

#percol vs N

regnat.p1.3 <- lm(meta_col$per_col[meta_col$Lineage.x == "Nat"] ~ meta_col$SoilN[meta_col$Lineage.x == "Nat"])
summary(regnat.p1.3)
reginv.p1.3 <- lm(meta_col$per_col[meta_col$Lineage.x == "Inv"] ~ meta_col$SoilN[meta_col$Lineage.x == "Inv"])
summary(reginv.p1.3)

p1.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_col$SoilN, y = meta_col$per_col, pch = pchs[as.character(meta_col$Lineage.x)], xlab = "Soil N", ylab = "Percent Colonization", las = 1)
  # abline(regnat.p1.3, lty = 2)
  # abline(reginv.p1.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs. sat

regnat.p2.1 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p2.1)
reginv.p2.1 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p2.1)


p2.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = meta_alpha_fun$npshannon, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil Saturation", ylab = "Shannon Diversity", las = 1)
  abline(regnat.p2.1, lty = 2)
  abline(reginv.p2.1)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p2.2 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p2.2)
reginv.p2.2 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p2.2)


p2.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = meta_alpha_fun$npshannon, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.2, lty = 2)
  # abline(reginv.p2.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs N

regnat.p2.3 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p2.3)
reginv.p2.3 <- lm(meta_alpha_fun$npshannon[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p2.3)


p2.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_alpha_fun$npshannon, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.3, lty = 2)
  # abline(reginv.p2.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs. sat

regnat.p3.1 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p3.1)
reginv.p3.1 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p3.1)


p3.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = meta_alpha_fun$chao, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil Saturation", ylab = "Chao Richness", las = 1)
  abline(regnat.p3.1, lty = 2)
  abline(reginv.p3.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p3.2 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p3.2)
reginv.p3.2 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p3.2)


p3.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = meta_alpha_fun$chao, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.2, lty = 2)
  # abline(reginv.p3.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs N

regnat.p3.3 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p3.3)
reginv.p3.3 <- lm(meta_alpha_fun$chao[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p3.3)


p3.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_alpha_fun$chao, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.3, lty = 2)
  # abline(reginv.p3.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs. sat

regnat.p4.1 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p4.1 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p4.1)


p4.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = meta_alpha_fun$sobs, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil Saturation", ylab = "Fungal Species Observed", las = 1)
  # abline(regnat.p4.1, lty = 2)
  # abline(reginv.p4.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs P

regnat.p4.2 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p4.2)
reginv.p4.2 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p4.2)


p4.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = meta_alpha_fun$sobs, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Fungal Species Observed", las = 1)
  # abline(regnat.p4.2, lty = 2)
  # abline(reginv.p4.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#sobs vs N

regnat.p4.3 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Nat"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p4.3)
reginv.p4.3 <- lm(meta_alpha_fun$sobs[meta_alpha_fun$Lineage == "Inv"] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p4.3)


p4.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_alpha_fun$sobs, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Fungal Species Observed", las = 1)
  # abline(regnat.p4.3, lty = 2)
  # abline(reginv.p4.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs. sat



regnat.p5.1 <- lm(a1pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p5.1 <- lm(a1pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p5.1)


p5.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = a1pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.1, lty = 2)
  abline(reginv.p5.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs P

regnat.p5.2 <- lm(a1pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p5.2)
reginv.p5.2 <- lm(a1pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p5.2)


p5.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = a1pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 1", las = 1)
  # abline(regnat.p5.2, lty = 2)
  # abline(reginv.p5.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs N

regnat.p5.3 <- lm(a1pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p5.3)
reginv.p5.3 <- lm(a1pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p5.3)


p5.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = a1pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 1", las = 1)
  # abline(regnat.p5.3, lty = 2)
  # abline(reginv.p5.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs. sat


regnat.p6.1 <- lm(a2pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p6.1)
reginv.p6.1 <- lm(a2pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$Sat[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p6.1)


p6.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = a2pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.1, lty = 2)
  # abline(reginv.p6.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs P

regnat.p6.2 <- lm(a2pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p6.2)
reginv.p6.2 <- lm(a2pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilP[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p6.2)


p6.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = a2pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 2", las = 1)
 #  abline(regnat.p6.2, lty = 2)
 #  abline(reginv.p6.2)
 # # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs N

regnat.p6.3 <- lm(a2pts[grepl("Nat", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Nat"])
summary(regnat.p6.3)
reginv.p6.3 <- lm(a2pts[grepl("Inv", rownames(fun_pcoa.pts))] ~ meta_alpha_fun$SoilN[meta_alpha_fun$Lineage == "Inv"])
summary(reginv.p6.3)


p6.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = a2pts, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.3, lty = 2)
  # abline(reginv.p6.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs. sat

regnat.p7.1 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Nat"] ~ meta_top_funphyla$Sat[meta_top_funphyla$Lineage == "Nat"])
summary(regnat.p7.1)
reginv.p7.1 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Inv"] ~ meta_top_funphyla$Sat[meta_top_funphyla$Lineage == "Inv"])
summary(reginv.p7.1)


p7.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_funphyla$Sat, y = meta_top_funphyla$Ascomycota, pch = pchs[as.character(meta_top_funphyla$Lineage)], xlab = "Soil Saturation", ylab = "Ascomycota Relative Abundance", las = 1)
  # abline(regnat.p7.1, lty = 2)
  # abline(reginv.p7.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs P

regnat.p7.2 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Nat"] ~ meta_top_funphyla$SoilP[meta_top_funphyla$Lineage == "Nat"])
summary(regnat.p7.2)
reginv.p7.2 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Inv"] ~ meta_top_funphyla$SoilP[meta_top_funphyla$Lineage == "Inv"])
summary(reginv.p7.2)


p7.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_funphyla$SoilP, y = meta_top_funphyla$Ascomycota, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Ascomycota Relative Abundance", las = 1)
  # abline(regnat.p7.2, lty = 2)
  # abline(reginv.p7.2)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs N

regnat.p7.3 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Nat"] ~ meta_top_funphyla$SoilN[meta_top_funphyla$Lineage == "Nat"])
summary(regnat.p7.3)
reginv.p7.3 <- lm(meta_top_funphyla$Ascomycota[meta_top_funphyla$Lineage == "Inv"] ~ meta_top_funphyla$SoilN[meta_top_funphyla$Lineage == "Inv"])
summary(reginv.p7.3)


p7.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_funphyla$SoilN, y = meta_top_funphyla$Ascomycota, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Ascomycota Relative Abundance", las = 1)
  # abline(regnat.p7.3, lty = 2)
  # abline(reginv.p7.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs. sat

regnat.p8.1 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$Sat[meta_trophic$Lineage == "Nat"])
summary(regnat.p8.1)
reginv.p8.1 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$Sat[meta_trophic$Lineage == "Inv"])
summary(reginv.p8.1)


p8.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = meta_trophic$Pathotroph, pch = pchs[as.character(meta_top_funphyla$Lineage)], xlab = "Soil Saturation", ylab = "Pathotroph Relative Abundance", las = 1)
  abline(regnat.p8.1, lty = 2)
  abline(reginv.p8.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs P

regnat.p8.2 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$SoilP[meta_trophic$Lineage == "Nat"])
summary(regnat.p8.2)
reginv.p8.2 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$SoilP[meta_trophic$Lineage == "Inv"])
summary(reginv.p8.2)


p8.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = meta_trophic$Pathotroph, pch = pchs[as.character(meta_trophic$Lineage)], xlab = "Soil P", ylab = "Pathotroph Relative Abundance", las = 1)
  # abline(regnat.p8.2, lty = 2)
  # abline(reginv.p8.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Path Rel. Abund vs N

regnat.p8.3 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$SoilN[meta_trophic$Lineage == "Nat"])
summary(regnat.p8.3)
reginv.p8.3 <- lm(meta_trophic$Pathotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$SoilN[meta_trophic$Lineage == "Inv"])
summary(reginv.p8.3)


p8.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_trophic$Pathotroph, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Pathotroph Relative Abundance", las = 1)
  # abline(regnat.p8.3, lty = 2)
  # abline(reginv.p8.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sap Rel. Abund vs Sat

regnat.p9.1 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$Sat[meta_trophic$Lineage == "Nat"])
summary(regnat.p9.1)
reginv.p9.1 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$Sat[meta_trophic$Lineage == "Inv"])
summary(reginv.p9.1)


p9.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$Sat, y = meta_trophic$Saprotroph, pch = pchs[as.character(meta_trophic$Lineage)], xlab = "Soil P", ylab = "Saprotroph Relative Abundance", las = 1)
  abline(regnat.p9.1, lty = 2)
  abline(reginv.p9.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}
#Sap Rel. Abund vs P

regnat.p9.2 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$SoilP[meta_trophic$Lineage == "Nat"])
summary(regnat.p9.2)
reginv.p9.2 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$SoilP[meta_trophic$Lineage == "Inv"])
summary(reginv.p9.2)


p9.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilP, y = meta_trophic$Pathotroph, pch = pchs[as.character(meta_trophic$Lineage)], xlab = "Soil P", ylab = "Saprotroph Relative Abundance", las = 1)
  # abline(regnat.p9.2, lty = 2)
  # abline(reginv.p9.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Asco Rel. Abund vs N

regnat.p9.3 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Nat"] ~ meta_trophic$SoilN[meta_trophic$Lineage == "Nat"])
summary(regnat.p9.3)
reginv.p9.3 <- lm(meta_trophic$Saprotroph[meta_trophic$Lineage == "Inv"] ~ meta_trophic$SoilN[meta_trophic$Lineage == "Inv"])
summary(reginv.p9.3)


p9.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_trophic$Saprotroph, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Saprotroph Relative Abundance", las = 1)
  # abline(regnat.p9.3, lty = 2)
  # abline(reginv.p9.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Gib Rel. Abund vs. sat

regnat.p10.1 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$Sat[meta_top_genus$Lineage == "Nat"])
summary(regnat.p10.1)
reginv.p10.1 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$Sat[meta_top_genus$Lineage == "Inv"])
summary(reginv.p10.1)


p10.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_genus$Sat, y = meta_top_genus$Gibberella, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Gibberella Relative Abundance", las = 1)
  abline(regnat.p10.1, lty = 2)
  abline(reginv.p10.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Gib Rel. Abund vs P

regnat.p10.2 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$SoilP[meta_top_genus$Lineage == "Nat"])
summary(regnat.p10.2)
reginv.p10.2 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$SoilP[meta_top_genus$Lineage == "Inv"])
summary(reginv.p10.2)


p10.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_genus$SoilP, y = meta_top_genus$Gibberella, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Gibberella Relative Abundance", las = 1)
  # abline(regnat.p10.2, lty = 2)
  # abline(reginv.p10.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Gib Rel. Abund vs N

regnat.p10.3 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$SoilN[meta_top_genus$Lineage == "Nat"])
summary(regnat.p10.3)
reginv.p10.3 <- lm(meta_top_genus$Gibberella[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$SoilN[meta_top_genus$Lineage == "Inv"])
summary(reginv.p10.3)


p10.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_top_genus$Gibberella, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Gibberella Relative Abundance", las = 1)
  # abline(regnat.p10.3, lty = 2)
  # abline(reginv.p10.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs. sat

regnat.p11.1 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$Sat[meta_top_genus$Lineage == "Nat"])
summary(regnat.p11.1)
reginv.p11.1 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$Sat[meta_top_genus$Lineage == "Inv"])
summary(reginv.p11.1)


p11.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_genus$Sat, y = meta_top_genus$Stagonospora, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Stagonospora Relative Abundance", las = 1)
  abline(regnat.p11.1, lty = 2)
  abline(reginv.p11.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs P

regnat.p11.2 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$SoilP[meta_top_genus$Lineage == "Nat"])
summary(regnat.p11.2)
reginv.p11.2 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$SoilP[meta_top_genus$Lineage == "Inv"])
summary(reginv.p11.2)


p11.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_genus$SoilP, y = meta_top_genus$Stagonospora, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil P", ylab = "Stagonospora Relative Abundance", las = 1)
  # abline(regnat.p11.2, lty = 2)
  # abline(reginv.p11.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Stag Rel. Abund vs N

regnat.p11.3 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Nat"] ~ meta_top_genus$SoilN[meta_top_genus$Lineage == "Nat"])
summary(regnat.p11.3)
reginv.p11.3 <- lm(meta_top_genus$Stagonospora[meta_top_genus$Lineage == "Inv"] ~ meta_top_genus$SoilN[meta_top_genus$Lineage == "Inv"])
summary(reginv.p11.3)


p11.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_alpha_fun$SoilN, y = meta_top_genus$Stagonospora, pch = pchs[as.character(meta_alpha_fun$Lineage)], xlab = "Soil N", ylab = "Stagonospora Relative Abundance", las = 1)
  # abline(regnat.p11.3, lty = 2)
  # abline(reginv.p11.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

```
```{r SF2, echo = F, include = T}
# Display the saved plot


p1.1
p1.2
p1.3
p2.1
p2.2
p2.3
p3.1
p3.2
p3.3
p4.1
p4.2
p4.3
p5.1
p5.2
p5.3
p6.1
p6.2
p6.3
p7.1
p7.2
p7.3
p8.1
p8.2
p8.3
p9.1
p9.2
p9.3
p10.1
p10.2
p10.3
p11.1
p11.2
p11.3

```

```{r Rel abund setup (genus), echo = F, include = F}

genus_names <- unique(bac_taxonomy$genus)
# need somwhere to put data - asco_genera_shared
n_genera <- length(genus_names)
n_samples <- nrow(bac_shared)
bac_genera_shared <- data.frame(matrix(0, nrow = n_samples, ncol = n_genera))
rownames(bac_genera_shared) <- rownames(bac_shared)
colnames(bac_genera_shared) <- genus_names

#my loop
for(i in genus_names){
  genus_otus <- bac_taxonomy[bac_taxonomy$genus == i, "otu"]
  bac_genus_shared <- bac_shared[ , genus_otus]
  if(length(genus_otus) > 1){
    genus_count <- apply(bac_genus_shared, 1, sum)
  } else {
    genus_count <- bac_genus_shared
  }
  bac_genera_shared[ , i] <- genus_count
  
}


# 3. calculate the relative abundance
n_seqs <- apply(bac_genera_shared, 1, sum)
bgenus_rel_abund <- bac_genera_shared / n_seqs

tot_bgenus_rel_abund <- numeric()
for(h in colnames(bgenus_rel_abund)){
  y <- mean(bgenus_rel_abund[ ,h])
  tot_bgenus_rel_abund[h] <- y
}
sum(tot_bgenus_rel_abund)


L <- sort.list(tot_bgenus_rel_abund, decreasing = T)
tot_bgenus_rel_abund <- tot_bgenus_rel_abund[L]


top_genera_rel_abund <- tot_bgenus_rel_abund[tot_bgenus_rel_abund >= 0.01]
top_names <- names(top_genera_rel_abund[1:7])

```

```{r allgenera, include = T, echo = F}
topgenus_ra <- bgenus_rel_abund[ , top_names]

nat_genusra <- topgenus_ra[grepl("Nat", rownames(topgenus_ra)), ]
non_genusra <- topgenus_ra[grepl("Inv", rownames(topgenus_ra)), ]


nat_av_ra <- apply(nat_genusra, 2, mean)
nat_sd_ra <- apply(nat_genusra, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(nrow(nat_genusra))

non_av_ra <- apply(non_genusra, 2, mean)
non_sd_ra <- apply(non_genusra, 2, sd)
non_se_ra <- non_sd_ra/sqrt(nrow(non_genusra))

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_genus <- as.matrix(lin_rel_average)
top_av_genus <- t(top_av_genus)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra


```

```{r Fig. S8, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 1, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,0.6), ylim = c(-1,1))

barplot(height = top_av_genus, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.6), col = c("white", "gray"))
arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5,16.5,19.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5,17.5,20.5), angle = 90, length = 0.03, lwd = 1.5, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_genus), at = c(2,5,8,11,14,17,20))
mtext("Significant Differences",side = 4, las = 1, line = -2, at = 24.5, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-1,3), at = 22.5, cex = 0.9)

arrows(x0 = 0.73, y0 = 1, y1 = 21.5, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("<0.001","<0.001"," 0.050","<0.001"," 0.123"," 0.139"," 0.086"), side = 4, line = 3, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)
mtext(c("0.012","0.337","0.590","0.021","0.084","0.346","0.197"),side = 4, line = 0, at = c(2,5,8,11,14,17,20), las = 1, cex = 0.8)

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")
```

```{r Table S6, echo = F, include = T}
#Shannon
results <- lm(npshannon ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Chao
results <- lm(chao ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Sobs
results <- lm(sobs ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 1
a1pts <- bac_pcoa.pts[ , 1]
results <- lm(a1pts ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#PCoA Axis 2
a2pts <- bac_pcoa.pts[ , 2]
results <- lm(a2pts ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Proteo RA
results <- lm(Proteobacteria ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Firm RA
results <- lm(Firmicutes ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Bacteriodetes RA
results <- lm(Bacteroidetes ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Actinobacteria RA
results <- lm(Actinobacteria ~  Lineage * Site, data = meta_top_bphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Psuedo RA
results <- lm(topgenus_ra$Pseudomonas ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Flavobacterium RA
results <- lm(topgenus_ra$Flavobacterium ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Janthinobacterium RA
results <- lm(topgenus_ra$Janthinobacterium ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#rhizobium
results <- lm(topgenus_ra$Rhizobium ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#duganella
results <- lm(topgenus_ra$Duganella ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#tric RA
results <- lm(topgenus_ra$Trichococcus ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aeromonas
results <- lm(topgenus_ra$Aeromonas ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Aerobe RA
results <- lm(bbase$Aerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#facan RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage * Site, data = bac_meta_alpha, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova
```

```{r Table S7: ANCOVAs, echo = F, include = T}

#Shannon
results <- lm(npshannon ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Chao
results <- lm(chao ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Sobs
results <- lm(sobs ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 1
results <- lm(a1pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#PCoA Axis 2
results <- lm(a2pts ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Proteo RA
results <- lm(Proteobacteria ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#firmicutes RA
results <- lm(Firmicutes ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Bact RA
results <- lm(Bacteroidetes ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Act RA
results <- lm(Actinobacteria ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = meta_top_phyla)
summary(results)
ancova2 <- anova(results)
ancova2

#Pseudo
results <- lm(topgenus_ra$Pseudomonas ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Flavo
results <- lm(topgenus_ra$Flavobacterium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Jantho
results <- lm(topgenus_ra$Janthinobacterium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Rhiz
results <- lm(topgenus_ra$Rhizobium ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Dug
results <- lm(topgenus_ra$Duganella ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Tric
results <- lm(topgenus_ra$Trichococcus ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#Aeromonas
results <- lm(topgenus_ra$Aeromonas ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

results <- lm(bbase$Aerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#fac an RA
results <- lm(bbase$Facultatively_Anaerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2

#anaerobe RA
results <- lm(bbase$Anaerobic ~  Lineage + Lineage:Sat + Sat + SoilP + SoilN, data = bac_meta_alpha)
summary(results)
ancova2 <- anova(results)
ancova2
```

```{r Fig. S6: regressions, echo = F, include = T}
library(pryr)

bac_meta_alpha$SoilP <- as.numeric(bac_meta_alpha$SoilP)
bac_meta_alpha$SoilN <- as.numeric(bac_meta_alpha$SoilN)
meta_top_bphyla$SoilP <- as.numeric(meta_top_bphyla$SoilP)
meta_top_bphyla$SoilN <- as.numeric(meta_top_bphyla$SoilN)

#Shannon vs. sat

regnat.p2.1 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p2.1)
reginv.p2.1 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p2.1)


p2.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bac_meta_alpha$npshannon, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.1, lty = 2)
  # abline(reginv.p2.1)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p2.2 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p2.2)
reginv.p2.2 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p2.2)


p2.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bac_meta_alpha$npshannon, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Shannon Diversity", las = 1)
  # abline(regnat.p2.2, lty = 2)
  # abline(reginv.p2.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs N

regnat.p2.3 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p2.3)
reginv.p2.3 <- lm(bac_meta_alpha$npshannon[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p2.3)


p2.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bac_meta_alpha$npshannon, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Shannon Diversity", las = 1)
  abline(regnat.p2.3, lty = 2)
  abline(reginv.p2.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs. sat

regnat.p3.1 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p3.1)
reginv.p3.1 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p3.1)


p3.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bac_meta_alpha$chao, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.1, lty = 2)
  # abline(reginv.p3.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Shannon vs P

regnat.p3.2 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p3.2)
reginv.p3.2 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p3.2)


p3.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bac_meta_alpha$chao, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.2, lty = 2)
  # abline(reginv.p3.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Chao vs N

regnat.p3.3 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p3.3)
reginv.p3.3 <- lm(bac_meta_alpha$chao[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p3.3)


p3.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bac_meta_alpha$chao, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Chao Richness", las = 1)
  # abline(regnat.p3.3, lty = 2)
  # abline(reginv.p3.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs. sat

regnat.p4.1 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p4.1 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p4.1)


p4.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bac_meta_alpha$sobs, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Bacterial Species Observed", las = 1)
  # abline(regnat.p4.1, lty = 2)
  # abline(reginv.p4.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Sobs vs P

regnat.p4.2 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p4.2)
reginv.p4.2 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p4.2)


p4.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bac_meta_alpha$sobs, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Bacterial Species Observed", las = 1)
  # abline(regnat.p4.2, lty = 2)
  # abline(reginv.p4.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#sobs vs N

regnat.p4.3 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p4.3)
reginv.p4.3 <- lm(bac_meta_alpha$sobs[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p4.3)


p4.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bac_meta_alpha$sobs, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Bacterial Species Observed", las = 1)
  # abline(regnat.p4.3, lty = 2)
  # abline(reginv.p4.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs. sat

a1pts <- bac_pcoa.pts[ , 1]

regnat.p5.1 <- lm(a1pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p4.1)
reginv.p5.1 <- lm(a1pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p5.1)


p5.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = a1pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.1, lty = 2)
  abline(reginv.p5.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs P

regnat.p5.2 <- lm(a1pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p5.2)
reginv.p5.2 <- lm(a1pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p5.2)


p5.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = a1pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 1", las = 1)
  # abline(regnat.p5.2, lty = 2)
  # abline(reginv.p5.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 1) vs N

regnat.p5.3 <- lm(a1pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p5.3)
reginv.p5.3 <- lm(a1pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p5.3)


p5.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = a1pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 1", las = 1)
  abline(regnat.p5.3, lty = 2)
  abline(reginv.p5.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs. sat

a2pts <- bac_pcoa.pts[ , 2]

regnat.p6.1 <- lm(a2pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p6.1)
reginv.p6.1 <- lm(a2pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p6.1)


p6.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = a2pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "PCoA Axis 2", las = 1)
  abline(regnat.p6.1, lty = 2)
  abline(reginv.p6.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs P

regnat.p6.2 <- lm(a2pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p6.2)
reginv.p6.2 <- lm(a2pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p6.2)


p6.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = a2pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "PCoA Axis 2", las = 1)
  # abline(regnat.p6.2, lty = 2)
  # abline(reginv.p6.2)
 # legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#PCoA Scores (Axis 2) vs N

regnat.p6.3 <- lm(a2pts[grepl("Nat", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p6.3)
reginv.p6.3 <- lm(a2pts[grepl("Inv", rownames(bac_pcoa.pts))] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p6.3)


p6.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = a2pts, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "PCoA Axis 2", las = 1)
  abline(regnat.p6.3, lty = 2)
  abline(reginv.p6.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Proteo Rel. Abund vs. sat

regnat.p7.1 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p7.1)
reginv.p7.1 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p7.1)


p7.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_bphyla$Sat, y = meta_top_bphyla$Proteobacteria, pch = pchs[as.character(meta_top_bphyla$Lineage)], xlab = "Soil Saturation", ylab = "Proteobacteria Relative Abundance", las = 1)
  # abline(regnat.p7.1, lty = 2)
  # abline(reginv.p7.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Proteo Rel. Abund vs P

regnat.p7.2 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$SoilP[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p7.2)
reginv.p7.2 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$SoilP[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p7.2)


p7.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_bphyla$SoilP, y = meta_top_bphyla$Proteobacteria, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Proteobacteria Relative Abundance", las = 1)
  # abline(regnat.p7.2, lty = 2)
  # abline(reginv.p7.2)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Proteo Rel. Abund vs N

regnat.p7.3 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p7.3)
reginv.p7.3 <- lm(meta_top_bphyla$Proteobacteria[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p7.3)


p7.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = meta_top_bphyla$SoilN, y = meta_top_bphyla$Proteobacteria, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Proteobacteria Relative Abundance", las = 1)
  # abline(regnat.p7.3, lty = 2)
  # abline(reginv.p7.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Bacteriodetes Rel. Abund vs. sat

regnat.p8.1 <- lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p8.1)
reginv.p8.1 <- lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p8.1)


p8.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = meta_top_bphyla$Bacteroidetes, pch = pchs[as.character(meta_top_bphyla$Lineage)], xlab = "Soil Saturation", ylab = "Bacteriodetes Relative Abundance", las = 1)
  # abline(regnat.p8.1, lty = 2)
  # abline(reginv.p8.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Bacteriodetes Rel. Abund vs P

regnat.p8.2 <- lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p8.2)
reginv.p8.2 <-lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p8.2)


p8.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = meta_top_bphyla$Bacteroidetes, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Bacteroidetes Relative Abundance", las = 1)
  # abline(regnat.p8.2, lty = 2)
  # abline(reginv.p8.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Bacteriodetes Rel. Abund vs N

regnat.p8.3 <- lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p8.3)
reginv.p8.3 <- lm(meta_top_bphyla$Bacteroidetes[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p8.3)


p8.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = meta_top_bphyla$Bacteroidetes, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Bacteroidetes Relative Abundance", las = 1)
  # abline(regnat.p8.3, lty = 2)
  # abline(reginv.p8.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Firmicutes Rel. Abund vs Sat

regnat.p9.1 <- lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p9.1)
reginv.p9.1 <- lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$Sat[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p9.1)


p9.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = meta_top_bphyla$Firmicutes, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Firmicutes Relative Abundance", las = 1)
  # abline(regnat.p9.1, lty = 2)
  # abline(reginv.p9.1)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}
#Firmicutes Rel. Abund vs P

regnat.p9.2 <-lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$SoilP[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p9.2)
reginv.p9.2 <- lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$SoilP[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p9.2)


p9.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = meta_top_bphyla$Firmicutes, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Firmicutes Relative Abundance", las = 1)
  # abline(regnat.p9.2, lty = 2)
  # abline(reginv.p9.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Firmicutes Rel. Abund vs N

regnat.p9.3 <- lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Nat"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Nat"])
summary(regnat.p9.3)
reginv.p9.3 <- lm(meta_top_bphyla$Firmicutes[meta_top_bphyla$Lineage == "Inv"] ~ meta_top_bphyla$SoilN[meta_top_bphyla$Lineage == "Inv"])
summary(reginv.p9.3)


p9.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = meta_top_bphyla$Firmicutes, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Firmicutes Relative Abundance", las = 1)
  # abline(regnat.p9.3, lty = 2)
  # abline(reginv.p9.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Actino vs. sat

regnat.p10.1 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p10.1)
reginv.p10.1 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p10.1)


p10.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = meta_top_bphyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Actinobacteria Relative Abundance", las = 1)
  abline(regnat.p10.1, lty = 2)
  abline(reginv.p10.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#actino Abund vs P

regnat.p10.2 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p10.2)
reginv.p10.2 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p10.2)


p10.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = meta_top_bphyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil P", ylab = "Actinobacteria Relative Abundance", las = 1)
  # abline(regnat.p10.2, lty = 2)
  # abline(reginv.p10.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#actino Rel. Abund vs N

regnat.p10.3 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p10.3)
reginv.p10.3 <- lm(meta_top_bphyla$Actinobacteria[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p10.3)


p10.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = meta_top_bphyla$Actinobacteria, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil N", ylab = "Actinobacteria Relative Abundance", las = 1)
  # abline(regnat.p10.3, lty = 2)
  # abline(reginv.p10.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Pseudomonas Rel. Abund vs. sat

regnat.p11.1 <- lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p11.1)
reginv.p11.1 <- lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p11.1)


p11.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Pseudomonas Relative Abundance", las = 1)
  abline(regnat.p11.1, lty = 2)
  abline(reginv.p11.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Pseudomonas Rel. Abund vs P

regnat.p11.2 <-lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p11.2)
reginv.p11.2 <- lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p11.2)


p11.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Pseudomonas Relative Abundance", las = 1)
  # abline(regnat.p11.2, lty = 2)
  # abline(reginv.p11.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Pseudomonas Rel. Abund vs N

regnat.p11.3 <- lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p11.3)
reginv.p11.3 <- lm(topgenus_ra$Pseudomonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p11.3)


p11.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Pseudomonas, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Pseudomonas Relative Abundance", las = 1)
  # abline(regnat.p11.3, lty = 2)
  # abline(reginv.p11.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Flavobacterium Rel. Abund vs. sat

regnat.p12.1 <- lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p12.1)
reginv.p12.1 <- lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p12.1)


p12.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Flavobacterium Relative Abundance", las = 1)
  # abline(regnat.p12.1, lty = 2)
  # abline(reginv.p12.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Flavobacterium Rel. Abund vs P

regnat.p12.2 <-lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p12.2)
reginv.p12.2 <- lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p12.2)


p12.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Flavobacterium Relative Abundance", las = 1)
  # abline(regnat.p12.2, lty = 2)
  # abline(reginv.p12.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Flavobacterium Rel. Abund vs N

regnat.p12.3 <- lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p12.3)
reginv.p12.3 <- lm(topgenus_ra$Flavobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p12.3)


p12.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Flavobacterium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Flavobacterium Relative Abundance", las = 1)
  # abline(regnat.p12.3, lty = 2)
  # abline(reginv.p12.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Janthino Rel. Abund vs. sat

regnat.p13.1 <- lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p13.1)
reginv.p13.1 <- lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p13.1)


p13.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Janthinobacterium Relative Abundance", las = 1)
  abline(regnat.p13.1, lty = 2)
  abline(reginv.p13.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Janthino Rel. Abund vs P

regnat.p13.2 <-lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p13.2)
reginv.p13.2 <- lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p13.2)


p13.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Janthinobacterium Relative Abundance", las = 1)
  # abline(regnat.p13.2, lty = 2)
  # abline(reginv.p13.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Janthino Rel. Abund vs N

regnat.p13.3 <- lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p13.3)
reginv.p13.3 <- lm(topgenus_ra$Janthinobacterium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p13.3)


p13.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Janthinobacterium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Janthinobacterium Relative Abundance", las = 1)
  abline(regnat.p13.3, lty = 2)
  abline(reginv.p13.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Rhizobium Rel. Abund vs. sat

regnat.p14.1 <- lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p14.1)
reginv.p14.1 <- lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p14.1)


p14.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Rhizobium, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Rhizobium Relative Abundance", las = 1)
  abline(regnat.p14.1, lty = 2)
  abline(reginv.p14.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Rhizobium Rel. Abund vs P

regnat.p14.2 <-lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p14.2)
reginv.p14.2 <- lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p14.2)


p14.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Rhizobium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Rhizobium Relative Abundance", las = 1)
  # abline(regnat.p14.2, lty = 2)
  # abline(reginv.p14.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Rhizobium Rel. Abund vs N

regnat.p14.3 <- lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p14.3)
reginv.p14.3 <- lm(topgenus_ra$Rhizobium[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p14.3)


p14.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Rhizobium, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Rhizobium Relative Abundance", las = 1)
  # abline(regnat.p14.3, lty = 2)
  # abline(reginv.p14.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}


#Duganella Rel. Abund vs. sat

regnat.p15.1 <- lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p15.1)
reginv.p15.1 <- lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p15.1)


p15.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Duganella, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Duganella Relative Abundance", las = 1)
  # abline(regnat.p15.1, lty = 2)
  # abline(reginv.p15.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Duganella Rel. Abund vs P

regnat.p15.2 <-lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p15.2)
reginv.p15.2 <- lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p15.2)


p15.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Duganella, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Duganella Relative Abundance", las = 1)
  # abline(regnat.p15.2, lty = 2)
  # abline(reginv.p15.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Duganella Rel. Abund vs N

regnat.p15.3 <- lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p15.3)
reginv.p15.3 <- lm(topgenus_ra$Duganella[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p15.3)


p15.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Duganella, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Duganella Relative Abundance", las = 1)
  # abline(regnat.p15.3, lty = 2)
  # abline(reginv.p15.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Trichococcus Rel. Abund vs. sat

regnat.p16.1 <- lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p16.1)
reginv.p16.1 <- lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p16.1)


p16.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Trichococcus, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Trichococcus Relative Abundance", las = 1)
  # abline(regnat.p16.1, lty = 2)
  # abline(reginv.p16.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Trichococcus Rel. Abund vs P

regnat.p16.2 <-lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p16.2)
reginv.p16.2 <- lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p16.2)


p16.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Trichococcus, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Trichococcus Relative Abundance", las = 1)
  # abline(regnat.p16.2, lty = 2)
  # abline(reginv.p16.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Trichococcus Rel. Abund vs N

regnat.p16.3 <- lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p16.3)
reginv.p16.3 <- lm(topgenus_ra$Trichococcus[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p16.3)


p16.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Trichococcus, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Trichococcus Relative Abundance", las = 1)
  abline(regnat.p16.3, lty = 2)
  abline(reginv.p16.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aeromonas Rel. Abund vs. sat

regnat.p17.1 <- lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p17.1)
reginv.p17.1 <- lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p17.1)


p17.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = topgenus_ra$Aeromonas, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Aeromonas Relative Abundance", las = 1)
  # abline(regnat.p17.1, lty = 2)
  # abline(reginv.p17.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aeromonas Rel. Abund vs P

regnat.p17.2 <-lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p17.2)
reginv.p17.2 <- lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p17.2)


p17.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = topgenus_ra$Aeromonas, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Aeromonas Relative Abundance", las = 1)
  # abline(regnat.p17.2, lty = 2)
  # abline(reginv.p17.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aeromonas Rel. Abund vs N

regnat.p17.3 <- lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p17.3)
reginv.p17.3 <- lm(topgenus_ra$Aeromonas[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p17.3)


p17.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = topgenus_ra$Aeromonas, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Aeromonas Relative Abundance", las = 1)
  abline(regnat.p17.3, lty = 2)
  abline(reginv.p17.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aerobes Rel. Abund vs. sat

regnat.p18.1 <- lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p18.1)
reginv.p18.1 <- lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p18.1)


p18.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bbase$Aerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Aerobe Relative Abundance", las = 1)
#   abline(regnat.p18.1, lty = 2)
#   abline(reginv.p18.1)
# #  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aerobes Rel. Abund vs P

regnat.p18.2 <-lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p18.2)
reginv.p18.2 <- lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p18.2)


p18.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bbase$Aerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Aerobe Relative Abundance", las = 1)
  # abline(regnat.p18.2, lty = 2)
  # abline(reginv.p18.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Aerobes Rel. Abund vs N

regnat.p18.3 <- lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p18.3)
reginv.p18.3 <- lm(bbase$Aerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p18.3)


p18.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bbase$Aerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Aerobe Relative Abundance", las = 1)
  abline(regnat.p18.3, lty = 2)
  abline(reginv.p18.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Facan Rel. Abund vs. sat

regnat.p19.1 <- lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p19.1)
reginv.p19.1 <- lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p19.1)


p19.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil Saturation", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  abline(regnat.p19.1, lty = 2)
  abline(reginv.p19.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Facan Rel. Abund vs P

regnat.p19.2 <-lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p19.2)
reginv.p19.2 <- lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p19.2)


p19.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  # abline(regnat.p19.2, lty = 2)
  # abline(reginv.p19.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Facan Rel. Abund vs N

regnat.p19.3 <- lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p19.3)
reginv.p19.3 <- lm(bbase$Facultatively_Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p19.3)


p19.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bbase$Facultatively_Anaerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Facultative Anaerobe Relative Abundance", las = 1)
  # abline(regnat.p19.3, lty = 2)
  # abline(reginv.p19.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Anaerobe Rel. Abund vs. sat

regnat.p20.1 <- lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p20.1)
reginv.p20.1 <- lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$Sat[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p20.1)


p20.1 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$Sat, y = bbase$Anaerobic, pch = pchs[as.character(meta_top_genus$Lineage)], xlab = "Soil Saturation", ylab = "Anaerobe Relative Abundance", las = 1)
  # abline(regnat.p20.1, lty = 2)
  # abline(reginv.p20.1)
#  legend("bottomright", c("Non-native", "Native"), pch = c(16, 1))
}

#Anaerobe Rel. Abund vs P

regnat.p20.2 <-lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p20.2)
reginv.p20.2 <- lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilP[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p20.2)


p20.2 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilP, y = bbase$Anaerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil P", ylab = "Anaerobe Relative Abundance", las = 1)
  # abline(regnat.p20.2, lty = 2)
  # abline(reginv.p20.2)
#  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}

#Anaerobe Rel. Abund vs N

regnat.p20.3 <- lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Nat"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Nat"])
summary(regnat.p20.3)
reginv.p20.3 <- lm(bbase$Anaerobic[bac_meta_alpha$Lineage == "Inv"] ~ bac_meta_alpha$SoilN[bac_meta_alpha$Lineage == "Inv"])
summary(reginv.p20.3)


p20.3 %<a-% {
  pchs <- c(Nat = 1, Inv = 16)
  plot(x = bac_meta_alpha$SoilN, y = bbase$Anaerobic, pch = pchs[as.character(bac_meta_alpha$Lineage)], xlab = "Soil N", ylab = "Anaerobe Relative Abundance", las = 1)
  abline(regnat.p20.3, lty = 2)
  abline(reginv.p20.3)
  legend("topright", c("Non-native", "Native"), pch = c(16, 1))
}


```
##Taxonomic Analysis

```{r tax by lineage, echo = F, include = F}


# 3. calculate the relative abundance for native
nat_funshared <- meta_funphylum_shared[meta_funphylum_shared$Lineage == "Nat", ]
non_funshared <- meta_funphylum_shared[meta_funphylum_shared$Lineage == "Inv", ]

nat_funshared <- nat_funshared[ ,2:7]
rownames(nat_funshared) <- natID

non_funshared <- non_funshared[ ,2:7]
rownames(non_funshared) <- nonID

nat_funseqs <- apply(nat_funshared, 1, sum)
nat_funphylum_rel_abund <- nat_funshared / nat_funseqs

nat_funav_ra <- apply(nat_funphylum_rel_abund, 2, mean)
nat_funsd_ra <- apply(nat_funphylum_rel_abund, 2, sd)
nat_funse_ra <- nat_funsd_ra/sqrt(nrow(nat_funphylum_rel_abund))


# 3. calculate the relative abundance for invasive

non_funseqs <- apply(non_funshared, 1, sum)
non_funphylum_rel_abund <- non_funshared / non_funseqs

non_funav_ra <- apply(non_funphylum_rel_abund, 2, mean)
non_funsd_ra <- apply(non_funphylum_rel_abund, 2, sd)
non_funse_ra <- non_funsd_ra/sqrt(nrow(non_funphylum_rel_abund))

funlin_rel_average <- data.frame(Native = nat_funav_ra, NonNative = non_funav_ra)

top_av_funphyla <- as.matrix(funlin_rel_average)
top_av_funphyla <- t(top_av_funphyla)

x0_non <- non_funav_ra - non_funse_ra
x1_non <- non_funav_ra + non_funse_ra

x0_nat <- nat_funav_ra - nat_funse_ra
x1_nat <- nat_funav_ra + nat_funse_ra

#Asco RA
results <- lm(Ascomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Basidio RA
results <- lm(Basidiomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Unclassified RA
results <- lm(Unclassified ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Zygomycota RA
results <- lm(Zygomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Rozellomycota RA
results <- lm(Rozellomycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

#Glomeromycota RA
results <- lm(Glomeromycota ~  Lineage * Site, data = meta_top_funphyla, contrasts=list(Lineage=contr.sum, Site=contr.sum))
anova <- Anova(results, type = "III")
anova

```

```{r SF6, echo = F, include=T}
#png("fun_phylum_relabund.png", height = 6, width = 6, units = "in", res = 200)
quartz.options(height=6, width=6)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 3, 6))
par(xpd = NA)

plot.window(xlim = c(0,1), ylim = c(0,18))

barplot(height = top_av_funphyla, beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,1), col = c("white", "gray"))

arrows(x0 = x0_nat, x1 = x1_nat, y0 = c(1.5,4.5,7.5,10.5,13.5,16.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
arrows(x0 = x0_non, x1 = x1_non, y0 = c(2.5,5.5,8.5,11.5,14.5,17.5), angle = 90, lwd = 1.5, length = 0.05, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_funphyla), at = c(2,5,8,11,14,17))


mtext("P-Values",side = 4, line = 0, las = 1, at = 21, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-0.5,2.7), at = 19, cex = 0.9)
arrows(x0 = 1.2, y0 = 1, y1 = 18, angle = 90, length = 0.5, lwd = 0.75)
mtext(c("0.066","0.09","0.295","0.704","0.801","0.262"), las = 1, side = 4, line = 2.5, at = c(2,5,8,11,14,17), cex = 0.8)
mtext(c("0.566","0.945","0.669","0.296","1.000","0.366"),side = 4, las = 1, at = c(2,5,8,11,14,17), line = 0, cex = 0.8)

legend("top", c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), bty = "n", cex = 1)
#dev.off()

```

```{r genus by lin, echo = F, include = F}
# 3. calculate the relative abundance
genus_rel_abund <- data.frame(SampleID, genus_rel_abund)
top_genus_ra <- genus_rel_abund[1:9]

meta_top_genus <- inner_join(top_genus_ra, metadata, by = c( "SampleID" = "Code"))


# 3. calculate the relative abundance for native
SampleID <- rownames(asco_cl_genera_shared)
natID <- SampleID[grep(pattern = "Nat", SampleID)]
nonID <- SampleID[grep(pattern = "Inv", SampleID)]


nat_shared <- asco_cl_genera_shared[natID, ]
non_shared <- asco_cl_genera_shared[nonID, ]

nat_shared <- nat_shared[ ,1:8]
rownames(nat_shared) <- natID

non_shared <- non_shared[ ,1:8]
rownames(non_shared) <- nonID

nat_seqs <- apply(nat_shared, 1, sum)
nat_phylum_rel_abund <- nat_shared / nat_seqs

nat_av_ra <- apply(nat_phylum_rel_abund, 2, mean)
nat_sd_ra <- apply(nat_phylum_rel_abund, 2, sd)
nat_se_ra <- nat_sd_ra/sqrt(23)


# 3. calculate the relative abundance for invasive

non_seqs <- apply(non_shared, 1, sum)
non_phylum_rel_abund <- non_shared / non_seqs

non_av_ra <- apply(non_phylum_rel_abund, 2, mean)
non_sd_ra <- apply(non_phylum_rel_abund, 2, sd)
non_se_ra <- non_sd_ra/sqrt(24)

lin_rel_average <- data.frame(Native = nat_av_ra, NonNative = non_av_ra)

top_av_genus <- as.matrix(lin_rel_average)
top_av_genus <- t(top_av_genus)

x0_non <- non_av_ra - non_se_ra
x1_non <- non_av_ra + non_se_ra

x0_nat <- nat_av_ra - nat_se_ra
x1_nat <- nat_av_ra + nat_se_ra

an_ra_gib <- aov(meta_top_genus$Gibberella ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_gib)

an_ra_mic <- aov(meta_top_genus$Microdochium ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_mic)

an_ra_tet <- aov(meta_top_genus$Tetracladium ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_tet)

an_ra_stag <- aov(meta_top_genus$Stagonospora ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_stag)

an_ra_cad <- aov(meta_top_genus$Cadophora ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_cad)

an_ra_ily <- aov(meta_top_genus$Ilyonectria ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_ily)

an_ra_sac <- aov(meta_top_genus$Saccharicola ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_sac)

an_ra_fus <- aov(meta_top_genus$unclassified ~ meta_top_genus$Site * meta_top_genus$Lineage)
summary(an_ra_fus)

```

```{r SF7: Rel abund by Genus and Lin, echo=F, include = T}

quartz.options(height=5, width=5)
plot.new() 
par(oma = c(1, 1, 1, 1))
par(mar = c( 4, 8, 2, 8 ))
par(xpd = NA)
plot.window(xlim = c(-1,1), ylim = c(-1,1))

barplot(height = top_av_genus[ , 1:5], beside=T, horiz = T, axisnames = F, xlab = "Relative abundance", xlim = c(0,0.4), col = c("white", "gray"))
arrows(x0 = x0_nat[1:5], x1 = x1_nat[1:5], y0 = c(1.5,4.5,7.5,10.5,13.5), angle = 90, lwd = 1.5, length = 0.03, code = 3)
arrows(x0 = x0_non[1:5], x1 = x1_non[1:5], y0 = c(2.5,5.5,8.5,11.5,14.5), angle = 90, lwd = 1.5, length = 0.03, code = 3)
axis(side = 2, las = 1, labels = colnames(top_av_genus)[1:5], at = c(2,5,8,11,14))

mtext("P-Values",side = 4, line = 1, las = 1, at = 18, cex = 1)
mtext(c("Lineage","Site"),side = 4, las = 1, line = c(-0.5,3), at = 16, cex = 0.9)
arrows(x0 = 0.51, y0 = 1, y1 = 15, angle = 90, length = 0.5, lwd = 0.75)

mtext(c("0.452", "0.862", "0.638", "0.368","0.509"),side = 4, las = 1, line = 0, at =  c(2,5,8,11,14), cex = 1)
mtext(c("0.029", "0.548", "0.234","0.006","0.781"),side = 4, las = 1, line = 3, at =  c(2,5,8,11,14), cex = 1)



legend(0.15, 25, c("Non-native", "Native" ), pch = 22, col = "black", pt.bg = c("gray", "white"), xpd = T, bty = "n")

```